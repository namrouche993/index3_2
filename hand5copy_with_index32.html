<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
</style><!-- Ugly Hack due to jsFiddle issue -->

<!-- <script src="http://docs.handsontable.com/0.20.2/bower_components/handsontable/dist/handsontable.full.js"></script>
<link type="text/css" rel="stylesheet" href="http://docs.handsontable.com/0.20.2/bower_components/handsontable/dist/handsontable.full.min.css"> -->


<script src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css">

<script src="http://docs.handsontable.com/0.20.2/bower_components/numeraljs/languages/de.js"></script>
<script src="https://unpkg.com/sheetclip"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<script src="https://cdn.jsdelivr.net/npm/numbro@2.3.6/dist/numbro.min.js"></script>

<script src="jspdf.min.js"></script>
<script src="jspdf.plugin.autotable.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">

<script src="https://cdn.jsdelivr.net/npm/accounting/accounting.min.js"></script>
<script src='https://cdn.jsdelivr.net/npm/bignumber.js@9.1.0/bignumber.min.js'></script>




<link rel="stylesheet" href="tableur/style.css">
<script src="tableur/comments_messages.js" type='module'></script>
<script src="tableur/isValidDate.js" type='module'></script>

<script src="tableur/existsInArray.js" type="module"></script>
<script src="tableur/downloadfile_test.js" type="module"></script>



<script src="tableur/adding/module1.js"></script>
<script src="tableur/adding/module2.js"></script>
<!-- <script type="module" src="tableur/module3.js"></script>
<script src="tableur/module3.js"></script> -->

<script src="tableur/adding/module3.js" type="module"></script>
<script src="tableur/adding/module3main.js" type="module"></script>


 <!-- <script src="tableur/module3.js"></script> -->



    <title>Document</title>
</head>
<body>
  <script src="http://code.jquery.com/jquery-2.0.3.min.js" ></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>


    <div id='toolbarid'>
        <button onclick="undohandstonetable()" class='material-symbols-outlined' style="font-size:18px;cursor:pointer;">undo</button>
        <button onclick="redohandstonetable()" class='material-symbols-outlined' style="font-size:18px;cursor:pointer;">redo</button>
        <button class='material-symbols-outlined' style="font-size:18px;cursor:pointer;">format_bold</button>   
        <button onclick="downloadfile()">Download</button>
        <button id="button-id">cliquer </button>


        <!-- <button  onclick="sendValue()" class='material-symbols-outlined' style="font-size:18px;cursor:pointer;">save</button> 
           <br>
        <button onclick="handleFct()" class='material-symbols-outlined' style="font-size:18px;cursor:pointer;">sync</button>        
      -->
          </div>

          
    <div id="example1" class="hot handsontable htColumnHeaders"></div>

<script type='module'>
  import { comments_messages } from './tableur/comments_messages.js';
  import { isValidDate } from './tableur/isValidDate.js';
  import { columnsdata } from './tableur/columnsdata.js';
  import { ddatafct,data22fct } from './tableur/ddata.js';
  import { normalcellloop } from './tableur/normalcellloop.js'
  import { afterValidatefct } from './tableur/afterValidate.js'
  import { decimalSeparator,userLocale,navigator_language,userTimeZone,usTimeZones } from './tableur/intials_inputs_nb.js'
  import { afterChangefct } from './tableur/afterChange.js'

  console.log('publicFunction3 avant : ')

// import { publicFunction3 } from './tableur/module3.js';
// publicFunction3()
//  const comments_messages = window.Module_comments_messages.comments_messages;
//  const isValidDate = window.Module_isValidDate.isValidDate;
 console.log('mod2 and sayHello : ')
//  sayHello()

//  const modsay = window.sayHello.sayHello();

 const mod1 = window.Module1.publicFunction();
 const mod2 = window.Module2.publicFunction2();
  // import { publicFunction3 } from './tableur/module3.js';
  // publicFunction3();

//  const mod3 = window.Module3.publicFunction3();
 console.log(mod2)

  
//#region date format starting

      if(navigator_language=='en-US'){
    if(usTimeZones.includes(userTimeZone)){
      var dateformatlanguage = 'mm/dd/aaaa'; 
      var splitdate='/';
    } else {
      var dateformatlanguage = 'jj/mm/aaaa' // 'mm/dd/yyyy'; // 12/31/1990 edit it later , modify it later  , change it later
      var splitdate='/';
      //var [monthdate,daydate, yeardate] = dateformatlanguage.split(splitdate);
    }
    } else if(navigator_language=='ko-KR' || navigator_language=='hu-HU'){
      var dateformatlanguage = 'aaaa.mm.jj' // 'yyyy.mm.dd' // 1990.12.31
      var splitdate='.';
      //var [yeardate,monthdate,daydate] = dateformatlanguage.split(splitdate);

    } else if(navigator_language=='ja-JP' || navigator_language=='ZH-CN'){
      var dateformatlanguage = 'aaaa/mm/jj' //'yyyy/mm/dd' // 1990/12/31
      var splitdate='/';
      //var [yeardate,monthdate,daydate] = dateformatlanguage.split(splitdate);

    } else if(navigator_language=='en-CA'){
      var dateformatlanguage = 'aaaa-mm-jj' //'yyyy-mm-dd' // 1990-12-31
      var splitdate='-';
      //var [yeardate,monthdate,daydate] = dateformatlanguage.split(splitdate);

    } else if(navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR'){
      var dateformatlanguage = 'jj.mm.aaaa' //'dd.mm.yyyy' // 12.31.1990
      var splitdate='.';
      //var [daydate,monthdate,yeardate] = dateformatlanguage.split(splitdate);

    } else {
      // european and other formats
      var dateformatlanguage = 'jj/mm/aaaa' // 'dd/mm/yyyy' // 31/12/1990
      var splitdate='/';
      //var [daydate,monthdate,yeardate] = dateformatlanguage.split(splitdate);
    }
    //#endregion date format starting



var skiformat = [];

  const warningpopup = ()=>{
        toastr.options = {
          "timeOut": 2000,
          "positionClass": "toast-bottom-right",

        };
        toastr.warning('Hello World!', 'Notification Title');
      }

  let numOferrorPopups = 0;
  const errorpopup = ()=>{
        if (numOferrorPopups >= 4) {
              return;
           }           
  toastr.options = {
    onHidden: function() {
      numOferrorPopups--;
      console.log(`Number of popups: ${numOferrorPopups}`);
    },
    "timeOut": 2500,
    "positionClass": "toast-bottom-right",
  };
  toastr.error('Veuillez entrer un nombre', 'Erreur');
  numOferrorPopups++;
  console.log(`Number of popups: ${numOferrorPopups}`);
      }


// function existsInArray(array, pair) {
//     for (let i = 0; i < array.length; i++) {
//       if (array[i][0] === pair[0] && array[i][1] === pair[1]) {
//         return true;
//       }
//     }
//     return false;
//   }
  
  
      
      
      function undohandstonetable() {
          hot.undo(true);
      }
      function redohandstonetable() {
          hot.redo(false);

      }
      
      var ddata = ddatafct();
      var data22 = data22fct()
      console.log('ddata ++++++ : ')
      console.log(ddata)
      console.log(data22)

var container = document.getElementById('example1')
var sheetclip = new SheetClip();
var clipboardCache = '';


const hot = new Handsontable(container, {
    //data: getData(),
    data : ddata,
    licenseKey: 'non-commercial-and-evaluation', // for non-commercial use only
          rowHeaders: true,
          wordWrap: true,
          colHeaders: true,
          comments: true,
          manualColumnResize: true,
          manualRowResize: true,
          colWidths: [50,200,100,120,120, 120,120,120,120,100,  120,120,120,120,100,    20 ],
          undo: true,
          columns: columnsdata(0,16),
          contextMenu: {
            items:{
              "copy":{name:"Copier"},
              "cut":{name:'Couper'},
              "paste":{
                name: 'Coller (Utiliser <b>Ctrl + V</b> avec le clavier)',
                disabled:true
             }
            }
          },
          startRows: 6,
          startCols: 5,
          cells:(row,column)=>{
            var cellProperties = {};
            if(row<6){
              cellProperties.readOnly = true;
            }
            return cellProperties;
          },
          mergeCells: [
    { row: 0, col: 1, rowspan: 1, colspan: 15 },
    { row: 1, col: 1, rowspan: 1, colspan: 15 },
    { row: 2, col: 1, rowspan: 1, colspan: 15 },


    { row: 4, col: 1, rowspan: 2, colspan: 1 },
    { row: 4, col: 2, rowspan: 2, colspan: 1 },
    { row: 4, col: 3, rowspan: 2, colspan: 1 },
    { row: 4, col: 4, rowspan: 2, colspan: 1 },

    { row: 4, col: 5, rowspan: 1, colspan: 5 },
    { row: 4, col: 10, rowspan: 1, colspan: 5 },




    ],
          cell: normalcellloop(),
          hiddenColumns: {columns:[15]},
          DragToScroll: true,
          copyPaste: true,
          //afterValidate : afterValidatefct,
          afterValidate: (oldvalue, row, prop, source, ...otherArgs) => {
            return afterValidatefct(oldvalue, row, prop, source, ...otherArgs, hot);
          },

          beforeKeyDown: function (event) {  // editable the 2 indexx later inside 
     
     var selected = hot.getSelected();
     var currentColIndex = selected ? selected[0][1] : null;
     //console.log('currentColIndex : ')
     //console.log(currentColIndex)
     //console.log(selected)
     //console.log(currentColIndex)
     if(currentColIndex==12) {  // editable edit it later changeable , modify it later , change it later
       if(navigator_language=='en-US'){
   var dateformatlanguage = 'mm/dd/yyyy'; // 12/31/1990
   var splitdate='/';
   //var [monthdate,daydate, yeardate] = dateformatlanguage.split(splitdate);

     var betweensplit_dot = this.getActiveEditor().getValue().split(".")
     var betweensplit_slash = this.getActiveEditor().getValue().split("/")
     var betweensplit_hyphen = this.getActiveEditor().getValue().split("-")

    // console.log(event.key)
     if( !isNaN(Number(event.key)) && (typeof condition_split=='undefined' || condition_split==true)){
       var betweensplit_dot = this.getActiveEditor().getValue().split(".");
       betweensplit_dot[1]=betweensplit_dot[1]+event.key;

       var betweensplit_slash = this.getActiveEditor().getValue().split("/");
       betweensplit_slash[1]=betweensplit_slash[1]+event.key;

       var betweensplit_hyphen = this.getActiveEditor().getValue().split("-");
       betweensplit_hyphen[1]=betweensplit_hyphen[1]+event.key;

     
   if( ( (this.getActiveEditor().getValue().length==1 && this.getActiveEditor().getValue().toString()!=' ') && !isNaN(Number(event.key)) ) || (this.getActiveEditor().getValue().length==4 && !isNaN(Number(event.key))) || (Number(betweensplit_dot[1])>9 && Number(betweensplit_dot[1])<100) || (Number(betweensplit_slash[1])>9 && Number(betweensplit_slash[1])<100) || (Number(betweensplit_hyphen[1])>9 && Number(betweensplit_hyphen[1])<100)  ){
   if( !isNaN(Number(event.key)) && (this.getActiveEditor().getValue().split(".").length-1<2 && this.getActiveEditor().getValue().split("/").length-1<2 && this.getActiveEditor().getValue().split("-").length-1<2 ) ){
     this.getActiveEditor().setValue(this.getActiveEditor().getValue() + event.key + splitdate);
     event.stopImmediatePropagation();
     event.preventDefault();
   }
 }} else if (event.key=='.' || event.key=='/' || event.key=='-' ){
    condition_split=false;
    if(this.getActiveEditor().getValue().substring(this.getActiveEditor().getValue().length - 1)==splitdate){ 
     this.getActiveEditor().setValue(this.getActiveEditor().getValue().substring(0,this.getActiveEditor().getValue().length - 1)+event.key)
     event.stopImmediatePropagation();
     event.preventDefault();
   }
 }
 }
  else if(navigator_language=='ko-KR' || navigator_language=='hu-HU'){ // ######################################################################
   //console.log('we are in korean')
   var dateformatlanguage = 'yyyy.mm.dd' // 1990.12.31
   var splitdate='.';
   //var [yeardate,monthdate,daydate] = dateformatlanguage.split(splitdate);


     var betweensplit_dot = this.getActiveEditor().getValue().split(".")
     var betweensplit_slash = this.getActiveEditor().getValue().split("/")
     var betweensplit_hyphen = this.getActiveEditor().getValue().split("-")

     //console.log(event.key)
     if( !isNaN(Number(event.key)) && (typeof condition_split=='undefined' || condition_split==true)){
       var betweensplit_dot = this.getActiveEditor().getValue().split(".");
       betweensplit_dot[1]=betweensplit_dot[1]+event.key;

       var betweensplit_slash = this.getActiveEditor().getValue().split("/");
       betweensplit_slash[1]=betweensplit_slash[1]+event.key;

       var betweensplit_hyphen = this.getActiveEditor().getValue().split("-");
       betweensplit_hyphen[1]=betweensplit_hyphen[1]+event.key;

     
   if( ( (this.getActiveEditor().getValue().length==3 ) && !isNaN(Number(event.key)) ) || (this.getActiveEditor().getValue().length==6 && !isNaN(Number(event.key))) || (Number(betweensplit_dot[1])>9 && Number(betweensplit_dot[1])<100) || (Number(betweensplit_slash[1])>9 && Number(betweensplit_slash[1])<100) || (Number(betweensplit_hyphen[1])>9 && Number(betweensplit_hyphen[1])<100)  ){
   if( !isNaN(Number(event.key)) && (this.getActiveEditor().getValue().split(".").length-1<2 && this.getActiveEditor().getValue().split("/").length-1<2 && this.getActiveEditor().getValue().split("-").length-1<2 ) ){
     this.getActiveEditor().setValue(this.getActiveEditor().getValue() + event.key + splitdate);
     event.stopImmediatePropagation();
     event.preventDefault();
   }
 }} else if (event.key=='.' || event.key=='/' || event.key=='-' ){
    condition_split=false;
    if(this.getActiveEditor().getValue().substring(this.getActiveEditor().getValue().length - 1)==splitdate){ 
     this.getActiveEditor().setValue(this.getActiveEditor().getValue().substring(0,this.getActiveEditor().getValue().length - 1)+event.key)
     event.stopImmediatePropagation();
     event.preventDefault();
   }
 }
 

 } 
 else if(navigator_language=='ja-JP' || navigator_language=='ZH-CN'){ //  ######################################################################
   var dateformatlanguage = 'yyyy/mm/dd' // 1990/12/31
   var splitdate='/';
   //var [yeardate,monthdate,daydate] = dateformatlanguage.split(splitdate);

     var betweensplit_dot = this.getActiveEditor().getValue().split(".")
     var betweensplit_slash = this.getActiveEditor().getValue().split("/")
     var betweensplit_hyphen = this.getActiveEditor().getValue().split("-")

     //console.log(event.key)
     if( !isNaN(Number(event.key)) && (typeof condition_split=='undefined' || condition_split==true)){
       var betweensplit_dot = this.getActiveEditor().getValue().split(".");
       betweensplit_dot[1]=betweensplit_dot[1]+event.key;

       var betweensplit_slash = this.getActiveEditor().getValue().split("/");
       betweensplit_slash[1]=betweensplit_slash[1]+event.key;

       var betweensplit_hyphen = this.getActiveEditor().getValue().split("-");
       betweensplit_hyphen[1]=betweensplit_hyphen[1]+event.key;

     
   if( ( (this.getActiveEditor().getValue().length==3 ) && !isNaN(Number(event.key)) ) || (this.getActiveEditor().getValue().length==6 && !isNaN(Number(event.key))) || (Number(betweensplit_dot[1])>9 && Number(betweensplit_dot[1])<100) || (Number(betweensplit_slash[1])>9 && Number(betweensplit_slash[1])<100) || (Number(betweensplit_hyphen[1])>9 && Number(betweensplit_hyphen[1])<100)  ){
   if( !isNaN(Number(event.key)) && (this.getActiveEditor().getValue().split(".").length-1<2 && this.getActiveEditor().getValue().split("/").length-1<2 && this.getActiveEditor().getValue().split("-").length-1<2 ) ){
     this.getActiveEditor().setValue(this.getActiveEditor().getValue() + event.key + splitdate);
     event.stopImmediatePropagation();
     event.preventDefault();
   }
 }} else if (event.key=='.' || event.key=='/' || event.key=='-' ){
    condition_split=false;
    if(this.getActiveEditor().getValue().substring(this.getActiveEditor().getValue().length - 1)==splitdate){ 
     this.getActiveEditor().setValue(this.getActiveEditor().getValue().substring(0,this.getActiveEditor().getValue().length - 1)+event.key)
     event.stopImmediatePropagation();
     event.preventDefault();
   }
 }
 
 } 
 else if(navigator_language=='en-CA'){  // ######################################################################
   var dateformatlanguage = 'yyyy-mm-dd' // 1990-12-31
   var splitdate='-';
   //var [yeardate,monthdate,daydate] = dateformatlanguage.split(splitdate);

     var betweensplit_dot = this.getActiveEditor().getValue().split(".")
     var betweensplit_slash = this.getActiveEditor().getValue().split("/")
     var betweensplit_hyphen = this.getActiveEditor().getValue().split("-")

     //console.log(event.key)
     if( !isNaN(Number(event.key)) && (typeof condition_split=='undefined' || condition_split==true)){
       var betweensplit_dot = this.getActiveEditor().getValue().split(".");
       betweensplit_dot[1]=betweensplit_dot[1]+event.key;

       var betweensplit_slash = this.getActiveEditor().getValue().split("/");
       betweensplit_slash[1]=betweensplit_slash[1]+event.key;

       var betweensplit_hyphen = this.getActiveEditor().getValue().split("-");
       betweensplit_hyphen[1]=betweensplit_hyphen[1]+event.key;

     
   if( ( (this.getActiveEditor().getValue().length==3 ) && !isNaN(Number(event.key)) ) || (this.getActiveEditor().getValue().length==6 && !isNaN(Number(event.key))) || (Number(betweensplit_dot[1])>9 && Number(betweensplit_dot[1])<100) || (Number(betweensplit_slash[1])>9 && Number(betweensplit_slash[1])<100) || (Number(betweensplit_hyphen[1])>9 && Number(betweensplit_hyphen[1])<100)  ){
   if( !isNaN(Number(event.key)) && (this.getActiveEditor().getValue().split(".").length-1<2 && this.getActiveEditor().getValue().split("/").length-1<2 && this.getActiveEditor().getValue().split("-").length-1<2 ) ){
     this.getActiveEditor().setValue(this.getActiveEditor().getValue() + event.key + splitdate);
     event.stopImmediatePropagation();
     event.preventDefault();
   }
 }} else if (event.key=='.' || event.key=='/' || event.key=='-' ){
    condition_split=false;
    if(this.getActiveEditor().getValue().substring(this.getActiveEditor().getValue().length - 1)==splitdate){ 
     this.getActiveEditor().setValue(this.getActiveEditor().getValue().substring(0,this.getActiveEditor().getValue().length - 1)+event.key)
     event.stopImmediatePropagation();
     event.preventDefault();
   }
 }



 }
  else if(navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR'){ // ######################################################################
   var dateformatlanguage = 'dd.mm.yyyy' // 12.31.1990
   var splitdate='.';

     var betweensplit_dot = this.getActiveEditor().getValue().split(".")
     var betweensplit_slash = this.getActiveEditor().getValue().split("/")
     var betweensplit_hyphen = this.getActiveEditor().getValue().split("-")

   //  console.log(event.key)
     if( !isNaN(Number(event.key))){
       var betweensplit_dot = this.getActiveEditor().getValue().split(".");
       betweensplit_dot[1]=betweensplit_dot[1]+event.key;

       var betweensplit_slash = this.getActiveEditor().getValue().split("/");
       betweensplit_slash[1]=betweensplit_slash[1]+event.key;

       var betweensplit_hyphen = this.getActiveEditor().getValue().split("-");
       betweensplit_hyphen[1]=betweensplit_hyphen[1]+event.key;

     
   if( ( (this.getActiveEditor().getValue().length==1 && this.getActiveEditor().getValue().toString()!=' ') && !isNaN(Number(event.key)) ) || (this.getActiveEditor().getValue().length==4 && !isNaN(Number(event.key))) || (Number(betweensplit_dot[1])>9 && Number(betweensplit_dot[1])<100) || (Number(betweensplit_slash[1])>9 && Number(betweensplit_slash[1])<100) || (Number(betweensplit_hyphen[1])>9 && Number(betweensplit_hyphen[1])<100)  ){
   if( !isNaN(Number(event.key)) && (this.getActiveEditor().getValue().split(".").length-1<2 && this.getActiveEditor().getValue().split("/").length-1<2 && this.getActiveEditor().getValue().split("-").length-1<2 ) ){
     this.getActiveEditor().setValue(this.getActiveEditor().getValue() + event.key + splitdate);
     event.stopImmediatePropagation();
     event.preventDefault();
   }
 }} else if (event.key=='.' || event.key=='/' || event.key=='-' ){
    if(this.getActiveEditor().getValue().substring(this.getActiveEditor().getValue().length - 1)==splitdate){ 
     this.getActiveEditor().setValue(this.getActiveEditor().getValue().substring(0,this.getActiveEditor().getValue().length - 1)+event.key)
     event.stopImmediatePropagation();
     event.preventDefault();
   }
 }
 
 }
  else {        // ############################################################################################################################################
   // european and other formats
   var dateformatlanguage = 'dd/mm/yyyy' // 31/12/1990
   var splitdate='/';
   //console.log('condition_split in beforekey start : ')
   // console.log(condition_split)

   //var [daydate,monthdate,yeardate] = dateformatlanguage.split(splitdate);
     var betweensplit_dot = this.getActiveEditor().getValue().split(".")
     var betweensplit_slash = this.getActiveEditor().getValue().split("/")
     var betweensplit_hyphen = this.getActiveEditor().getValue().split("-")

     //console.log(event.key)
     if( !isNaN(Number(event.key)) && (typeof condition_split=='undefined' || condition_split==true)){
       var betweensplit_dot = this.getActiveEditor().getValue().split(".");
       betweensplit_dot[1]=betweensplit_dot[1]+event.key;

       var betweensplit_slash = this.getActiveEditor().getValue().split("/");
       betweensplit_slash[1]=betweensplit_slash[1]+event.key;

       var betweensplit_hyphen = this.getActiveEditor().getValue().split("-");
       betweensplit_hyphen[1]=betweensplit_hyphen[1]+event.key;

     
   if( ( (this.getActiveEditor().getValue().length==1 && this.getActiveEditor().getValue().toString()!=' ') && !isNaN(Number(event.key)) ) || (this.getActiveEditor().getValue().length==4 && !isNaN(Number(event.key))) || (Number(betweensplit_dot[1])>9 && Number(betweensplit_dot[1])<100) || (Number(betweensplit_slash[1])>9 && Number(betweensplit_slash[1])<100) || (Number(betweensplit_hyphen[1])>9 && Number(betweensplit_hyphen[1])<100)  ){
   if( !isNaN(Number(event.key)) && (this.getActiveEditor().getValue().split(".").length-1<2 && this.getActiveEditor().getValue().split("/").length-1<2 && this.getActiveEditor().getValue().split("-").length-1<2 ) ){
     this.getActiveEditor().setValue(this.getActiveEditor().getValue() + event.key + splitdate);
     event.stopImmediatePropagation();
     event.preventDefault();
   }
 }} else if (event.key=='.' || event.key=='/' || event.key=='-' ){
    condition_split=false;
    if(this.getActiveEditor().getValue().substring(this.getActiveEditor().getValue().length - 1)==splitdate){ 
     this.getActiveEditor().setValue(this.getActiveEditor().getValue().substring(0,this.getActiveEditor().getValue().length - 1)+event.key)
     event.stopImmediatePropagation();
     event.preventDefault();
   }
 }
    //console.log(condition_split)

 }
     }
     else if(currentColIndex!=1 && currentColIndex!=9 &&  currentColIndex!=14  ) { // editable and adding other text columns || dont equal to  
       //console.log('++++++++++')
        if (decimalSeparator == ',') {
       if (event.key === '.') {

         //console.log(event)
         var selectedCell = this.getSelectedLast(); // Get selected cell object
         //var selectedRow = selectedCell[0][0]; // Get selected row index
         var selectedCol = selectedCell[1]; // Get selected column index
         //console.log(selectedCell)
         //console.log(selectedCell[1])
         //console.log(selectedCol)

         //console.log('selectedCol : '  + selectedCol)
         if(selectedCol==3 ||  selectedCol==4        || selectedCol==5 ||        selectedCol==10 ){   // editable modify editable , it's about percentage
           console.log('we are inside selectedCol == 3')
           var cellpercent = this.getActiveEditor().TEXTAREA; // Get the DOM element representing the cell editor
           this.getActiveEditor().setValue(this.getActiveEditor().getValue() + ',');
           cellpercent.setSelectionRange(cellpercent.value.length-1, cellpercent.value.length-1); // Set the new cursor position
           event.stopImmediatePropagation();
           event.preventDefault();
         } else {
         this.getActiveEditor().setValue(this.getActiveEditor().getValue() + ',');
         event.stopImmediatePropagation();
         event.preventDefault();
       
       }
       }
       if (event.key === '.' && event.keyCode == 190) {
         this.getActiveEditor().setValue(this.getActiveEditor().getValue().substring(0, this.getActiveEditor().getValue().length - 1) + '.');
         event.stopImmediatePropagation();
         event.preventDefault();
       }
     }
   }
 },
 
 afterCreateRow: function(index, amount) {
        // Your custom logic goes here
        console.log('A new row has been added at index: ', index);
        console.log(amount)
        console.log(index)
        data22.push(['','','','','','',''])
        console.log(data22)
      },

       afterSelection: (r1, c1, r2, c2) => {
         var comment = hot.getCellMeta(r1, c1).comment;
         if (comment !== undefined) {
            var commentsPlugin = hot.getPlugin('comments');
           commentsPlugin.showAtCell(r1, c1);
           //return comment;
         } else {
            var commentsPlugin = hot.getPlugin('comments');
           commentsPlugin.hide();
         }
       },
     
        

 
});

hot.addHook('beforeChange', function (changes, source) {
        console.log('we are inside beforeChange x y z :')
        //console.log(changes)
        //console.log(source)
        //console.log('commentsPlugin : ')
        var commentsPlugin = hot.getPlugin('comments');
        //console.log(commentsPlugin)
        //console.log(hot.undoRedo.doneActions)
        //console.log(hot.undoRedo.doneActions[hot.undoRedo.doneActions.length-1])

        changes.forEach(([row, prop, oldValue, newValue]) => {
          if (oldValue == '' && newValue == null || oldValue == '' && newValue == '' && source == 'UndoRedo.undo') {
            commentsPlugin.removeCommentAtCell(row, prop);
            console.log('comments removed')
          }
          console.log(`Change in row ${row} property ${prop}: ${oldValue} -> ${newValue}`);
        });
        console.log('end before change')
      });

var setter = false;
var newdateandtime = new Date();

function isBlank(str) {
    return (/^\s*$/.test(str));
}


const downloadfile=()=>{
    
  var doc = new jsPDF({orientation:'landscape'});
//doc.setFontSize(16)
var hotInstance = hot;
var table = [];
var skipped = []
var cells = hotInstance.getData()
for (var i = 4; i < cells.length; i++) {
  var row = [];
  for (var j = 1; j < 15; j++) {
      if(existsInArray(skipped,[i,j])){
          continue;
      }
    var cell = cells[i][j];
    //var cellcontent = hotInstance.getCell(i, j);
    var cellcontent = document.createElement("td");
    cellcontent.className = hot.getCellMeta(i,j).className || '';
    cellcontent.innerHTML = hot.getDataAtCell(i,j) || '';

    var content = cellcontent.innerHTML;

    var cellProperties =hotInstance.getCellMeta(i,j)
    var colspan = cellProperties.colspan || 1;
    var rowspan = cellProperties.rowspan || 1;
    //var styles = cellProperties.style || {};
    if(cellcontent.className!=''){

    var strcontent = "."+cellcontent.className.replace(/ /g, '.');
    var element = document.querySelector(strcontent)
    var style = window.getComputedStyle(element) || '';
    var bgcolor = style.getPropertyValue('background-color') || '';
    var txtalign = style.getPropertyValue('text-align') || '';
    if(i==4 || i==5){
      var styles = {fillColor: bgcolor,halign:txtalign}//,fontSize:6}
    } else {
      var styles = {fillColor: bgcolor,halign:txtalign}//,fontSize:8}
    }

    } else {
    var styles = cellProperties.style || {}
    }
           

    if(rowspan > 1 || colspan > 1 ) {
        console.log(content)
        for(var is=0; is<rowspan ; is++){
            for(var js=0; js<colspan ; js++){
                if(is==0 & js==0) {
                styles['valign']=txtalign || '' 
                continue
                } else {
               var vaisk=i+is;
               var vajsk=j+js
               valueskk=[vaisk,vajsk]
               skipped.push(valueskk)       
                } 
            }
        }
    }
    row.push({ content, colSpan:colspan, rowSpan:rowspan, styles:styles });
  }
  table.push(row);
}
console.log('tableeeeeeeeeeeeee :')
console.log(table)







let font_size=7;
function normalmincolwidth(fontsize) {
    if(fontsize==7){
        return [19,17,17,17,17,  1.15*17, 1.10*17, 1.10*17, 1.10*17,20   , 1.15*17, 1.10*17, 1.10*17, 1.10*17,20];
    } else if (fontsize==6){
        return [17,15,15,15,15,  1.10*18, 1.07*18, 1.07*18, 1.07*18,18   , 1.10*18, 1.07*18, 1.07*18, 1.07*18,18]
    }
}

function calcwidth(fontsize,textwidth) {
 if(fontsize==9){
     return 1.8*textwidth;
 } else if (fontsize==8){
     return 1.64*textwidth;
 } else if (fontsize==7){
     return 1.5*textwidth;
 } else if (fontsize==6){
     return 1.38*textwidth;
 }
}
var data2=table.slice(2); //editable
console.log('data2 : ')
console.log(data2)
let columnMaxLengths = [];
// Initialize the array with zeros for each column
for (let i = 0; i < data2[0].length; i++) {
  columnMaxLengths[i] = 0;
}
// Iterate over each row and update the maximum length for each column
for (let row of data2) {
  for (let i = 0; i < row.length; i++) {
    var cellValue = row[i].content;
    //console.log('cellValue : ')
    //console.log(cellValue)
    columnMaxLengths[i] = Math.max(columnMaxLengths[i], calcwidth(font_size,cellValue.toString().length));
  }
}
console.log(columnMaxLengths)
for (let i = 0; i < data2[0].length; i++) {
    if(i==5 || i==6 || i==7 || i==8 ||  i==10 || i==11 || i==12 || i==13){
  columnMaxLengths[i] = Math.max(columnMaxLengths[i],normalmincolwidth(font_size)[i]);
    } else {
  columnMaxLengths[i] = normalmincolwidth(font_size)[i]
    }   
}
console.log('***************------------------------*******');
console.log("columnMaxLengths avant test sum : ");
console.log(columnMaxLengths)
console.log(font_size)

var sumcolumnMaxLengths = columnMaxLengths.reduce((acc, curr) => acc + curr, 0);
console.log('sumcolumnMaxLengths : ')
console.log(sumcolumnMaxLengths)

    if(sumcolumnMaxLengths>290){
        console.log('font_size : ')
        console.log(font_size)
        font_size--;
        console.log(font_size);
        console.log('yessss it is greather than 290');
        console.log(sumcolumnMaxLengths)
        columnMaxLengths = [];
// Initialize the array with zeros for each column
for (let i = 0; i < data2[0].length; i++) {
  columnMaxLengths[i] = 0;
}

        for (let row of data2) {
  for (let i = 0; i < row.length; i++) {
    cellValue = row[i].content;
    //console.log('font_size after cellvalue : ');
    //console.log(font_size);
    columnMaxLengths[i] = Math.max(columnMaxLengths[i], calcwidth(font_size,cellValue.toString().length));
  }
}
        
for (let i = 0; i < data2[0].length; i++) {
    if(i==5 || i==6 || i==7 || i==8 ||  i==10 || i==11 || i==12 || i==13){
  columnMaxLengths[i] = Math.max(columnMaxLengths[i],normalmincolwidth(font_size)[i]);
    } else {
  columnMaxLengths[i] = normalmincolwidth(font_size)[i]
    }   
}
    }
console.log("columnMaxLengths apres test sum : ");
console.log(columnMaxLengths)
var sumcolumnMaxLengths2 = columnMaxLengths.reduce((acc, curr) => acc + curr, 0);
console.log(sumcolumnMaxLengths2)

console.log('font_size : ')
console.log(font_size)


var columnStyles = {
  0: { columnWidth: columnMaxLengths[0] }, // Column 1 width
  1: { columnWidth: columnMaxLengths[1] }, // Column 2 width
  2: { columnWidth: columnMaxLengths[2] },  
  3: { columnWidth: columnMaxLengths[3] },  
  4: { columnWidth: columnMaxLengths[4] },  
  5: { columnWidth: columnMaxLengths[5] },  
  6: { columnWidth: columnMaxLengths[6] },  
  7: { columnWidth: columnMaxLengths[7] },  
  8: { columnWidth: columnMaxLengths[8] },
  9: { columnWidth: columnMaxLengths[9] },  
  10: { columnWidth: columnMaxLengths[10] },  
  11: { columnWidth: columnMaxLengths[11] },  
  12: { columnWidth: columnMaxLengths[12] },  
  13: { columnWidth: columnMaxLengths[13] },
  14: { columnWidth: columnMaxLengths[14] },  

};



doc.autoTable({  // the complete width of the A4 landscape page is : 297 (i think the unit is by mm so 297mm x 210mm  or 210mm x 297mm)
               
               body:table,
               theme:'grid',
                margin:{left:7,right:4},
              /*  styles: {
                //fontSize: 8,
                lineColor: 50,
                textColor:50,
                },
                */
                columnStyles: columnStyles,
                styles:{fontSize:font_size,
    textColor: [0, 0, 0], // Set text color to black
    lineColor: [0, 0, 0], // Set line color to black
    lineWidth: 0.1 // Set line width to 0.1 (adjust as needed)},
         },
    didParseCell:function(data){data.cell.styles.font = "helvetica";}

            
                
})
doc.save('taaa.pdf')
}


hot.addHook('afterChange', function(changes, src, ...otherArgs) {
  return afterChangefct(changes,src, ...otherArgs, hot)
});


  console.log('hot.getcolheader : ')
  console.log([hot.getColHeader()])
 


  var doc = new jsPDF({orientation:'landscape'});

// Data for the table
var data = [
  ["Column 1", "C2", "C3","C4","C5","C6","C7","C8","C9","C10","C11","C12","C13","C14"],
  ["Row 1", "V", "V", "V", "V", "V", "V", "V", "V", "V", "V", "V", "V", "V"],
  ["Row 2", "V", "V", "V", "V", "V", "V", "V", "V", "V", "V", "V", "V", "V"],
];
/*
a1+a2+a3+a3   + a3+a4+a4+a4+a5     + a3+a4+a4+a4+a5
a1+a2+5a3+6a4+2a5=296
4a3+3/2a3+a3+12a3+4a3=296

a1=4a3
a2=1.5a3
a4=2a3
a5=2a3

a3=11
*/
</script>

</body>
</html>



