<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
</style><!-- Ugly Hack due to jsFiddle issue -->

<!-- <script src="http://docs.handsontable.com/0.20.2/bower_components/handsontable/dist/handsontable.full.js"></script>
<link type="text/css" rel="stylesheet" href="http://docs.handsontable.com/0.20.2/bower_components/handsontable/dist/handsontable.full.min.css"> -->


<script src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css">

<script src="http://docs.handsontable.com/0.20.2/bower_components/numeraljs/languages/de.js"></script>
<script src="https://unpkg.com/sheetclip"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<script src="https://cdn.jsdelivr.net/npm/numbro@2.3.6/dist/numbro.min.js"></script>

<script src="jspdf.min.js"></script>
<script src="jspdf.plugin.autotable.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">

<script src="https://cdn.jsdelivr.net/npm/accounting/accounting.min.js"></script>
<script src='https://cdn.jsdelivr.net/npm/bignumber.js@9.1.0/bignumber.min.js'></script>


<link rel="stylesheet" href="tableur/style.css">





    <title>Document</title>
</head>
<body>
  <script src="http://code.jquery.com/jquery-2.0.3.min.js" ></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>


    <div id='toolbarid'>
        <button onclick="undohandstonetable()" class='material-symbols-outlined' style="font-size:18px;cursor:pointer;">undo</button>
        <button onclick="redohandstonetable()" class='material-symbols-outlined' style="font-size:18px;cursor:pointer;">redo</button>
        <button class='material-symbols-outlined' style="font-size:18px;cursor:pointer;">format_bold</button>   
        <button onclick="downloadfile()">Download</button>
        <button id="button-id">cliquer </button>


        <!-- <button  onclick="sendValue()" class='material-symbols-outlined' style="font-size:18px;cursor:pointer;">save</button> 
           <br>
        <button onclick="handleFct()" class='material-symbols-outlined' style="font-size:18px;cursor:pointer;">sync</button>        
      -->
          </div>

          
    <div id="example1" class="hot handsontable htColumnHeaders"></div>

<script type='module'>
  import { comments_messages } from './tableur/comments_messages.js';
  import { existsInArray } from './tableur/existsInArray.js'
  import { isValidDate } from './tableur/isValidDate.js';
  import { columnsdata } from './tableur/columnsdata.js';
  import { ddatafct,data22fct } from './tableur/ddata.js';
  import { normalcellloop } from './tableur/normalcellloop.js'
  import { afterValidatefct } from './tableur/afterValidate.js'
  import { decimalSeparator,userLocale,navigator_language,userTimeZone,usTimeZones,    dateformatlanguage_to_export as dateformatlanguage ,splitdate_to_export as splitdate } from './tableur/intials_inputs_nb.js'
  import { afterChangefct } from './tableur/afterChange.js'

  import { warningpopup, errorpopup } from './tableur/popups.js'
  import { mergecellsarray } from './tableur/mergecells.js'
  import { beforeKeyDownfct } from './tableur/beforeKeyDown.js'
  import { beforeChangeFct } from './tableur/beforeChange.js'
  
  import { return_table_to_downloading_Fct } from './tableur/return_table_to_downloading.js';

  import { edit_size_table_to_downloading_sadeg_Fct } from './tableur/edit_size_table_to_downloading_sadeg.js';

      
      
      function undohandstonetable() {
          hot.undo(true);
      }
      function redohandstonetable() {
          hot.redo(false);

      }
      
      var ddata = ddatafct();
      var data22 = data22fct()
    

var container = document.getElementById('example1')
var sheetclip = new SheetClip();
var clipboardCache = '';


const hot = new Handsontable(container, {
    //data: getData(),
    data : ddata,
    licenseKey: 'non-commercial-and-evaluation', // for non-commercial use only
          rowHeaders: true,
          wordWrap: true,
          colHeaders: true,
          comments: true,
          manualColumnResize: true,
          manualRowResize: true,
          colWidths: [50,200,100,120,120, 120,120,120,120,100,  120,120,120,120,100,    20 ],
          undo: true,
          columns: columnsdata(0,16),
          contextMenu: {
            items:{
              "copy":{name:"Copier"},
              "cut":{name:'Couper'},
              "paste":{
                name: 'Coller (Utiliser <b>Ctrl + V</b> avec le clavier)',
                disabled:true
             }
            }
          },
          startRows: 6,
          startCols: 5,
          cells:(row,column)=>{
            var cellProperties = {};
            if(row<6){
              cellProperties.readOnly = true;
            }
            return cellProperties;
          },
          mergeCells: mergecellsarray,
          cell: normalcellloop(),
          hiddenColumns: {columns:[15]},
          DragToScroll: true,
          copyPaste: true,
          afterValidate: (oldvalue, row, prop, source, ...otherArgs) => {
            return afterValidatefct(oldvalue, row, prop, source, ...otherArgs, hot);
          },
          beforeKeyDown: (event, ...otherArgs) => {
            return beforeKeyDownfct(event, ...otherArgs, hot);
          },


       afterCreateRow: function(index, amount) {
        // Your custom logic goes here
        console.log('A new row has been added at index: ', index);
        console.log(amount)
        console.log(index)
        data22.push(['','','','','','',''])
        console.log(data22)
      },

       afterSelection: (r1, c1, r2, c2) => {
         var comment = hot.getCellMeta(r1, c1).comment;
         if (comment !== undefined) {
            var commentsPlugin = hot.getPlugin('comments');
           commentsPlugin.showAtCell(r1, c1);
           //return comment;
         } else {
            var commentsPlugin = hot.getPlugin('comments');
           commentsPlugin.hide();
         }
       },
     
        

 
});

hot.addHook('beforeChange', function(changes, source, ...otherArgs) {
  return beforeChangeFct(changes,source, ...otherArgs, hot)
});


hot.addHook('afterChange', function(changes, src, ...otherArgs) {
  return afterChangefct(changes,src, ...otherArgs, hot)
});



//console.log('hoooooooooooooot : ')
//let hota=hot;
//console.log(hota)

const downloadfile=()=>{

  var doc = new jsPDF({orientation:'landscape'});
  const table=return_table_to_downloading_Fct(hot)
  const { columnStyles, font_size } = edit_size_table_to_downloading_sadeg_Fct(table);

doc.autoTable({  // the complete width of the A4 landscape page is : 297 (i think the unit is by mm so 297mm x 210mm  or 210mm x 297mm)
               
                body:table,
                theme:'grid',
                margin:{left:7,right:4},         
                columnStyles: columnStyles,
                styles:{fontSize:font_size,
    textColor: [0, 0, 0], // Set text color to black
    lineColor: [0, 0, 0], // Set line color to black
    lineWidth: 0.1 // Set line width to 0.1 (adjust as needed)},
         },
    didParseCell:function(data){data.cell.styles.font = "helvetica";}
         
})
doc.save('taaa.pdf')
}


console.log('i will use downloadfile() : ')
downloadfile()


</script>

</body>
</html>



