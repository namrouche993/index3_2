<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
</style><!-- Ugly Hack due to jsFiddle issue -->

<!-- <script src="http://docs.handsontable.com/0.20.2/bower_components/handsontable/dist/handsontable.full.js"></script>
<link type="text/css" rel="stylesheet" href="http://docs.handsontable.com/0.20.2/bower_components/handsontable/dist/handsontable.full.min.css"> -->


<script src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css">

<script src="http://docs.handsontable.com/0.20.2/bower_components/numeraljs/languages/de.js"></script>
<script src="https://unpkg.com/sheetclip"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<script src="https://cdn.jsdelivr.net/npm/numbro@2.3.6/dist/numbro.min.js"></script>

<script src="jspdf.min.js"></script>
<script src="jspdf.plugin.autotable.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">

<script src="https://cdn.jsdelivr.net/npm/accounting/accounting.min.js"></script>
<script src='https://cdn.jsdelivr.net/npm/bignumber.js@9.1.0/bignumber.min.js'></script>



    <title>Document</title>
</head>
<body>
  <script src="http://code.jquery.com/jquery-2.0.3.min.js" ></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>


    <div id='toolbarid'>
        <button onclick="undohandstonetable()" class='material-symbols-outlined' style="font-size:18px;cursor:pointer;">undo</button>
        <button onclick="redohandstonetable()" class='material-symbols-outlined' style="font-size:18px;cursor:pointer;">redo</button>
        <button class='material-symbols-outlined' style="font-size:18px;cursor:pointer;">format_bold</button>   
        <button onclick="downloadfile()">Download</button>
        <button id="button-id">cliquer </button>


        <!-- <button  onclick="sendValue()" class='material-symbols-outlined' style="font-size:18px;cursor:pointer;">save</button> 
           <br>
        <button onclick="handleFct()" class='material-symbols-outlined' style="font-size:18px;cursor:pointer;">sync</button>        
      -->
          </div>

          
    <div id="example1" class="hot handsontable htColumnHeaders"></div>

<style>
    .handsontable .htCommentCell:after {
      content: "";
      position: absolute;
      top: 0;
      right: 0;
      left: unset;
      border-left: 20px solid transparent;
      border-right: none;
      border-top: 14px solid red;
    }

    .htCommentsContainer .htCommentTextArea {
      width: 320px;
      height: 60px;
    }

    
   .handsontable .htAutocompleteArrow {
            float: right;
            font-size: 10px;
            color: black;
            cursor: default;
            width: 16px;            
            text-align: center;
          }

          .text-right {
        text-align: right;
    }

div#toolbarid {
    position: fixed;
    top: 1%;
}

div#example1 {
    margin-top: 38px;
}
    .handsontable table thead th{
   color: black;
   font-size: 12px;
   font-family: sans-serif;
   }

   .handsontable{
     font-size: 12px;
     font-family: Roboto;
   }

   td.custom-titlecell {
     background-color: rgb(204,204,204);
     font-weight: bold;
     border-left: 1px solid black;
     border-right: 0px solid black;
     border-top: 1px solid black;
     border-bottom: 1px solid black;
     color: black;

   }

   td.custom-titlecell2 {
     background-color: rgb(204,204,204);
     font-weight: bold;
     border-left: 1px solid black;
     border-right: 0px solid black;
     border-top: 1px solid black;
     border-bottom: 1px solid black;
     color: black;
   }


   
   td.custom-normalcell {
     border-left: 1px solid black;
     border-right: 0px solid black;
     border-top: 0px solid black;
     border-bottom: 1px solid black;
     color: black;

   }


 .handsontable .htDimmed {
  color: black;
}

   
</style>
<script>

const currencyht_nbnb = '$' //'DA'
    const currencyht_toshow_nbnb = '' // ' $' // ' DA'  ///
    const afterdigit_nbnb = 2;
    const smallafterdigit_nbnb = Number(`1e-${afterdigit_nbnb}`)  // like 0.01 with afterdigit2
    const afterdigitsmallnb_nbnb = 17;
    const bignb_nbnb = 1e17;
    const smallnb_nbnb = 1e-17;
    const decimalnumbers_toshow_withoutrenderer_innumbers_nbnb = 10;
    const usegrouping_nbnb_if_true = true;
    const is_negativenb_accepted_nbnb=true;
    // const is_float_accepted_nbnb = true;  // bayna beli true


    const currencyht_intint = '' //'DA'
    const currencyht_toshow_intint = '' // ' $' // ' DA'  ///
    const afterdigit_intint = 0;
    const smallafterdigit_intint = Number(`1e-${afterdigit_intint}`)  // like 0.01 with afterdigit2
    const afterdigitsmallnb_intint = 17;
    const bignb_intint = 1e17;
    const smallnb_intint = 1e-17;
    const decimalnumbers_toshow_withoutrenderer_innumbers_intint = 2;
    const usegrouping_intint_if_true = false;
    const is_negativenb_accepted_intint = false;
    const is_float_accepted_intint = false;



    const afterdigit_percentage_percperc = 2; //  how many decimal numbers will be displayed in renderer !
    const smallafterdigit_percentage_percperc = Number(`1e-${afterdigit_percentage_percperc}`)  // like 0.01 with afterdigit2 ,  even though the value is small than this number , so displays it in renderer
    const afterdigitsmallnb_percentage_percperc = 10; // even though the number is too small than the previous number (0.01) and it small than this number, so don't display it , and instead of it , display 0 because of maximumFractionDigits=this number
    const bignbpercent_percperc = 1e10;
    const smallnbpercent_percperc = 1e-10;
    const decimalnumbers_toshow_withoutrenderer_inpercentage_percperc=10;
    const is_negativenb_accepted_percperc = true;
    const is_float_accepted_percperc = true;

    const emails_length_em=30;
    const phonenumbers_length_pn=20;
    const onlynumbers_length_on = 20;


    //#region date time zone (navigator.language)
    const userLocale = 'fr'// editable maybe Intl.DateTimeFormat().resolvedOptions().locale || navigator.language || navigator.userLanguage;
    const navigator_language=navigator.language // 'fr-FR' 'en-CA'  // editable
    var userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
    var usTimeZones = [  'America/New_York',  'America/Chicago',  'America/Denver',  'America/Los_Angeles',  'America/Anchorage',  'America/Adak',  'Pacific/Honolulu',  'America/Phoenix',  'America/Indiana/Indianapolis',  'America/Indiana/Knox',  'America/Indiana/Marengo',  'America/Indiana/Petersburg',  'America/Indiana/Tell_City',  'America/Indiana/Vevay',  'America/Indiana/Vincennes',  'America/Indiana/Winamac',  'America/Kentucky/Louisville',  'America/Kentucky/Monticello',  'America/Detroit',  'America/Menominee',  'America/St_Johns',  'America/Puerto_Rico',  'America/Montserrat',  'America/New_York',  'America/North_Dakota/Beulah',  'America/North_Dakota/Center',  'America/North_Dakota/New_Salem'];
    //#endregion date time zone


    function isValidDate(dateStr,splitsign,ndays,nmonths,nyears) {
  const datestr2 = dateStr.split(splitsign);
  const day = parseInt(datestr2[Number(ndays)-1]);
  const month = parseInt(datestr2[Number(nmonths)-1]);
  const year = parseInt(datestr2[Number(nyears)-1]);
  const parsedMonth = parseInt(month);
  const parsedDay = parseInt(day);
  const parsedYear = parseInt(year);

  if ( isNaN(day) || isNaN(month) || isNaN(year) ){
      return false;
  }
  // Check if year is within the allowed range
  if (parsedYear < 1000 || parsedYear>3000) {
    return false;
  }

  // Check if month is valid
  if (parsedMonth < 1 || parsedMonth > 12) {
    return false;
  }

  // Check if day is valid for the given month and year
  const daysInMonth = new Date(parsedYear, parsedMonth, 0).getDate();
  if (parsedDay < 1 || parsedDay > daysInMonth) {
    return false;
  }

  // If all checks pass, return true
  return true;
}

  //#region decimalseparator and thousand separator 
    const options = { style: 'decimal' };
    const formattedNumber = (1234567.73).toLocaleString(userLocale, options);
    const DecimalSeparator0 = formattedNumber.substring(9, 10)
    decimalSeparator = DecimalSeparator0
    const thousandSeparator00 = formattedNumber.substring(1, 2);
    thousandSeparator0 = thousandSeparator00
    console.log('decimal separateur est :' + decimalSeparator +
      ' et thousand est :' + thousandSeparator0 +
      'et le nombre devients :' + formattedNumber)
   //#endregion decimalseparator and thousand separator 


    let lastelement_supthan1=0;

    const comments_messages = function(value,msg,language){
    if(msg=='error'){
      if(language=='fr-FR'){
        var mm = "la valeur '" + value + "' n'est pas valide ";
        return mm;

      } else if (language=='en-US'){
        var mm = "The value '" + value + "' is not valid.";
        return mm;
      }
    }
    else if (msg=='val_try_to_fix'){
      if(language=='fr-FR'){
        var mm = "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres";
        return mm;
      } else if (language=='en-US'){

      }
      // ---------------- # date_correct msg # ----------------
      // ---------------- # date_correct msg # ----------------
      // ---------------- # date_correct msg # ----------------

    }
    else if (msg=='val_try_to_fix_comma_instead_dot'){
      if(language=='fr-FR'){
        var mm = "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + value.replace(/\s+/g, '').trim().replace('.', ',') + " est correct (virguale à la place du point).";
        return mm;

      } else if (language=='en-US'){
        var mm = "The value '" + value + "' is not valid. Try correcting the formatting according to your parameters. | " + value.replace(/\s+/g, '').trim().replace('.', ',') + " is correct (comma instead of a dot).";
        return mm;

      }
    } 
    else if (msg=='val_try_to_fix_dot_instead_comma'){
      if(language=='fr-FR'){
      var mm = "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + value.replace(/\s+/g, '').trim().replace(',', '.') + " est correct (point à la place de la virgule)";
      return mm;
      } else if (language=='en-US'){
        var mm = "The value '" + value + "' is not valid. Try correcting the formatting according to your parameters. | " + value.replace(/\s+/g, '').trim().replace(',', '.') + " is correct (dot instead of a comma).";
        return mm;
      }
    }
    else if (msg=='val_try_to_fix_4'){
      if(language=='fr-FR'){
        var mm = "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + Number(value).toLocaleString(userLocale) + " est correct";
        return mm;
      } else if (language=='en-US'){
        var mm = "The value '" + value + "' is not valid. Try correcting the formatting according to your parameters. | " + Number(value).toLocaleString(userLocale) + " is correct.";
        return mm;
      }
    }
    else if (msg=='val_try_to_fix_5'){
      if(language=='fr-FR'){
        var mm = "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + value.trim().replace(',', '.') + " est correct";
        return mm;
      } else if (language=='en-US'){
        var mm = "The value '" + value + "' is not valid. Try correcting the formatting according to your parameters. | " + value.trim().replace(',', '.') + " is correct.";
        return mm;
      }
    }
    else if (msg=='val_try_to_fix_6'){
      if(language=='fr-FR'){
        var mm =  "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + Number(value.replace(/,/g, '')).toLocaleString(userLocale) + " est correct";
        return mm;
      } else if (language=='en-US'){
        var mm = "The value '" + value + "' is not valid. Try correcting the formatting according to your parameters. | " + Number(value.replace(/,/g, '')).toLocaleString(userLocale) + " is correct.";
        return mm;
      }
    }
    else if (msg=='val_try_to_fix_fill_only_numbers'){
      if(language=='fr-FR'){
        var mm =  "la valeur '" + value + "' n'est pas valide pour cette cellule. Veuillez saisir uniquement des valeurs numériques";
        return mm;
      } else if (language=='en-US'){
        var mm = "The value '" + value + "' is not valid for this cell. Please enter only numeric values.";
        return mm;
      }
    }
    else if (msg=='val_try_to_fix_8'){
      if(language=='fr-FR'){
        var mm = "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + value.trim().replace(/\./g, '').replace(',', '.') + " est correct";
        return mm;
      } else if (language=='en-US'){
        var mm = "The value '" + value + "' is not valid. Try correcting the formatting according to your parameters. | " + value.trim().replace(/./g, '').replace(',', '.') + " is correct.";
        return mm;
      }
    }
    else if (msg=='date_try_to_fix') {
      if(language=='fr-FR'){
        var mm = "la date '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  ";
        return mm;

      } else if (language=='en-US'){
        var mm = "The date '" + value + "' is not valid. Try correcting the formatting according to your parameters.";
        return mm;
      }
      // ---------------- # date_no_valid msg # ----------------
      // ---------------- # date_no_valid msg # ----------------
      // ---------------- # date_no_valid msg # ----------------
    }
    else if (msg=='date_no_valid') {
      if(language=='fr-FR'){
        var mm = "la date '" + value + "' n'est pas valide ";
        return mm;

      } else if (language=='en-US'){
        var mm = "The date '" + value + "' is not valid.";
        return mm;
      }
    }
    else if (msg=='val_no_valid') {
      if(language=='fr-FR'){
        var mm = "la valeur '" + value + "' n'est pas valide ";
        return mm;

      } else if (language=='en-US'){
        var mm = "The value '" + value + "' is not valid.";
        return mm;
      }

    }
    else if (msg=='limit_autor') {
          // ---------------- # limite_autorise msg # ----------------
      // ---------------- # limite_autorise msg # ----------------
      // ---------------- # limite_autorise msg # ----------------
      if(language=='fr-FR'){
        var mm = "La valeur que vous avez saisie dépasse la limite autorisée !!";
        return mm;

      } else if (language=='en-US'){
        var mm = "The value you entered exceeds the allowed limit!";
        return mm;
      }

    }
    else if (msg=='dropdown_included') {
      if(language=='fr-FR'){
        var mm = "Veuillez choisir une valeur incluse dans la liste";
        return mm;

      } else if (language=='en-US'){
        var mm = "Please choose a value included in the list.";
        return mm;
      }
    }
    else if (msg=='percentage_no_valid_isvalidfalse_end') {
      if(language=='fr-FR'){
        var mm = "la valeur '" + value + "' n'est pas valide, Veuillez entrer uniquement des pourcentages. ";
        return mm;

      } else if (language=='en-US'){
        var mm = "The value '" + value + "' is not valid, Please enter only percentages";
        return mm;
      }
    }
    else if (msg=='refuse_negative'){
      if(language=='fr-FR'){
        var mm = "Attention : La valeur que vous avez saisie est négative, Veuillez saisir un nombre supérieur à zéro. ";
        return mm;

      } else if (language=='en-US'){
        var mm = "Warning: The value you entered is negative. Please enter a number greater than zero.";
        return mm;
      }
    }
    else if (msg=='refuse_float'){
      if(language=='fr-FR'){
        var mm = "Veuillez saisir un nombre entier et non un nombre décimal. (pas de virgule) ";
        return mm;

      } else if (language=='en-US'){
        var mm = "Please enter an integer value, not a decimal number.";
        return mm;
      }
    }
      else if (msg=='email_invalid'){
      if(language=='fr-FR'){
        var mm = "Veuillez entrer une adresse email valide.";
        return mm;

      } else if (language=='en-US'){
        var mm = "Please enter a valid email address.";
        return mm;
      }
    }
    else if (msg=='phonenumbers_invalid'){
      if(language=='fr-FR'){
        var mm = "Veuillez entrer un numéro de téléphone valide.";
        return mm;

      } else if (language=='en-US'){
        var mm = "Please enter a valid phone number.";
        return mm;
      }
    }
    else if (msg=='onlynumbers_invalid'){
      if(language=='fr-FR'){
        var mm = "Veuillez saisir des nombres.";
        return mm;

      } else if (language=='en-US'){
        var mm = "Please enter numbers only..";
        return mm;
      }
    }

    
    
  }
  
   

//#region date format starting
      if(navigator_language=='en-US'){
    if(usTimeZones.includes(userTimeZone)){
      var dateformatlanguage = 'mm/dd/aaaa'; 
      var splitdate='/';
    } else {
      var dateformatlanguage = 'jj/mm/aaaa' // 'mm/dd/yyyy'; // 12/31/1990 edit it later , modify it later  , change it later
      var splitdate='/';
      //var [monthdate,daydate, yeardate] = dateformatlanguage.split(splitdate);
    }
    } else if(navigator_language=='ko-KR' || navigator_language=='hu-HU'){
      var dateformatlanguage = 'aaaa.mm.jj' // 'yyyy.mm.dd' // 1990.12.31
      var splitdate='.';
      //var [yeardate,monthdate,daydate] = dateformatlanguage.split(splitdate);

    } else if(navigator_language=='ja-JP' || navigator_language=='ZH-CN'){
      var dateformatlanguage = 'aaaa/mm/jj' //'yyyy/mm/dd' // 1990/12/31
      var splitdate='/';
      //var [yeardate,monthdate,daydate] = dateformatlanguage.split(splitdate);

    } else if(navigator_language=='en-CA'){
      var dateformatlanguage = 'aaaa-mm-jj' //'yyyy-mm-dd' // 1990-12-31
      var splitdate='-';
      //var [yeardate,monthdate,daydate] = dateformatlanguage.split(splitdate);

    } else if(navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR'){
      var dateformatlanguage = 'jj.mm.aaaa' //'dd.mm.yyyy' // 12.31.1990
      var splitdate='.';
      //var [daydate,monthdate,yeardate] = dateformatlanguage.split(splitdate);

    } else {
      // european and other formats
      var dateformatlanguage = 'jj/mm/aaaa' // 'dd/mm/yyyy' // 31/12/1990
      var splitdate='/';
      //var [daydate,monthdate,yeardate] = dateformatlanguage.split(splitdate);
    }
    //#endregion date format starting


      class PercentageEditor extends Handsontable.editors.TextEditor {
  open() {
    super.open();
    const value = this.getValue();
    if (!value.endsWith('%')) { // check if the value doesn't already end with a percent sign
      this.TEXTAREA.value += '%'; // add a "%" sign to the initial value
    }
  }

  setValue(value) {
      try {
        var percentValue = value.replace(/%/g, '') + '%' || ''; // remove existing "%" signs and add a new one
       } catch (error) {
        var percentValue = '';
      }
    //const percentValue = value.replace(/%/g, '') + '%'; // remove existing "%" signs and add a new one
    super.setValue(percentValue);
  }
  
  close() {
    super.close();
    const value = this.getValue();
    if (value.endsWith('%')) { // check if the value ends with a percent sign
      this.TEXTAREA.value = value.slice(0, -1); // remove the last character (the percent sign)
    }
  }

  focus() {
    super.focus();
    const length = this.TEXTAREA.value.length;
    this.TEXTAREA.setSelectionRange(0, length - 1); // set the cursor position at the end of the value
  }
}
 
function isAccountingFormatted(value) {   // i think it's useless and it will be removed
  const regex = /^\D*\d{1,3}([\s,]\d{3})*\,\d{2}$/; // Matches strings like "€ 1 234,56"
  return typeof value === 'string' && regex.test(value);
}

var skiformat = [];

  const warningpopup = ()=>{
        toastr.options = {
          "timeOut": 2000,
          "positionClass": "toast-bottom-right",

        };
        toastr.warning('Hello World!', 'Notification Title');
      }

  let numOferrorPopups = 0;

  const errorpopup = ()=>{
        if (numOferrorPopups >= 4) {
              return;
           }           
  toastr.options = {
    onHidden: function() {
      numOferrorPopups--;
      console.log(`Number of popups: ${numOferrorPopups}`);
    },
    "timeOut": 2500,
    "positionClass": "toast-bottom-right",
  };
  toastr.error('Veuillez entrer un nombre', 'Erreur');
  numOferrorPopups++;
  console.log(`Number of popups: ${numOferrorPopups}`);
      }


function existsInArray(array, pair) {
    for (let i = 0; i < array.length; i++) {
      if (array[i][0] === pair[0] && array[i][1] === pair[1]) {
        return true;
      }
    }
    return false;
  }
  
  
      
      
      function undohandstonetable() {
          hot.undo(true);
      }
      function redohandstonetable() {
          hot.redo(false);

      }
      

      const last_row_after_header = 15;
      
                 
            var ddata= [];
            ddata.push(  
            ['','Etat ','','','','','','','','','','','','','','','',   ''],
            ['','Etat2','','','','','','','','','','','','','','','',   ''],
            ['','Etat333','','','','','','','','','','','','','','','',   ''],
            ['','Etat444','','','','','','','','','','','','','','','','',   ''],
            //['','','','','','','','','','','','','','','','','',''],
            //[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],
            ['','Projet','Consistance de Projet',"Taux d'avancement des travaux logement","Taux d'avancement des travaux VRD",'Raccordement en énergie Electrique','','','','','Raccordement en énergie Gaziere','','','','',   ''],
            ['','','','','',"Taux d'avancement des travaux",'Montant des travaux (devis SADEG)','Montant payé (DA)','Créances détenues travaux','Contraintes',"Taux d'avancement des travaux",'Montant des travaux (devis SADEG)','Montant payé (DA)','Créances détenues travaux','Contraintes',   ''],
            ['','','','','','','','','','','','','','','','','',   ''],
            ['','','','','','','','','','','','','','','','','',   '']       
            //['','','','','','','','','','','','','','','','','','',   '']            

            
            
            ) 
        
        for(i=0 ; i<=last_row_after_header ; i++) {
          zzrow=['','','','','','','','','','','','','','','','','',   '']
          ddata.push(zzrow);
        }

        console.log('ddata egale a : ')
        console.log(ddata)
        //return dd
        // }
        const data22 = ddata.map(arr => [...arr]);


var container = document.getElementById('example1')
var sheetclip = new SheetClip();
var clipboardCache = '';

var normalcellloop = (imin,imax)=>{
  const aus = [
    { row: 0, col: 1, className: 'htCenter htMiddle' },  // Etat
    { row: 1, col: 1, className: 'htCenter htMiddle' },  // Etat2
    { row: 2, col: 1, className: 'htCenter htMiddle' },  // Etat333
    { row: 3, col: 1, className: 'htLeft htMiddle' },    // Etat444


    { row: 4, col: 1, className: 'htCenter htMiddle custom-titlecell' },
    { row: 4, col: 2, className: 'htCenter htMiddle custom-titlecell' },
    { row: 4, col: 3, className: 'htCenter htMiddle custom-titlecell' },
    { row: 4, col: 4, className: 'htCenter htMiddle custom-titlecell' },
    { row: 4, col: 5, className: 'htCenter htMiddle custom-titlecell' },
    { row: 4, col: 10, className: 'htCenter htMiddle custom-titlecell' },

    { row: 5, col: 1, className: 'htCenter htMiddle custom-titlecell2' },
    { row: 5, col: 2, className: 'htCenter htMiddle custom-titlecell2' },
    { row: 5, col: 3, className: 'htCenter htMiddle custom-titlecell2' },
    { row: 5, col: 4, className: 'htCenter htMiddle custom-titlecell2' },
    
    { row: 5, col: 5, className: 'htCenter htMiddle custom-titlecell2' },
    { row: 5, col: 6, className: 'htCenter htMiddle custom-titlecell2' },
    { row: 5, col: 7, className: 'htCenter htMiddle custom-titlecell2' },
    { row: 5, col: 8, className: 'htCenter htMiddle custom-titlecell2' },
    { row: 5, col: 9, className: 'htCenter htMiddle custom-titlecell2' },
    //{ row: 5, col: 10, className: 'htCenter htMiddle custom-titlecell2' },

    
    { row: 5, col: 10, className: 'htCenter htMiddle custom-titlecell2' },
    { row: 5, col: 11, className: 'htCenter htMiddle custom-titlecell2' },
    { row: 5, col: 12, className: 'htCenter htMiddle custom-titlecell2' },
    { row: 5, col: 13, className: 'htCenter htMiddle custom-titlecell2' },
    { row: 5, col: 14, className: 'htCenter htMiddle custom-titlecell2' },
    //{ row: 5, col: 16, className: 'htCenter htMiddle custom-titlecell2' },
  ];

  for(i=imin ; i<=imax ; i++) {
    for(j=1 ; j<=14 ; j++){
      if(j==2){  // which column text align is center
        zz={ row: i, col: j, className: 'htCenter htMiddle custom-normalcell' };
        aus.push(zz);
      } else {
        zz={ row: i, col: j, className: 'htLeft htMiddle custom-normalcell' };
        aus.push(zz);
      }
            }
  }
  return aus
}




var columnsdata = (imin,imax) => {
  fa=[]
  fa.push({data:0,readOnly:true})
    //,type:'numeric'})
    const rr = this.row;
    const cc = this.col;

    for(i=imin+1;i<imax-1;i++){
    // couting start from 1 (normal way ta3 normal way)  i==3 means the third column of THE SPREADSHEET without counting the first negeglible column (A)   
  
  if(i == 2){ 
      dd={ data:i,
        className: "htRight htMiddle" ,
        validator: function (oldvalue, callback) { // validator of integers
            const thisrow = this.row;
            const thiscol = this.col;
            //const value = oldvalue.replace(regexcurrenciesht, '');
            console.log('validator')
            console.log(oldvalue)
            console.log('validator is :' + oldvalue + 'and then')
            console.log(oldvalue=='')
            console.log(oldvalue==='')
        if(thisrow>5){
             if (oldvalue != null) {//|| oldvalue.toString()!==null){
               var value = oldvalue.toString().replace(currencyht_intint, '');
               console.log('new VALuE in afterValidator is : ' + value)
             } else {
               console.log('we are inside validator oldvalue==null')
               var value = null;
             }

            //var value = oldvalue;

            //   const value = oldvalue.replace(currencyht_intint,'') ;
            // console.log('new VALuE in validator is : ' +  value);

            if (value == null ||
              /^\s*[-+]?(\s*\d+)\s*$/.test(value) || // /^\s*[-+]?(\d+)\s*$/.test(value) || // when the value is whole number like 45 1987 2 36 ... // /^\s*[-+]?(\d+)\s*\$?\s*$/.test("  1235$  ")
              /^\s*[-+]?(\s*\d+(\.\d*)?|\.\d+)\s*$/.test(value) || //1234567.89 (BY DEFAULT VALUE) AMERICAN NUMERIC FORMAT WITHOUT THOUSAND SEPARATOR
              /^\s*[-+]?(\s*\d+(,\d*)?|,\d+)\s*$/.test(value) || //1234567,89 EUROPEAN NUMERIC FORMAT WITHOUT THOUSAND SEPARATOR
              /^\s*[-+]?(\s*\d{1,3}( \d{3})*(,\d*)?|,\d+)\s*$/.test(value) || // 1 234 567,89 FRENCH NUMERIC FORMAT WITH THOUSAND SEPARATOR as space
              /^\s*[-+]?(\s*\d{1,3}(,\d{3})*(\.\d+)?|\.\d+)\s*$/.test(value) || // 1,234,567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as comma
              /^\s*[-+]?(\s*\d{1,3}(?:\.\d{3})+(?:,\d+)?)\s*(?=\s|$)/.test(value) || // 1.234.567,89 EUROPEAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as dot /^\s*[-+]?(\d{1,3}(?:[.,\s]\d{3})*(?:,\d+)?)\s*$/
              /^\s*[-+]?(\s*\d{1,3}( \d{3})*(\.\d*)?|\.\d+)\s*$/.test(value) ||   // 1 234 567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as space
              /^\s*[-+]?[\s]*[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value) || // 1.6e6 1.60E+04  -13.65E4  - 12.3E+03  scientific notation with E sign
              /^\s*[-+]?[\s]*[0-9]*,?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value)    // 1,6e6 1,60E+04  -13,65E4  - 12.3E+03  scientific notation with E sign


            ) {
              console.log('it returns true in validator')
              if (value !== oldvalue) {
                console.log('it returns true inside validator and value != oldvalud')
                //callback(true,
                //  hot.setDataAtCell(thisrow, thiscol, value)
                //)
                callback(true)
                //hot.setDataAtCell(row,prop,this.getData()[row][prop])
              } else {
                callback(true)
              }
            } else {
              console.log('we are in callback false')
              callback(false);
            }
          }
          },

        renderer: function (instance, td, row, col, prop, oldvalue, cellProperties) { // renderer of integers
              if(row>5){  // editable
               if (oldvalue !== null) {
                 var value = oldvalue.toString().replace(currencyht_intint, '');
               } else {
                 var value = null
               }

              //var value=oldvalue;

              if (value == null || value == '') {
                td.innerHTML = ''
                data22[row][col] = td.innerHTML;
              }
               else if (decimalSeparator == "." && /^\s*[-+]?(\s*\d+)\s*$/.test(value)) {
                console.log('we are inside renderer . whole number . !!')
                console.log(value)
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_intint_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_intint,
                  maximumFractionDigits: afterdigit_intint,
                });
                const value_without_whitespace = value.replace(/^\s*([-+])?\s*(\d+)\s*$/, '$1$2');
                const formattedNumber = formatter.format(Number(value_without_whitespace));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_intint;
                data22[row][col] = td.innerHTML;

              }
               else if (decimalSeparator == "," && /^\s*[-+]?(\s*\d+)\s*$/.test(value)) {
                console.log('we are inside renderer , whole number , !!')
                console.log(value)
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_intint_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_intint,
                  maximumFractionDigits: afterdigit_intint,
                });
                const value_without_whitespace = value.replace(/^\s*([-+])?\s*(\d+)\s*$/, '$1$2');
                const formattedNumber = formatter.format(Number(value_without_whitespace));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_intint;
                console.log('td : ')
                console.log(td)
                data22[row][col] = td.innerHTML;


              }
               else if (decimalSeparator == '.' && /^\s*[-+]?(\s*\d+(\.\d*)?|\.\d+)\s*$/.test(value)) {
                console.log('we are inside rendere 1')
                console.log('//1234567.89 (BY DEFAULT VALUE) AMERICAN NUMERIC FORMAT WITHOUT THOUSAND SEPARATOR')
                console.log(value)
                const value_without_whitespace2 = value.replace(/^\s*([-+])\s*(\d+)/, '$1$2');

                //const userLocale = Intl.NumberFormat().resolvedOptions().locale || 'fr' || 'en'
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_intint_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_intint,
                  maximumFractionDigits: afterdigit_intint,
                }); //('en')
                if (Math.abs(Number(value_without_whitespace2)) < smallafterdigit_intint) {
                  const formatter22 = new Intl.NumberFormat(userLocale, {
                    useGrouping: usegrouping_intint_if_true,
                    style: 'decimal',
                    maximumFractionDigits: afterdigitsmallnb_intint,
                  });
                  const formattedNumber22 = formatter22.format(value_without_whitespace2);
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber22 + currencyht_toshow_intint
                  console.log('we are inside td.innerhtml < 0.01')
                  data22[row][col] = td.innerHTML;

                } else {
                  console.log('we are inside . and default and else (number value>0.01)')
                  const formattedNumber = formatter.format(Number(value_without_whitespace2));
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber + currencyht_toshow_intint;
                  data22[row][col] = td.innerHTML;

                }

                console.log(td.innerHTML)
              }
               else if (decimalSeparator == ',' && /^\s*[-+]?(\s*\d+(,\d*)?|,\d+)\s*$/.test(value)) {
                console.log('we are inside rendere 2')
                console.log('we are inside decimalseparator == , and ezaoeza ')
                console.log('//1234567,89 EUROPEAN FORMAT NUMERIC FORMAT WITHOUT THOUSAND')
                //const userLocale = Intl.NumberFormat().resolvedOptions().locale || 'fr' || 'en'
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_intint_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_intint,
                  maximumFractionDigits: afterdigit_intint,
                });
                const value_without_whitespace3 = value.replace(/^\s*([-+])\s*(\d+)/, '$1$2');

                console.log('value in second :')
                console.log(value_without_whitespace3)
                const value_without_whitespace32 = value_without_whitespace3.toString().replace(',', '.')
                //console.log('value2 :')
                //console.log(value2)
                console.log(Number(value_without_whitespace32))

                if (Math.abs(Number(value_without_whitespace32)) < smallafterdigit_intint) {
                  console.log('ifnumbervalue2222<0.01 comma')
                  console.log(Number(value_without_whitespace32))
                  const formatter33 = new Intl.NumberFormat(userLocale, {
                    useGrouping: usegrouping_intint_if_true,
                    style: 'decimal',
                    maximumFractionDigits: afterdigitsmallnb_intint,
                  });
                  const formattedNumber33 = formatter33.format(value_without_whitespace32);
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber33 + currencyht_toshow_intint;
                  data22[row][col] = td.innerHTML;

                } else {
                  const formattedNumber = formatter.format(value_without_whitespace32);
                  console.log(formattedNumber)

                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber + currencyht_toshow_intint;
                  data22[row][col] = td.innerHTML;

                }

              }
               else if (decimalSeparator == ',' && /^\s*[-+]?(\s*\d{1,3}( \d{3})*(,\d*)?|,\d+)\s*$/.test(value)) {
                console.log('we are inside rendere 3')
                console.log('we are inside else if 300 000,00')
                console.log('// 1 234 567,89 FRENCH NUMERIC FORMAT WITH THOUSAND SEPARATOR')

                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_intint_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_intint,
                  maximumFractionDigits: afterdigit_intint,
                });
                const value3 = value.replace(/\s/g, '').replace(',', '.');
                const formattedNumber = formatter.format(Number(value3).toFixed(2));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_intint;
                data22[row][col] = td.innerHTML;


              }
               else if (decimalSeparator == '.' && /^\s*[-+]?(\s*\d{1,3}(,\d{3})*(\.\d+)?|\.\d+)\s*$/.test(value)) {
                console.log('we are inside rendere 4')
                console.log('5,455,653.35 ')
                console.log('// 1,234,567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR')
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_intint_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_intint,
                  maximumFractionDigits: afterdigit_intint,
                });
                console.log('value in rendere 4 ')
                console.log(value)
                const value4 = value.replace(/,/g, '')
               console.log(hot.undoRedo.doneActions)
            /*    if(hot.undoRedo.doneActions.length>0){
                  
                hot.undoRedo.doneActions[hot.undoRedo.doneActions.length - 1].changes.forEach((x, y) => {
                  console.log('we are inside foreach in renderer')
                   if (x[0] == row && x[1] == col) {
                  console.log('we are inside condition renderer')
                  //x[3] = value4
                }
                })
                
              }*/
              //  hot.undoRedo.doneActions[hot.undoRedo.doneActions.length-1].changes[0][2]='820'
               // if(src=='CopyPaste.paste'){
               // console.log('inside copypaste.paste source in afterchange')
               // console.log(changes)
               //console.log(hot.undoRedo.doneActions[hot.undoRedo.doneActions.length-1].changes[0][2]='82')
               // }
               console.log('value4:') 
               console.log(value4)
                const formattedNumber = formatter.format(Number(value4).toFixed(2));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_intint;
                data22[row][col] = td.innerHTML;


              }
               else if (decimalSeparator == ',' && /^\s*[-+]?(\s*\d{1,3}(?:\.\d{3})+(?:,\d+)?)\s*(?=\s|$)/.test(value)) {
                // 1.234.567,89 EUROPEAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as dot
                console.log('we are inside rendere 5')
                console.log('5.300.000,00')
                console.log('// 1.234.567,89 EUROPEAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as dot')
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_intint_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_intint,
                  maximumFractionDigits: afterdigit_intint,
                });
                const value_without_whitespace4 = value.replace(/^\s*([-+])\s*(\d+)/, '$1$2')
                const value_without_whitespace45 = value_without_whitespace4.trim().replace(/\./g, '').replace(',', '.')
                //const value5 = value.trim().replace(/\./g, '')

                const formattedNumber = formatter.format(Number(value_without_whitespace45).toFixed(2));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_intint;
                data22[row][col] = td.innerHTML;

              } 
              else if (decimalSeparator == '.' && /^\s*[-+]?(\s*\d{1,3}( \d{3})*(\.\d*)?|\.\d+)\s*$/.test(value)) {
                console.log('we are inside rendere 6')
                console.log('we are inside else if 300 000.00')
                console.log('// 1 234 567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR')

                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_intint_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_intint,
                  maximumFractionDigits: afterdigit_intint,
                });
                const value6 = value.replace(/\s/g, '');
                const formattedNumber = formatter.format(Number(value6).toFixed(2));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_intint;
                data22[row][col] = td.innerHTML;

              }
               else if (decimalSeparator == '.' && /^\s*[-+]?[\s]*[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value)) {
                console.log('we are inside rendere 7')
                console.log('we are inside scientific notation :');
                console.log('// 1.6e6 1.60E+04  -13.65E4  - 12.3E+03  scientific notation with E sign');
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_intint_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_intint,
                  maximumFractionDigits: afterdigit_intint,
                });
                const value7 = parseFloat(value.replace(/\s/g, ''));
                const formattedNumber = formatter.format(Number(value7));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_intint;
                data22[row][col] = td.innerHTML;

              }
               else if (decimalSeparator == ',' && /^\s*[-+]?[\s]*[0-9]*,?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value)) {
                //console.log('----------------------------------------rendere 8 ---------------------------------------- rendere 8 ------------------------')
                console.log('we are inside rendere 8')
                console.log('we are inside scientific notation with comma :');
                console.log('// 1,6e6 1,60E+04  -13,65E4  - 12,3E+03  scientific notation with E sign');
                console.log('value inside scientific notation with comma else if : ')
                const value8 = parseFloat(value.replace(',', '.').replace(/\s/g, ''));
                console.log('value8 : ')
                console.log(value8)

                if (Math.abs(Number(value8)) < smallafterdigit_intint) {
                  console.log('ifnumbervalue2222<0.01 comma sceintific number')
                  console.log(Number(value8))
                  const formatter88 = new Intl.NumberFormat(userLocale, {
                    useGrouping: usegrouping_intint_if_true,
                    style: 'decimal',
                    maximumFractionDigits: afterdigitsmallnb_intint,
                  });
                  const formattedNumber88 = formatter88.format(value8);
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber88 + currencyht_toshow_intint;
                  data22[row][col] = td.innerHTML;

                } else {
                  const formatter = new Intl.NumberFormat(userLocale, {
                    useGrouping: usegrouping_intint_if_true,
                    style: 'decimal',
                    minimumFractionDigits: afterdigit_intint,
                    maximumFractionDigits: afterdigit_intint,
                  });
                  const formattedNumber = formatter.format(Number(value8));
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber + currencyht_toshow_intint;
                  console.log(td.innerHTML)
                  data22[row][col] = td.innerHTML;

                }
              } 
              else {
                console.log('WE ARE INSIDE LAST ELSE RENDERER')
              }
            
            td.className = 'htLeft htMiddle custom-normalcell'
            //td.innerHTML=''
              } else {
                if(row>3){ // editable
                //td.innerHTML = '<b>' + oldvalue + '</b>';
                td.innerHTML=oldvalue;
                data22[row][col] = td.innerHTML;      
                td.className = 'htCenter htMiddle custom-titlecell2';
                //td.style.fontWeight = 900;
                //td.style.textAlign = 'left';
              }
            }
            }
  }
  }
  if(i == 3 || i == 4    || i == 5   || i == 10 ){ 
      dd={ data:i,
        className: "htRight htMiddle" ,
          editor: PercentageEditor,
          validator: function (value, callback) { // validator of percentage
            const thisrow = this.row;
            const thiscol = this.col;
            //const value = oldvalue.replace(regexcurrenciesht, '');
            console.log('validator in percentage')
            console.log(value)
            if(thisrow>5){
            if (value == null || // value == '' ||
              /^[-+]?(\s*\d+(\.\d+)?)\s*%$/.test(value.toString().trim()) || // for example 14.65%  "14.65 %"  
              /^[-+]?(\s*\d+(,\d+)?)\s*%$/.test(value.toString().trim()) || // for example 14,65%   "14,65 %"
              
              /^[-+]?(\s*\d+(\.\d+)?)\s*$/.test(value.toString().trim()) || // for example 14.65  "14.65 "  
              /^[-+]?(\s*\d+(,\d+)?)\s*$/.test(value.toString().trim()) // for example 14,65   "14,65 "
            ) {
              console.log('it returns true in percentage validator')             
              callback(true)              
            } else {
              console.log('we are in callback false percentage validator')
              callback(false);
            }
          }
          },
          renderer: function (instance, td, row, col, prop, oldvalue, cellProperties) { // renderer of numbers or amounts
            //console.log('renderer percentage start')
            if(row>5){  // editable

            if (oldvalue==null){
            //console.log('renderer percentage 0 part')
            td.innerHTML='';
            data22[row][col] = td.innerHTML;      
            cellProperties.className = 'htRight'; 
            td.style.textAlign = 'right';
            }
             else if( //oldvalue == null || // value == '' ||
              /^[-+]?(\s*\d+(\.\d+)?)\s*%$/.test(oldvalue.toString().trim()) || // for example 14.65%  "14.65 %"  
              /^[-+]?(\s*\d+(,\d+)?)\s*%$/.test(oldvalue.toString().trim()) || // for example 14,65%   "14,65 %"
              
              /^[-+]?(\s*\d+(\.\d+)?)\s*$/.test(oldvalue.toString().trim()) || // for example 14.65  "14.65 "  
              /^[-+]?(\s*\d+(,\d+)?)\s*$/.test(oldvalue.toString().trim()) // for example 14,65   "14,65 "
            ) {
                 console.log('renderer percentage 1part')
                 const value_percentage_renderer = parseFloat(oldvalue.toString().replace(',', '.').replace('%','').replace(/\s/g, ''));
                 console.log(oldvalue)
                 console.log(value_percentage_renderer)
                 if(Math.abs(value_percentage_renderer)<smallafterdigit_percentage_percperc){
                  const formatter88_percentage = new Intl.NumberFormat(userLocale, {
                    style: 'decimal',
                    maximumFractionDigits: afterdigitsmallnb_percentage_percperc,
                    useGrouping: false // removing thousand separator
                  });
                  const formattedNumber88_percentage = formatter88_percentage.format(value_percentage_renderer);
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber88_percentage+'%';
                  data22[row][col] = td.innerHTML+'%'

                 } else {
                 const formatter_percentage = new Intl.NumberFormat(userLocale, {
                    style: 'decimal',
                    minimumFractionDigits: afterdigit_percentage_percperc,
                    maximumFractionDigits: afterdigit_percentage_percperc,
                    useGrouping: false // removing thousand separator
                  });
                  console.log('renderer 2condition : ')
                  console.log(oldvalue)
                  console.log(value_percentage_renderer)
                  const formattedNumber_percentage = formatter_percentage.format(Number(value_percentage_renderer));
                  console.log(formattedNumber_percentage)

                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber_percentage+'%';
                //  console.log(td.innerHTML)
                  data22[row][col] = td.innerHTML+'%';      
                 //td.innerHTML=oldvalue;
                 cellProperties.className = 'htRight'; 
                 td.style.textAlign = 'right';
                 }
          }
          else {
            //console.log('renderer percentage 02 part')
            td.innerHTML='';
            data22[row][col] = td.innerHTML;      
            td.className = 'htRight'; 
            td.style.textAlign = 'right';
          }
          td.className = 'htLeft htMiddle custom-normalcell'

          //console.log('renderer percentage end')

          } else if ( row>3 ) {
            //data22[row][col] = td.innerHTML;      
                td.innerHTML=oldvalue;
                data22[row][col] = td.innerHTML;      
                td.className = 'htCenter htMiddle custom-titlecell2';
        }
        
        
      }
  }
}
  else if(i == 6 || i == 7 || i == 8      || i == 11 || i == 12 || i == 13 ){
      dd={
        className: "htRight htMiddle" ,
        validator: function (oldvalue, callback) { // validator of numbers or amounts
            const thisrow = this.row;
            const thiscol = this.col;
            //const value = oldvalue.replace(regexcurrenciesht, '');
            console.log('validator')
            console.log(oldvalue)
            console.log('validator is :' + oldvalue + 'and then')
            console.log(oldvalue=='')
            console.log(oldvalue==='')
            if(thisrow>5){
            if (oldvalue != null) {//|| oldvalue.toString()!==null){
              var value = oldvalue.toString().replace(currencyht_nbnb, '');
              console.log('new VALuE in afterValidator is : ' + value)
            } else {
              console.log('we are inside validator oldvalue==null')
              var value = null;
            }
            //   const value = oldvalue.replace(currencyht_nbnb,'') ;
            // console.log('new VALuE in validator is : ' +  value);

            if (value == null ||
              /^\s*[-+]?(\s*\d+)\s*$/.test(value) || // /^\s*[-+]?(\d+)\s*$/.test(value) || // when the value is whole number like 45 1987 2 36 ... // /^\s*[-+]?(\d+)\s*\$?\s*$/.test("  1235$  ")
              /^\s*[-+]?(\s*\d+(\.\d*)?|\.\d+)\s*$/.test(value) || //1234567.89 (BY DEFAULT VALUE) AMERICAN NUMERIC FORMAT WITHOUT THOUSAND SEPARATOR
              /^\s*[-+]?(\s*\d+(,\d*)?|,\d+)\s*$/.test(value) || //1234567,89 EUROPEAN NUMERIC FORMAT WITHOUT THOUSAND SEPARATOR
              /^\s*[-+]?(\s*\d{1,3}( \d{3})*(,\d*)?|,\d+)\s*$/.test(value) || // 1 234 567,89 FRENCH NUMERIC FORMAT WITH THOUSAND SEPARATOR as space
              /^\s*[-+]?(\s*\d{1,3}(,\d{3})*(\.\d+)?|\.\d+)\s*$/.test(value) || // 1,234,567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as comma
              /^\s*[-+]?(\s*\d{1,3}(?:\.\d{3})+(?:,\d+)?)\s*(?=\s|$)/.test(value) || // 1.234.567,89 EUROPEAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as dot /^\s*[-+]?(\d{1,3}(?:[.,\s]\d{3})*(?:,\d+)?)\s*$/
              /^\s*[-+]?(\s*\d{1,3}( \d{3})*(\.\d*)?|\.\d+)\s*$/.test(value) ||   // 1 234 567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as space
              /^\s*[-+]?[\s]*[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value) || // 1.6e6 1.60E+04  -13.65E4  - 12.3E+03  scientific notation with E sign
              /^\s*[-+]?[\s]*[0-9]*,?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value)    // 1,6e6 1,60E+04  -13,65E4  - 12.3E+03  scientific notation with E sign


            ) {
              console.log('it returns true in validator')
              if (value !== oldvalue) {
                console.log('it returns true inside validator and value != oldvalud')
                //callback(true,
                //  hot.setDataAtCell(thisrow, thiscol, value)
                //)
                callback(true)
                //hot.setDataAtCell(row,prop,this.getData()[row][prop])
              } else {
                callback(true)
              }
            } else {
              console.log('we are in callback false')
              callback(false);
            }
          }
          },
        renderer: function (instance, td, row, col, prop, oldvalue, cellProperties) { // renderer of numbers or amounts
          
          //  console.log('renderer :')       
            //if (col == 1) { //editable column changeable , and it can be removed because renderer is inside column
              //const value = oldvalue.replace(regexcurrenciesht, '');
           if(row>5){
              if (oldvalue !== null) {
                var value = oldvalue.toString().replace(currencyht_nbnb, '');
              } else {
                var value = null
              }

              if (value == null || value == '') {
                td.innerHTML = ''
                data22[row][col] = td.innerHTML;
              } else if (decimalSeparator == "." && /^\s*[-+]?(\s*\d+)\s*$/.test(value)) {
                console.log('we are inside renderer . whole number')
                console.log(value)
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_nbnb_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_nbnb,
                  maximumFractionDigits: afterdigit_nbnb,
                });
                const value_without_whitespace = value.replace(/^\s*([-+])?\s*(\d+)\s*$/, '$1$2');
                const formattedNumber = formatter.format(Number(value_without_whitespace));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_nbnb;
                data22[row][col] = td.innerHTML;

              } else if (decimalSeparator == "," && /^\s*[-+]?(\s*\d+)\s*$/.test(value)) {
                console.log('we are inside renderer , whole number')
                console.log(value)
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_nbnb_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_nbnb,
                  maximumFractionDigits: afterdigit_nbnb,
                });
                const value_without_whitespace = value.replace(/^\s*([-+])?\s*(\d+)\s*$/, '$1$2');
                const formattedNumber = formatter.format(Number(value_without_whitespace));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_nbnb;
                data22[row][col] = td.innerHTML;


              } else if (decimalSeparator == '.' && /^\s*[-+]?(\s*\d+(\.\d*)?|\.\d+)\s*$/.test(value)) {
                console.log('we are inside rendere 1')
                console.log('//1234567.89 (BY DEFAULT VALUE) AMERICAN NUMERIC FORMAT WITHOUT THOUSAND SEPARATOR')
                console.log(value)
                const value_without_whitespace2 = value.replace(/^\s*([-+])\s*(\d+)/, '$1$2');

                //const userLocale = Intl.NumberFormat().resolvedOptions().locale || 'fr' || 'en'
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_nbnb_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_nbnb,
                  maximumFractionDigits: afterdigit_nbnb,
                }); //('en')
                if (Math.abs(Number(value_without_whitespace2)) < smallafterdigit_nbnb) {
                  const formatter22 = new Intl.NumberFormat(userLocale, {
                    useGrouping: usegrouping_nbnb_if_true,
                    style: 'decimal',
                    maximumFractionDigits: afterdigitsmallnb_nbnb,
                  });
                  const formattedNumber22 = formatter22.format(value_without_whitespace2);
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber22 + currencyht_toshow_nbnb
                  console.log('we are inside td.innerhtml < 0.01')
                  data22[row][col] = td.innerHTML;

                } else {
                  console.log('we are inside . and default and else (number value>0.01)')
                  const formattedNumber = formatter.format(Number(value_without_whitespace2));
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber + currencyht_toshow_nbnb;
                  data22[row][col] = td.innerHTML;

                }

                console.log(td.innerHTML)
              } else if (decimalSeparator == ',' && /^\s*[-+]?(\s*\d+(,\d*)?|,\d+)\s*$/.test(value)) {
                console.log('we are inside rendere 2')
                console.log('we are inside decimalseparator == , and ezaoeza ')
                console.log('//1234567,89 EUROPEAN FORMAT NUMERIC FORMAT WITHOUT THOUSAND')
                //const userLocale = Intl.NumberFormat().resolvedOptions().locale || 'fr' || 'en'
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_nbnb_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_nbnb,
                  maximumFractionDigits: afterdigit_nbnb,
                });
                const value_without_whitespace3 = value.replace(/^\s*([-+])\s*(\d+)/, '$1$2');

                console.log('value in second :')
                console.log(value_without_whitespace3)
                const value_without_whitespace32 = value_without_whitespace3.toString().replace(',', '.')
                //console.log('value2 :')
                //console.log(value2)
                console.log(Number(value_without_whitespace32))

                if (Math.abs(Number(value_without_whitespace32)) < smallafterdigit_nbnb) {
                  console.log('ifnumbervalue2222<0.01 comma')
                  console.log(Number(value_without_whitespace32))
                  const formatter33 = new Intl.NumberFormat(userLocale, {
                    useGrouping: usegrouping_nbnb_if_true,
                    style: 'decimal',
                    maximumFractionDigits: afterdigitsmallnb_nbnb,
                  });
                  const formattedNumber33 = formatter33.format(value_without_whitespace32);
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber33 + currencyht_toshow_nbnb;
                  data22[row][col] = td.innerHTML;

                } else {
                  const formattedNumber = formatter.format(value_without_whitespace32);
                  console.log(formattedNumber)

                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber + currencyht_toshow_nbnb;
                  data22[row][col] = td.innerHTML;

                }

              } else if (decimalSeparator == ',' && /^\s*[-+]?(\s*\d{1,3}( \d{3})*(,\d*)?|,\d+)\s*$/.test(value)) {
                console.log('we are inside rendere 3')
                console.log('we are inside else if 300 000,00')
                console.log('// 1 234 567,89 FRENCH NUMERIC FORMAT WITH THOUSAND SEPARATOR')

                const formatter = new Intl.NumberFormat(userLocale, {
                  style: 'decimal',
                  useGrouping: usegrouping_nbnb_if_true,
                  minimumFractionDigits: afterdigit_nbnb,
                  maximumFractionDigits: afterdigit_nbnb,
                });
                const value3 = value.replace(/\s/g, '').replace(',', '.');
                const formattedNumber = formatter.format(Number(value3).toFixed(2));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_nbnb;
                data22[row][col] = td.innerHTML;


              } else if (decimalSeparator == '.' && /^\s*[-+]?(\s*\d{1,3}(,\d{3})*(\.\d+)?|\.\d+)\s*$/.test(value)) {
                console.log('we are inside rendere 4')
                console.log('5,455,653.35 ')
                console.log('// 1,234,567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR')
                const formatter = new Intl.NumberFormat(userLocale, {
                  style: 'decimal',
                  useGrouping: usegrouping_nbnb_if_true,
                  minimumFractionDigits: afterdigit_nbnb,
                  maximumFractionDigits: afterdigit_nbnb,
                });
                console.log('value in rendere 4 ')
                console.log(value)
                const value4 = value.replace(/,/g, '')
               console.log(hot.undoRedo.doneActions)
           
               console.log('value4:') 
               console.log(value4)
                const formattedNumber = formatter.format(Number(value4).toFixed(2));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_nbnb;
                data22[row][col] = td.innerHTML;


              } else if (decimalSeparator == ',' && /^\s*[-+]?(\s*\d{1,3}(?:\.\d{3})+(?:,\d+)?)\s*(?=\s|$)/.test(value)) {
                // 1.234.567,89 EUROPEAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as dot
                console.log('we are inside rendere 5')
                console.log('5.300.000,00')
                console.log('// 1.234.567,89 EUROPEAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as dot')
                const formatter = new Intl.NumberFormat(userLocale, {
                  style: 'decimal',
                  useGrouping: usegrouping_nbnb_if_true,
                  minimumFractionDigits: afterdigit_nbnb,
                  maximumFractionDigits: afterdigit_nbnb,
                });
                const value_without_whitespace4 = value.replace(/^\s*([-+])\s*(\d+)/, '$1$2')
                const value_without_whitespace45 = value_without_whitespace4.trim().replace(/\./g, '').replace(',', '.')
                //const value5 = value.trim().replace(/\./g, '')

                const formattedNumber = formatter.format(Number(value_without_whitespace45).toFixed(2));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_nbnb;
                data22[row][col] = td.innerHTML;

              } else if (decimalSeparator == '.' && /^\s*[-+]?(\s*\d{1,3}( \d{3})*(\.\d*)?|\.\d+)\s*$/.test(value)) {
                console.log('we are inside rendere 6')
                console.log('we are inside else if 300 000.00')
                console.log('// 1 234 567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR')

                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_nbnb_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_nbnb,
                  maximumFractionDigits: afterdigit_nbnb,
                });
                const value6 = value.replace(/\s/g, '');
                const formattedNumber = formatter.format(Number(value6).toFixed(2));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_nbnb;
                data22[row][col] = td.innerHTML;

              } else if (decimalSeparator == '.' && /^\s*[-+]?[\s]*[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value)) {
                console.log('we are inside rendere 7')
                console.log('we are inside scientific notation :');
                console.log('// 1.6e6 1.60E+04  -13.65E4  - 12.3E+03  scientific notation with E sign');
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_nbnb_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_nbnb,
                  maximumFractionDigits: afterdigit_nbnb,
                });
                const value7 = parseFloat(value.replace(/\s/g, ''));
                const formattedNumber = formatter.format(Number(value7));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_nbnb;
                data22[row][col] = td.innerHTML;

              } else if (decimalSeparator == ',' && /^\s*[-+]?[\s]*[0-9]*,?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value)) {
                //console.log('----------------------------------------rendere 8 ---------------------------------------- rendere 8 ------------------------')
                console.log('we are inside rendere 8')
                console.log('we are inside scientific notation with comma :');
                console.log('// 1,6e6 1,60E+04  -13,65E4  - 12,3E+03  scientific notation with E sign');
                console.log('value inside scientific notation with comma else if : ')
                const value8 = parseFloat(value.replace(',', '.').replace(/\s/g, ''));
                console.log('value8 : ')
                console.log(value8)

                if (Math.abs(Number(value8)) < smallafterdigit_nbnb) {
                  console.log('ifnumbervalue2222<0.01 comma sceintific number')
                  console.log(Number(value8))
                  const formatter88 = new Intl.NumberFormat(userLocale, {
                    useGrouping: usegrouping_nbnb_if_true,
                    style: 'decimal',
                    maximumFractionDigits: afterdigitsmallnb_nbnb,
                  });
                  const formattedNumber88 = formatter88.format(value8);
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber88 + currencyht_toshow_nbnb;
                  data22[row][col] = td.innerHTML;

                } else {
                  const formatter = new Intl.NumberFormat(userLocale, {
                    useGrouping: usegrouping_nbnb_if_true,
                    style: 'decimal',
                    minimumFractionDigits: afterdigit_nbnb,
                    maximumFractionDigits: afterdigit_nbnb,
                  });
                  const formattedNumber = formatter.format(Number(value8));
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber + currencyht_toshow_nbnb;
                  console.log(td.innerHTML)
                  data22[row][col] = td.innerHTML;

                }
              } else {
                console.log('WE ARE INSIDE LAST ELSE RENDERER')
              }
            
            td.className = 'htLeft htMiddle custom-normalcell';
            //console.log('renderer percentage end')
          } else if ( row>3 ) {
              //data22[row][col] = td.innerHTML;
               td.innerHTML=oldvalue;
               data22[row][col] = td.innerHTML;
               td.className = 'htCenter htMiddle custom-titlecell2';
            }
            }
       
      }
  }
  else if(i == 2){
      dd={data:i,type:'numeric',
       validator: function(value, callback) {
        const rr = this.row;
        const cc = this.col;

        if(rr>5){
        console.log(value)
         if (isNaN(Number(value))) {
           callback(false, 
           errorpopup(),
           console.log('ERRRROR PUP IS DONNEEEE') 
           
           );
         } else {
           callback(true)
           valueskiformat=[rr,cc]
           skiformat.push(valueskiformat)
           console.log('skiformat is : ')
           console.log(skiformat)
         }
        }
       }

    ,allowInvalid: false}    
  }
  else if(i == 7){
      dd={data:i,type:'numeric',
       validator: function(value, callback) {
        const rr = this.row;
        const cc = this.col;

        if(rr>5){
        console.log('value col 7 is ')
        console.log(value)
        if(isAccountingFormatted(value)){
          return;
        } else if (isNaN(Number(value))==false  ){
          var formattedNumber = accounting.formatMoney(Number(value), '€', 2, ' ', ',');
          console.log('formattedNumber is ' + formattedNumber)
           callback(true,
           hot.setDataAtCell(rr,cc,formattedNumber)
          )
// OR: OR : || 
        } else {
          callback(false, 
           //errorpopup(),
          console.log('ERRRROR PUP col 7 IS DONNEEEE') 
          )
        }
        }
       }

    ,allowInvalid: false}    
  }
  else {
      dd={data:i}
    }
    
    fa.push(dd)
}
fa.push({data:15,readOnly:true})
return fa
}

hot = new Handsontable(container, {
    //data: getData(),
    data : ddata,
    licenseKey: 'non-commercial-and-evaluation', // for non-commercial use only
          rowHeaders: true,
          wordWrap: true,
          colHeaders: true,
          manualColumnResize: true,
          manualRowResize: true,
          colWidths: [50,200,100,120,120, 120,120,120,120,100,  120,120,120,120,100,    20 ],
          undo: true,
          columns: columnsdata(0,16),
          contextMenu: {
            items:{
              "copy":{name:"Copier"},
              "cut":{name:'Couper'},
              "paste":{
                name: 'Coller (Utiliser <b>Ctrl + V</b> avec le clavier)',
                disabled:true
             }
            }
          },
          startRows: 6,
          startCols: 5,
          cells:(row,column)=>{
            var cellProperties = {};
            if(row<6){
              cellProperties.readOnly = true;
            }
            return cellProperties;
          },
          mergeCells: [
    { row: 0, col: 1, rowspan: 1, colspan: 15 },
    { row: 1, col: 1, rowspan: 1, colspan: 15 },
    { row: 2, col: 1, rowspan: 1, colspan: 15 },


    { row: 4, col: 1, rowspan: 2, colspan: 1 },
    { row: 4, col: 2, rowspan: 2, colspan: 1 },
    { row: 4, col: 3, rowspan: 2, colspan: 1 },
    { row: 4, col: 4, rowspan: 2, colspan: 1 },

    { row: 4, col: 5, rowspan: 1, colspan: 5 },
    { row: 4, col: 10, rowspan: 1, colspan: 5 },




    ],
          cell: normalcellloop(6,6+last_row_after_header),
          hiddenColumns: {columns:[15]},
          DragToScroll: true,
          copyPaste: true,
          afterValidate: function(isValid, value, row, prop, source) {
            if (!isValid) {
              if(prop!=7){
                
              console.log('value inside aftervalidate is :')
              console.log(value)
              console.log('this getdata : ')
              
              console.log(this.getData()[row][prop])

              hot.setDataAtCell(row,prop,this.getData()[row][prop])

                            
              //console.log(this.loadData(this.getData()));

            }
              } else {
              if ( prop==2) {
                //hot.setDataAtCell(row,prop,formatter.format(value))               

              }
            }
          },
          beforeChange:(changes,sources)=>{
            console.log('we are inside beforechange : ')
            console.log(changes)
          },
          afterCopy:(data,coords)=>{
            console.log('we are inside aftercopy : ')
            console.log(data)
            console.log(coords)
            console.log(coords[0].startRow)
 const rangecopied = { 
                 from: { row: coords[0].startRow, col: coords[0].startCol }, 
                 to:   { row: coords[0].endRow, col: coords[0].endCol }
             }
       

          },
          
          afterBeginEditing:(row,col)=>{
            console.log('we are inside afterbeginediting : ')
            console.log(row)
            console.log(col)
          },
          
          afterScrollHorizontally:()=>{
            console.log('afterscrollhor is triggered')
          },
        //    beforeKeyDown:(event)=>{
        //         console.log(event)
        //    },
        afterPaste:(data,coords)=>{
          console.log('we are inside afterpaste : ')
          console.log(data)
          console.log(coords)
          

        },
        afterChange:(changes,source)=>{
            console.log("we are inside afterChange : ")
            console.log(source)
            console.log(changes)
            // if(source != 'loadData'){

            //   if(changes[0][1]==2 && changes[0][0]>5){
            //    if(isNaN(Number(changes[0][3]))) {
            //     console.log('we are inside if nan number changes03 ')
            //     hot.setDataAtCell(changes[0][0],changes[0][1],changes[0][2])
            //    }
            //  }
         
            // } 
          }    
});

var setter = false;
var newdateandtime = new Date();

function isBlank(str) {
    return (/^\s*$/.test(str));
}


const downloadfile=()=>{
    
  var doc = new jsPDF({orientation:'landscape'});
//doc.setFontSize(16)
var hotInstance = hot;
var table = [];
var skipped = []
var cells = hotInstance.getData()
for (var i = 4; i < cells.length; i++) {
  var row = [];
  for (var j = 1; j < 15; j++) {
      if(existsInArray(skipped,[i,j])){
          continue;
      }
    var cell = cells[i][j];
    //var cellcontent = hotInstance.getCell(i, j);
    var cellcontent = document.createElement("td");
    cellcontent.className = hot.getCellMeta(i,j).className || '';
    cellcontent.innerHTML = hot.getDataAtCell(i,j) || '';

    var content = cellcontent.innerHTML;

    var cellProperties =hotInstance.getCellMeta(i,j)
    var colspan = cellProperties.colspan || 1;
    var rowspan = cellProperties.rowspan || 1;
    //var styles = cellProperties.style || {};
    if(cellcontent.className!=''){

    var strcontent = "."+cellcontent.className.replace(/ /g, '.');
    var element = document.querySelector(strcontent)
    var style = window.getComputedStyle(element) || '';
    var bgcolor = style.getPropertyValue('background-color') || '';
    var txtalign = style.getPropertyValue('text-align') || '';
    if(i==4 || i==5){
      var styles = {fillColor: bgcolor,halign:txtalign}//,fontSize:6}
    } else {
      var styles = {fillColor: bgcolor,halign:txtalign}//,fontSize:8}
    }

    } else {
    var styles = cellProperties.style || {}
    }
           

    if(rowspan > 1 || colspan > 1 ) {
        console.log(content)
        for(var is=0; is<rowspan ; is++){
            for(var js=0; js<colspan ; js++){
                if(is==0 & js==0) {
                styles['valign']=txtalign || '' 
                continue
                } else {
               var vaisk=i+is;
               var vajsk=j+js
               valueskk=[vaisk,vajsk]
               skipped.push(valueskk)       
                } 
            }
        }
    }
    row.push({ content, colSpan:colspan, rowSpan:rowspan, styles:styles });
  }
  table.push(row);
}
console.log('tableeeeeeeeeeeeee :')
console.log(table)







let font_size=7;
function normalmincolwidth(fontsize) {
    if(fontsize==7){
        return [19,17,17,17,17,  1.15*17, 1.10*17, 1.10*17, 1.10*17,20   , 1.15*17, 1.10*17, 1.10*17, 1.10*17,20];
    } else if (fontsize==6){
        return [17,15,15,15,15,  1.10*18, 1.07*18, 1.07*18, 1.07*18,18   , 1.10*18, 1.07*18, 1.07*18, 1.07*18,18]
    }
}

function calcwidth(fontsize,textwidth) {
 if(fontsize==9){
     return 1.8*textwidth;
 } else if (fontsize==8){
     return 1.64*textwidth;
 } else if (fontsize==7){
     return 1.5*textwidth;
 } else if (fontsize==6){
     return 1.38*textwidth;
 }
}
var data2=table.slice(2); //editable
console.log('data2 : ')
console.log(data2)
let columnMaxLengths = [];
// Initialize the array with zeros for each column
for (let i = 0; i < data2[0].length; i++) {
  columnMaxLengths[i] = 0;
}
// Iterate over each row and update the maximum length for each column
for (let row of data2) {
  for (let i = 0; i < row.length; i++) {
    var cellValue = row[i].content;
    //console.log('cellValue : ')
    //console.log(cellValue)
    columnMaxLengths[i] = Math.max(columnMaxLengths[i], calcwidth(font_size,cellValue.toString().length));
  }
}
console.log(columnMaxLengths)
for (let i = 0; i < data2[0].length; i++) {
    if(i==5 || i==6 || i==7 || i==8 ||  i==10 || i==11 || i==12 || i==13){
  columnMaxLengths[i] = Math.max(columnMaxLengths[i],normalmincolwidth(font_size)[i]);
    } else {
  columnMaxLengths[i] = normalmincolwidth(font_size)[i]
    }   
}
console.log('***************------------------------*******');
console.log("columnMaxLengths avant test sum : ");
console.log(columnMaxLengths)
console.log(font_size)

var sumcolumnMaxLengths = columnMaxLengths.reduce((acc, curr) => acc + curr, 0);
console.log('sumcolumnMaxLengths : ')
console.log(sumcolumnMaxLengths)

    if(sumcolumnMaxLengths>290){
        console.log('font_size : ')
        console.log(font_size)
        font_size--;
        console.log(font_size);
        console.log('yessss it is greather than 290');
        console.log(sumcolumnMaxLengths)
        columnMaxLengths = [];
// Initialize the array with zeros for each column
for (let i = 0; i < data2[0].length; i++) {
  columnMaxLengths[i] = 0;
}

        for (let row of data2) {
  for (let i = 0; i < row.length; i++) {
    cellValue = row[i].content;
    //console.log('font_size after cellvalue : ');
    //console.log(font_size);
    columnMaxLengths[i] = Math.max(columnMaxLengths[i], calcwidth(font_size,cellValue.toString().length));
  }
}
        
for (let i = 0; i < data2[0].length; i++) {
    if(i==5 || i==6 || i==7 || i==8 ||  i==10 || i==11 || i==12 || i==13){
  columnMaxLengths[i] = Math.max(columnMaxLengths[i],normalmincolwidth(font_size)[i]);
    } else {
  columnMaxLengths[i] = normalmincolwidth(font_size)[i]
    }   
}
    }
console.log("columnMaxLengths apres test sum : ");
console.log(columnMaxLengths)
var sumcolumnMaxLengths2 = columnMaxLengths.reduce((acc, curr) => acc + curr, 0);
console.log(sumcolumnMaxLengths2)

console.log('font_size : ')
console.log(font_size)


var columnStyles = {
  0: { columnWidth: columnMaxLengths[0] }, // Column 1 width
  1: { columnWidth: columnMaxLengths[1] }, // Column 2 width
  2: { columnWidth: columnMaxLengths[2] },  
  3: { columnWidth: columnMaxLengths[3] },  
  4: { columnWidth: columnMaxLengths[4] },  
  5: { columnWidth: columnMaxLengths[5] },  
  6: { columnWidth: columnMaxLengths[6] },  
  7: { columnWidth: columnMaxLengths[7] },  
  8: { columnWidth: columnMaxLengths[8] },
  9: { columnWidth: columnMaxLengths[9] },  
  10: { columnWidth: columnMaxLengths[10] },  
  11: { columnWidth: columnMaxLengths[11] },  
  12: { columnWidth: columnMaxLengths[12] },  
  13: { columnWidth: columnMaxLengths[13] },
  14: { columnWidth: columnMaxLengths[14] },  

};



doc.autoTable({  // the complete width of the A4 landscape page is : 297 (i think the unit is by mm so 297mm x 210mm  or 210mm x 297mm)
               
               body:table,
               theme:'grid',
                margin:{left:7,right:4},
              /*  styles: {
                //fontSize: 8,
                lineColor: 50,
                textColor:50,
                },
                */
                columnStyles: columnStyles,
                styles:{fontSize:font_size,
    textColor: [0, 0, 0], // Set text color to black
    lineColor: [0, 0, 0], // Set line color to black
    lineWidth: 0.1 // Set line width to 0.1 (adjust as needed)},
         },
    didParseCell:function(data){data.cell.styles.font = "helvetica";}

            
                
})
doc.save('taaa.pdf')
}

hot.addHook('afterChange', function(changes, src) {
  console.log(changes)
  console.log(src)
  if(src != 'loadData'){
 
    console.log('WE ARE INSIDE EXTERNAL AFTERCHANGE ')
    console.log(changes)
    console.log(src)
    const chh2 = changes

    if (!setter) {
//       console.log('chh2  : ')
//       console.log(chh2)
//       setter = true;
//       const chh3=chh2.map(([i,j,k,p])=>{
//         // if(p==''){
//         //     pa=''
//         // } else {
//         //     pa=Number(p.toString().replace('%','').replace(',','.'))
//         // }

//         ddata[i][j]=p


// if(navigator.language=='fr-FR'){
//   console.log(p)
//   p=numbro.unformat(p.replace(',','.'))
//   console.log('p 2nd : ')
//   console.log(p)
// }
// if(j==3) {
  
//         if(!isNaN(p) && !isBlank(p)) {
            
//         pn=numbro(p/100).format({ output: 'percent',mantissa:2 });
//         preplace=pn.replace('.',',')

//             //const pp = pa/100;

//          return [i,j, preplace]
            
//         } else {
//             return [i,j,k]
//         }
        
// }
//     })
//  if(j==3){
  
//     console.log('CHH3 : ')
//     console.log(chh3)
//     console.log('we are inside col 3 and if kda kda : ')
//     hot.setDataAtCell(chh3)

//   }
//     // hot.setCellMetaObject(chh3, { type: 'numeric',
//     //                    numericFormat: {
//     //                              pattern: {output:'percent',mantissa:1}
//     //                              }}
//     //                              );
//     // hot.render();

   }  else {
      setter = false;
    }
    }
   
  });


  console.log('hot.getcolheader : ')
  console.log([hot.getColHeader()])
 


  var doc = new jsPDF({orientation:'landscape'});

// Data for the table
var data = [
  ["Column 1", "C2", "C3","C4","C5","C6","C7","C8","C9","C10","C11","C12","C13","C14"],
  ["Row 1", "V", "V", "V", "V", "V", "V", "V", "V", "V", "V", "V", "V", "V"],
  ["Row 2", "V", "V", "V", "V", "V", "V", "V", "V", "V", "V", "V", "V", "V"],
];
/*
a1+a2+a3+a3   + a3+a4+a4+a4+a5     + a3+a4+a4+a4+a5
a1+a2+5a3+6a4+2a5=296
4a3+3/2a3+a3+12a3+4a3=296

a1=4a3
a2=1.5a3
a4=2a3
a5=2a3

a3=11
*/
</script>

</body>
</html>




