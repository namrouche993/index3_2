<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Handsontable with custom validator and decimal separator switcher</title>
  <script src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js"></script>
  <link rel="stylesheet" type="text/css"
    href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css">
  <script src='https://cdn.jsdelivr.net/npm/bignumber.js@9.1.0/bignumber.min.js'></script>

  <!-- https://handsontable.com/docs/javascript-data-grid/software-license/ -->
  <!-- https://github.com/handsontable/handsontable/tree/6.2.2 is the latest MIT LICENCE version -->
  <!-- <link rel="stylesheet" href="handsontable.full.min.css">  --> 

</head>

<body>
  <!-- <script src="handsontable.full.min.js"></script> -->

  <style>
    .handsontable .htCommentCell:after {
      content: "";
      position: absolute;
      top: 0;
      right: 0;
      left: unset;
      border-left: 20px solid transparent;
      border-right: none;
      border-top: 14px solid red;
    }

    .htCommentsContainer .htCommentTextArea {
      width: 320px;
      height: 60px;
    }
    .text-right {
        text-align: right;
    }
    .handsontable{
     font-size: 12px;
     font-family: Roboto;
   }

   .handsontable .htAutocompleteArrow {
            float: right;
            font-size: 10px;
            color: black;
            cursor: default;
            width: 16px;            
            text-align: center;
          }

    /* .htRight {
        text-align: right;
      } */

  </style>
  <button onclick="undohandstonetable()">undo</button>
  <button onclick="redohandstonetable()">redo</button>

  <div id="example"></div>

  <button id="decimal-switcher">Switch decimal separator</button>
  <script>

    function undohandstonetable() {
      hot.undo(true);

    }
    function redohandstonetable() {
      hot.redo(false);

    }

    const currencyht_nbnb = '$' //'DA'
    const currencyht_toshow_nbnb = '' // ' $' // ' DA'  ///
    const afterdigit_nbnb = 2;
    const smallafterdigit_nbnb = Number(`1e-${afterdigit_nbnb}`)  // like 0.01 with afterdigit2
    const afterdigitsmallnb_nbnb = 17;
    const bignb_nbnb = 1e17;
    const smallnb_nbnb = 1e-17;
    const decimalnumbers_toshow_withoutrenderer_innumbers_nbnb = 10;
    const usegrouping_nbnb_if_true = true;
    const is_negativenb_accepted_nbnb=true;
    // const is_float_accepted_nbnb = true;  // bayna beli true


    const currencyht_intint = '' //'DA'
    const currencyht_toshow_intint = '' // ' $' // ' DA'  ///
    const afterdigit_intint = 0;
    const smallafterdigit_intint = Number(`1e-${afterdigit_intint}`)  // like 0.01 with afterdigit2
    const afterdigitsmallnb_intint = 17;
    const bignb_intint = 1e17;
    const smallnb_intint = 1e-17;
    const decimalnumbers_toshow_withoutrenderer_innumbers_intint = 2;
    const usegrouping_intint_if_true = false;
    const is_negativenb_accepted_intint = false;
    const is_float_accepted_intint = false;



    const afterdigit_percentage_percperc = 2; //  how many decimal numbers will be displayed in renderer !
    const smallafterdigit_percentage_percperc = Number(`1e-${afterdigit_percentage_percperc}`)  // like 0.01 with afterdigit2 ,  even though the value is small than this number , so displays it in renderer
    const afterdigitsmallnb_percentage_percperc = 10; // even though the number is too small than the previous number (0.01) and it small than this number, so don't display it , and instead of it , display 0 because of maximumFractionDigits=this number
    const bignbpercent_percperc = 1e10;
    const smallnbpercent_percperc = 1e-10;
    const decimalnumbers_toshow_withoutrenderer_inpercentage_percperc=10;
    const is_negativenb_accepted_percperc = true;
    const is_float_accepted_percperc = true;

    const emails_length_em=30;
    const phonenumbers_length_pn=20;


    //#region date time zone (navigator.language)
    const userLocale = 'fr'// editable maybe Intl.DateTimeFormat().resolvedOptions().locale || navigator.language || navigator.userLanguage;
    const navigator_language=navigator.language // 'fr-FR' 'en-CA'  // editable
    var userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
    var usTimeZones = [  'America/New_York',  'America/Chicago',  'America/Denver',  'America/Los_Angeles',  'America/Anchorage',  'America/Adak',  'Pacific/Honolulu',  'America/Phoenix',  'America/Indiana/Indianapolis',  'America/Indiana/Knox',  'America/Indiana/Marengo',  'America/Indiana/Petersburg',  'America/Indiana/Tell_City',  'America/Indiana/Vevay',  'America/Indiana/Vincennes',  'America/Indiana/Winamac',  'America/Kentucky/Louisville',  'America/Kentucky/Monticello',  'America/Detroit',  'America/Menominee',  'America/St_Johns',  'America/Puerto_Rico',  'America/Montserrat',  'America/New_York',  'America/North_Dakota/Beulah',  'America/North_Dakota/Center',  'America/North_Dakota/New_Salem'];
    //#endregion date time zone


    function isValidDate(dateStr,splitsign,ndays,nmonths,nyears) {
  const datestr2 = dateStr.split(splitsign);
  const day = parseInt(datestr2[Number(ndays)-1]);
  const month = parseInt(datestr2[Number(nmonths)-1]);
  const year = parseInt(datestr2[Number(nyears)-1]);
  const parsedMonth = parseInt(month);
  const parsedDay = parseInt(day);
  const parsedYear = parseInt(year);

  if ( isNaN(day) || isNaN(month) || isNaN(year) ){
      return false;
  }
  // Check if year is within the allowed range
  if (parsedYear < 1000 || parsedYear>3000) {
    return false;
  }

  // Check if month is valid
  if (parsedMonth < 1 || parsedMonth > 12) {
    return false;
  }

  // Check if day is valid for the given month and year
  const daysInMonth = new Date(parsedYear, parsedMonth, 0).getDate();
  if (parsedDay < 1 || parsedDay > daysInMonth) {
    return false;
  }

  // If all checks pass, return true
  return true;
}

  //#region decimalseparator and thousand separator 
    const options = { style: 'decimal' };
    const formattedNumber = (1234567.73).toLocaleString(userLocale, options);
    const DecimalSeparator0 = formattedNumber.substring(9, 10)
    decimalSeparator = DecimalSeparator0
    const thousandSeparator00 = formattedNumber.substring(1, 2);
    thousandSeparator0 = thousandSeparator00
    console.log('decimal separateur est :' + decimalSeparator +
      ' et thousand est :' + thousandSeparator0 +
      'et le nombre devients :' + formattedNumber)
   //#endregion decimalseparator and thousand separator 


    let lastelement_supthan1=0;

    const comments_messages = function(value,msg,language){
    if(msg=='error'){
      if(language=='fr-FR'){
        var mm = "la valeur '" + value + "' n'est pas valide ";
        return mm;

      } else if (language=='en-US'){
        var mm = "The value '" + value + "' is not valid.";
        return mm;
      }
    }
    else if (msg=='val_try_to_fix'){
      if(language=='fr-FR'){
        var mm = "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres";
        return mm;
      } else if (language=='en-US'){

      }
      // ---------------- # date_correct msg # ----------------
      // ---------------- # date_correct msg # ----------------
      // ---------------- # date_correct msg # ----------------

    }
    else if (msg=='val_try_to_fix_comma_instead_dot'){
      if(language=='fr-FR'){
        var mm = "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + value.replace(/\s+/g, '').trim().replace('.', ',') + " est correct (virguale à la place du point).";
        return mm;

      } else if (language=='en-US'){
        var mm = "The value '" + value + "' is not valid. Try correcting the formatting according to your parameters. | " + value.replace(/\s+/g, '').trim().replace('.', ',') + " is correct (comma instead of a dot).";
        return mm;

      }
    } 
    else if (msg=='val_try_to_fix_dot_instead_comma'){
      if(language=='fr-FR'){
      var mm = "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + value.replace(/\s+/g, '').trim().replace(',', '.') + " est correct (point à la place de la virgule)";
      return mm;
      } else if (language=='en-US'){
        var mm = "The value '" + value + "' is not valid. Try correcting the formatting according to your parameters. | " + value.replace(/\s+/g, '').trim().replace(',', '.') + " is correct (dot instead of a comma).";
        return mm;
      }
    }
    else if (msg=='val_try_to_fix_4'){
      if(language=='fr-FR'){
        var mm = "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + Number(value).toLocaleString(userLocale) + " est correct";
        return mm;
      } else if (language=='en-US'){
        var mm = "The value '" + value + "' is not valid. Try correcting the formatting according to your parameters. | " + Number(value).toLocaleString(userLocale) + " is correct.";
        return mm;
      }
    }
    else if (msg=='val_try_to_fix_5'){
      if(language=='fr-FR'){
        var mm = "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + value.trim().replace(',', '.') + " est correct";
        return mm;
      } else if (language=='en-US'){
        var mm = "The value '" + value + "' is not valid. Try correcting the formatting according to your parameters. | " + value.trim().replace(',', '.') + " is correct.";
        return mm;
      }
    }
    else if (msg=='val_try_to_fix_6'){
      if(language=='fr-FR'){
        var mm =  "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + Number(value.replace(/,/g, '')).toLocaleString(userLocale) + " est correct";
        return mm;
      } else if (language=='en-US'){
        var mm = "The value '" + value + "' is not valid. Try correcting the formatting according to your parameters. | " + Number(value.replace(/,/g, '')).toLocaleString(userLocale) + " is correct.";
        return mm;
      }
    }
    else if (msg=='val_try_to_fix_fill_only_numbers'){
      if(language=='fr-FR'){
        var mm =  "la valeur '" + value + "' n'est pas valide pour cette cellule. Veuillez saisir uniquement des valeurs numériques";
        return mm;
      } else if (language=='en-US'){
        var mm = "The value '" + value + "' is not valid for this cell. Please enter only numeric values.";
        return mm;
      }
    }
    else if (msg=='val_try_to_fix_8'){
      if(language=='fr-FR'){
        var mm = "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + value.trim().replace(/\./g, '').replace(',', '.') + " est correct";
        return mm;
      } else if (language=='en-US'){
        var mm = "The value '" + value + "' is not valid. Try correcting the formatting according to your parameters. | " + value.trim().replace(/./g, '').replace(',', '.') + " is correct.";
        return mm;
      }
    }
    else if (msg=='date_try_to_fix') {
      if(language=='fr-FR'){
        var mm = "la date '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  ";
        return mm;

      } else if (language=='en-US'){
        var mm = "The date '" + value + "' is not valid. Try correcting the formatting according to your parameters.";
        return mm;
      }
      // ---------------- # date_no_valid msg # ----------------
      // ---------------- # date_no_valid msg # ----------------
      // ---------------- # date_no_valid msg # ----------------
    }
    else if (msg=='date_no_valid') {
      if(language=='fr-FR'){
        var mm = "la date '" + value + "' n'est pas valide ";
        return mm;

      } else if (language=='en-US'){
        var mm = "The date '" + value + "' is not valid.";
        return mm;
      }
    }
    else if (msg=='val_no_valid') {
      if(language=='fr-FR'){
        var mm = "la valeur '" + value + "' n'est pas valide ";
        return mm;

      } else if (language=='en-US'){
        var mm = "The value '" + value + "' is not valid.";
        return mm;
      }

    }
    else if (msg=='limit_autor') {
          // ---------------- # limite_autorise msg # ----------------
      // ---------------- # limite_autorise msg # ----------------
      // ---------------- # limite_autorise msg # ----------------
      if(language=='fr-FR'){
        var mm = "La valeur que vous avez saisie dépasse la limite autorisée !!";
        return mm;

      } else if (language=='en-US'){
        var mm = "The value you entered exceeds the allowed limit!";
        return mm;
      }

    }
    else if (msg=='dropdown_included') {
      if(language=='fr-FR'){
        var mm = "Veuillez choisir une valeur incluse dans la liste";
        return mm;

      } else if (language=='en-US'){
        var mm = "Please choose a value included in the list.";
        return mm;
      }
    }
    else if (msg=='percentage_no_valid_isvalidfalse_end') {
      if(language=='fr-FR'){
        var mm = "la valeur '" + value + "' n'est pas valide, Veuillez entrer uniquement des pourcentages. ";
        return mm;

      } else if (language=='en-US'){
        var mm = "The value '" + value + "' is not valid, Please enter only percentages";
        return mm;
      }
    }
    else if (msg=='refuse_negative'){
      if(language=='fr-FR'){
        var mm = "Attention : La valeur que vous avez saisie est négative, Veuillez saisir un nombre supérieur à zéro. ";
        return mm;

      } else if (language=='en-US'){
        var mm = "Warning: The value you entered is negative. Please enter a number greater than zero.";
        return mm;
      }
    }
    else if (msg=='refuse_float'){
      if(language=='fr-FR'){
        var mm = "Veuillez saisir un nombre entier et non un nombre décimal. (pas de virgule) ";
        return mm;

      } else if (language=='en-US'){
        var mm = "Please enter an integer value, not a decimal number.";
        return mm;
      }
    }
      else if (msg=='email_invalid'){
      if(language=='fr-FR'){
        var mm = "Veuillez entrer une adresse email valide.";
        return mm;

      } else if (language=='en-US'){
        var mm = "Please enter a valid email address.";
        return mm;
      }
    }
    else if (msg=='phonenumbers_invalid'){
      if(language=='fr-FR'){
        var mm = "Veuillez entrer un numéro de téléphone valide.";
        return mm;

      } else if (language=='en-US'){
        var mm = "Please enter a valid phone number.";
        return mm;
      }
    }
    
  }
  
   

   


//#region date format starting
      if(navigator_language=='en-US'){
    if(usTimeZones.includes(userTimeZone)){
      var dateformatlanguage = 'mm/dd/aaaa'; 
      var splitdate='/';
    } else {
      var dateformatlanguage = 'jj/mm/aaaa' // 'mm/dd/yyyy'; // 12/31/1990 edit it later , modify it later  , change it later
      var splitdate='/';
      //var [monthdate,daydate, yeardate] = dateformatlanguage.split(splitdate);
    }
    } else if(navigator_language=='ko-KR' || navigator_language=='hu-HU'){
      var dateformatlanguage = 'aaaa.mm.jj' // 'yyyy.mm.dd' // 1990.12.31
      var splitdate='.';
      //var [yeardate,monthdate,daydate] = dateformatlanguage.split(splitdate);

    } else if(navigator_language=='ja-JP' || navigator_language=='ZH-CN'){
      var dateformatlanguage = 'aaaa/mm/jj' //'yyyy/mm/dd' // 1990/12/31
      var splitdate='/';
      //var [yeardate,monthdate,daydate] = dateformatlanguage.split(splitdate);

    } else if(navigator_language=='en-CA'){
      var dateformatlanguage = 'aaaa-mm-jj' //'yyyy-mm-dd' // 1990-12-31
      var splitdate='-';
      //var [yeardate,monthdate,daydate] = dateformatlanguage.split(splitdate);

    } else if(navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR'){
      var dateformatlanguage = 'jj.mm.aaaa' //'dd.mm.yyyy' // 12.31.1990
      var splitdate='.';
      //var [daydate,monthdate,yeardate] = dateformatlanguage.split(splitdate);

    } else {
      // european and other formats
      var dateformatlanguage = 'jj/mm/aaaa' // 'dd/mm/yyyy' // 31/12/1990
      var splitdate='/';
      //var [daydate,monthdate,yeardate] = dateformatlanguage.split(splitdate);
    }
    //#endregion date format starting


      class PercentageEditor extends Handsontable.editors.TextEditor {
  open() {
    super.open();
    const value = this.getValue();
    if (!value.endsWith('%')) { // check if the value doesn't already end with a percent sign
      this.TEXTAREA.value += '%'; // add a "%" sign to the initial value
    }
  }

  setValue(value) {
      try {
        var percentValue = value.replace(/%/g, '') + '%' || ''; // remove existing "%" signs and add a new one
       } catch (error) {
        var percentValue = '';
      }
    //const percentValue = value.replace(/%/g, '') + '%'; // remove existing "%" signs and add a new one
    super.setValue(percentValue);
  }
  

 /* onBeforeKeyDown(event) {
    const value = this.getValue();
    const key = event.keyCode || event.which;

    if (key >= 48 && key <= 57) { // numeric keys
      const percentValue = value.replace(/%/g, '') + String.fromCharCode(key) + '%';
      this.setValue(percentValue);
      event.stopImmediatePropagation();
      event.preventDefault();
    } else if (key === 8) { // backspace key
      const percentValue = value.replace(/%$/, '');
      this.setValue(percentValue);
      event.stopImmediatePropagation();
      event.preventDefault();
    }
  }
*/
  close() {
    super.close();
    const value = this.getValue();
    if (value.endsWith('%')) { // check if the value ends with a percent sign
      this.TEXTAREA.value = value.slice(0, -1); // remove the last character (the percent sign)
    }
  }

  focus() {
    super.focus();
    const length = this.TEXTAREA.value.length;
    this.TEXTAREA.setSelectionRange(0, length - 1); // set the cursor position at the end of the value
  }
}
 
const data = [    // editable
      ['', '', '', 'aa', '', '', '','',''],
      ['', '', '', 'aa', '', '', '','',''],
      ['', '', '', 'aa', '', '', '','',''],
      ['', '', '', 'aa', '', '', '','',''],
      ['', '', '', 'aa', '', '', '','',''],
      ['', '', '', 'aa', '', '', '','',''],
      ['', '', '', 'aa', '', '', '','',''],
      ['', '', '', 'aa', '', '', '','',''],
      ['', '', '', 'aa', '', '', '','',''],
      ['', '', '', 'aa', '', '', '','',''],
      ['', '', '', 'aa', '', '', '','',''],
      ['', '', '', 'aa', '', '', '','',''],
      ['', '', '', 'aa', '', '', '','',''],
      ['', '', '', 'aa', '', '', '','',''],
      ['', '', '', 'aa', '', '', '','',''],
      ['', '', '', 'aa', '', '', '','',''],
      ['', '', '', 'aa', '', '', '','',''],



    ];
const data22 = data.map(arr => [...arr]);

    const hot = new Handsontable(document.getElementById('example'), {
      data: data,
      comments: true,
      colWidths: [150, 150, 120, 30, 90, 90, 150,80,80],  // editable

      beforeKeyDown: function (event) {  // editable the 2 indexx later inside 
     
        var selected = hot.getSelected();
        var currentColIndex = selected ? selected[0][1] : null;
        //console.log(selected)
        //console.log(currentColIndex)
        if(currentColIndex==4) {  // editable edit it later changeable , modify it later , change it later
          if(navigator_language=='en-US'){
      var dateformatlanguage = 'mm/dd/yyyy'; // 12/31/1990
      var splitdate='/';
      //var [monthdate,daydate, yeardate] = dateformatlanguage.split(splitdate);

        var betweensplit_dot = this.getActiveEditor().getValue().split(".")
        var betweensplit_slash = this.getActiveEditor().getValue().split("/")
        var betweensplit_hyphen = this.getActiveEditor().getValue().split("-")

       // console.log(event.key)
        if( !isNaN(Number(event.key)) && (typeof condition_split=='undefined' || condition_split==true)){
          var betweensplit_dot = this.getActiveEditor().getValue().split(".");
          betweensplit_dot[1]=betweensplit_dot[1]+event.key;

          var betweensplit_slash = this.getActiveEditor().getValue().split("/");
          betweensplit_slash[1]=betweensplit_slash[1]+event.key;

          var betweensplit_hyphen = this.getActiveEditor().getValue().split("-");
          betweensplit_hyphen[1]=betweensplit_hyphen[1]+event.key;

        
      if( ( (this.getActiveEditor().getValue().length==1 && this.getActiveEditor().getValue().toString()!=' ') && !isNaN(Number(event.key)) ) || (this.getActiveEditor().getValue().length==4 && !isNaN(Number(event.key))) || (Number(betweensplit_dot[1])>9 && Number(betweensplit_dot[1])<100) || (Number(betweensplit_slash[1])>9 && Number(betweensplit_slash[1])<100) || (Number(betweensplit_hyphen[1])>9 && Number(betweensplit_hyphen[1])<100)  ){
      if( !isNaN(Number(event.key)) && (this.getActiveEditor().getValue().split(".").length-1<2 && this.getActiveEditor().getValue().split("/").length-1<2 && this.getActiveEditor().getValue().split("-").length-1<2 ) ){
        this.getActiveEditor().setValue(this.getActiveEditor().getValue() + event.key + splitdate);
        event.stopImmediatePropagation();
        event.preventDefault();
      }
    }} else if (event.key=='.' || event.key=='/' || event.key=='-' ){
       condition_split=false;
       if(this.getActiveEditor().getValue().substring(this.getActiveEditor().getValue().length - 1)==splitdate){ 
        this.getActiveEditor().setValue(this.getActiveEditor().getValue().substring(0,this.getActiveEditor().getValue().length - 1)+event.key)
        event.stopImmediatePropagation();
        event.preventDefault();
      }
    }
    }
     else if(navigator_language=='ko-KR' || navigator_language=='hu-HU'){ // ######################################################################
      //console.log('we are in korean')
      var dateformatlanguage = 'yyyy.mm.dd' // 1990.12.31
      var splitdate='.';
      //var [yeardate,monthdate,daydate] = dateformatlanguage.split(splitdate);


        var betweensplit_dot = this.getActiveEditor().getValue().split(".")
        var betweensplit_slash = this.getActiveEditor().getValue().split("/")
        var betweensplit_hyphen = this.getActiveEditor().getValue().split("-")

        //console.log(event.key)
        if( !isNaN(Number(event.key)) && (typeof condition_split=='undefined' || condition_split==true)){
          var betweensplit_dot = this.getActiveEditor().getValue().split(".");
          betweensplit_dot[1]=betweensplit_dot[1]+event.key;

          var betweensplit_slash = this.getActiveEditor().getValue().split("/");
          betweensplit_slash[1]=betweensplit_slash[1]+event.key;

          var betweensplit_hyphen = this.getActiveEditor().getValue().split("-");
          betweensplit_hyphen[1]=betweensplit_hyphen[1]+event.key;

        
      if( ( (this.getActiveEditor().getValue().length==3 ) && !isNaN(Number(event.key)) ) || (this.getActiveEditor().getValue().length==6 && !isNaN(Number(event.key))) || (Number(betweensplit_dot[1])>9 && Number(betweensplit_dot[1])<100) || (Number(betweensplit_slash[1])>9 && Number(betweensplit_slash[1])<100) || (Number(betweensplit_hyphen[1])>9 && Number(betweensplit_hyphen[1])<100)  ){
      if( !isNaN(Number(event.key)) && (this.getActiveEditor().getValue().split(".").length-1<2 && this.getActiveEditor().getValue().split("/").length-1<2 && this.getActiveEditor().getValue().split("-").length-1<2 ) ){
        this.getActiveEditor().setValue(this.getActiveEditor().getValue() + event.key + splitdate);
        event.stopImmediatePropagation();
        event.preventDefault();
      }
    }} else if (event.key=='.' || event.key=='/' || event.key=='-' ){
       condition_split=false;
       if(this.getActiveEditor().getValue().substring(this.getActiveEditor().getValue().length - 1)==splitdate){ 
        this.getActiveEditor().setValue(this.getActiveEditor().getValue().substring(0,this.getActiveEditor().getValue().length - 1)+event.key)
        event.stopImmediatePropagation();
        event.preventDefault();
      }
    }
    

    } 
    else if(navigator_language=='ja-JP' || navigator_language=='ZH-CN'){ //  ######################################################################
      var dateformatlanguage = 'yyyy/mm/dd' // 1990/12/31
      var splitdate='/';
      //var [yeardate,monthdate,daydate] = dateformatlanguage.split(splitdate);

        var betweensplit_dot = this.getActiveEditor().getValue().split(".")
        var betweensplit_slash = this.getActiveEditor().getValue().split("/")
        var betweensplit_hyphen = this.getActiveEditor().getValue().split("-")

        //console.log(event.key)
        if( !isNaN(Number(event.key)) && (typeof condition_split=='undefined' || condition_split==true)){
          var betweensplit_dot = this.getActiveEditor().getValue().split(".");
          betweensplit_dot[1]=betweensplit_dot[1]+event.key;

          var betweensplit_slash = this.getActiveEditor().getValue().split("/");
          betweensplit_slash[1]=betweensplit_slash[1]+event.key;

          var betweensplit_hyphen = this.getActiveEditor().getValue().split("-");
          betweensplit_hyphen[1]=betweensplit_hyphen[1]+event.key;

        
      if( ( (this.getActiveEditor().getValue().length==3 ) && !isNaN(Number(event.key)) ) || (this.getActiveEditor().getValue().length==6 && !isNaN(Number(event.key))) || (Number(betweensplit_dot[1])>9 && Number(betweensplit_dot[1])<100) || (Number(betweensplit_slash[1])>9 && Number(betweensplit_slash[1])<100) || (Number(betweensplit_hyphen[1])>9 && Number(betweensplit_hyphen[1])<100)  ){
      if( !isNaN(Number(event.key)) && (this.getActiveEditor().getValue().split(".").length-1<2 && this.getActiveEditor().getValue().split("/").length-1<2 && this.getActiveEditor().getValue().split("-").length-1<2 ) ){
        this.getActiveEditor().setValue(this.getActiveEditor().getValue() + event.key + splitdate);
        event.stopImmediatePropagation();
        event.preventDefault();
      }
    }} else if (event.key=='.' || event.key=='/' || event.key=='-' ){
       condition_split=false;
       if(this.getActiveEditor().getValue().substring(this.getActiveEditor().getValue().length - 1)==splitdate){ 
        this.getActiveEditor().setValue(this.getActiveEditor().getValue().substring(0,this.getActiveEditor().getValue().length - 1)+event.key)
        event.stopImmediatePropagation();
        event.preventDefault();
      }
    }
    
    } 
    else if(navigator_language=='en-CA'){  // ######################################################################
      var dateformatlanguage = 'yyyy-mm-dd' // 1990-12-31
      var splitdate='-';
      //var [yeardate,monthdate,daydate] = dateformatlanguage.split(splitdate);

        var betweensplit_dot = this.getActiveEditor().getValue().split(".")
        var betweensplit_slash = this.getActiveEditor().getValue().split("/")
        var betweensplit_hyphen = this.getActiveEditor().getValue().split("-")

        //console.log(event.key)
        if( !isNaN(Number(event.key)) && (typeof condition_split=='undefined' || condition_split==true)){
          var betweensplit_dot = this.getActiveEditor().getValue().split(".");
          betweensplit_dot[1]=betweensplit_dot[1]+event.key;

          var betweensplit_slash = this.getActiveEditor().getValue().split("/");
          betweensplit_slash[1]=betweensplit_slash[1]+event.key;

          var betweensplit_hyphen = this.getActiveEditor().getValue().split("-");
          betweensplit_hyphen[1]=betweensplit_hyphen[1]+event.key;

        
      if( ( (this.getActiveEditor().getValue().length==3 ) && !isNaN(Number(event.key)) ) || (this.getActiveEditor().getValue().length==6 && !isNaN(Number(event.key))) || (Number(betweensplit_dot[1])>9 && Number(betweensplit_dot[1])<100) || (Number(betweensplit_slash[1])>9 && Number(betweensplit_slash[1])<100) || (Number(betweensplit_hyphen[1])>9 && Number(betweensplit_hyphen[1])<100)  ){
      if( !isNaN(Number(event.key)) && (this.getActiveEditor().getValue().split(".").length-1<2 && this.getActiveEditor().getValue().split("/").length-1<2 && this.getActiveEditor().getValue().split("-").length-1<2 ) ){
        this.getActiveEditor().setValue(this.getActiveEditor().getValue() + event.key + splitdate);
        event.stopImmediatePropagation();
        event.preventDefault();
      }
    }} else if (event.key=='.' || event.key=='/' || event.key=='-' ){
       condition_split=false;
       if(this.getActiveEditor().getValue().substring(this.getActiveEditor().getValue().length - 1)==splitdate){ 
        this.getActiveEditor().setValue(this.getActiveEditor().getValue().substring(0,this.getActiveEditor().getValue().length - 1)+event.key)
        event.stopImmediatePropagation();
        event.preventDefault();
      }
    }



    }
     else if(navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR'){ // ######################################################################
      var dateformatlanguage = 'dd.mm.yyyy' // 12.31.1990
      var splitdate='.';

        var betweensplit_dot = this.getActiveEditor().getValue().split(".")
        var betweensplit_slash = this.getActiveEditor().getValue().split("/")
        var betweensplit_hyphen = this.getActiveEditor().getValue().split("-")

      //  console.log(event.key)
        if( !isNaN(Number(event.key))){
          var betweensplit_dot = this.getActiveEditor().getValue().split(".");
          betweensplit_dot[1]=betweensplit_dot[1]+event.key;

          var betweensplit_slash = this.getActiveEditor().getValue().split("/");
          betweensplit_slash[1]=betweensplit_slash[1]+event.key;

          var betweensplit_hyphen = this.getActiveEditor().getValue().split("-");
          betweensplit_hyphen[1]=betweensplit_hyphen[1]+event.key;

        
      if( ( (this.getActiveEditor().getValue().length==1 && this.getActiveEditor().getValue().toString()!=' ') && !isNaN(Number(event.key)) ) || (this.getActiveEditor().getValue().length==4 && !isNaN(Number(event.key))) || (Number(betweensplit_dot[1])>9 && Number(betweensplit_dot[1])<100) || (Number(betweensplit_slash[1])>9 && Number(betweensplit_slash[1])<100) || (Number(betweensplit_hyphen[1])>9 && Number(betweensplit_hyphen[1])<100)  ){
      if( !isNaN(Number(event.key)) && (this.getActiveEditor().getValue().split(".").length-1<2 && this.getActiveEditor().getValue().split("/").length-1<2 && this.getActiveEditor().getValue().split("-").length-1<2 ) ){
        this.getActiveEditor().setValue(this.getActiveEditor().getValue() + event.key + splitdate);
        event.stopImmediatePropagation();
        event.preventDefault();
      }
    }} else if (event.key=='.' || event.key=='/' || event.key=='-' ){
       if(this.getActiveEditor().getValue().substring(this.getActiveEditor().getValue().length - 1)==splitdate){ 
        this.getActiveEditor().setValue(this.getActiveEditor().getValue().substring(0,this.getActiveEditor().getValue().length - 1)+event.key)
        event.stopImmediatePropagation();
        event.preventDefault();
      }
    }
    
    }
     else {        // ############################################################################################################################################
      // european and other formats
      var dateformatlanguage = 'dd/mm/yyyy' // 31/12/1990
      var splitdate='/';
      //console.log('condition_split in beforekey start : ')
      // console.log(condition_split)

      //var [daydate,monthdate,yeardate] = dateformatlanguage.split(splitdate);
        var betweensplit_dot = this.getActiveEditor().getValue().split(".")
        var betweensplit_slash = this.getActiveEditor().getValue().split("/")
        var betweensplit_hyphen = this.getActiveEditor().getValue().split("-")

        //console.log(event.key)
        if( !isNaN(Number(event.key)) && (typeof condition_split=='undefined' || condition_split==true)){
          var betweensplit_dot = this.getActiveEditor().getValue().split(".");
          betweensplit_dot[1]=betweensplit_dot[1]+event.key;

          var betweensplit_slash = this.getActiveEditor().getValue().split("/");
          betweensplit_slash[1]=betweensplit_slash[1]+event.key;

          var betweensplit_hyphen = this.getActiveEditor().getValue().split("-");
          betweensplit_hyphen[1]=betweensplit_hyphen[1]+event.key;

        
      if( ( (this.getActiveEditor().getValue().length==1 && this.getActiveEditor().getValue().toString()!=' ') && !isNaN(Number(event.key)) ) || (this.getActiveEditor().getValue().length==4 && !isNaN(Number(event.key))) || (Number(betweensplit_dot[1])>9 && Number(betweensplit_dot[1])<100) || (Number(betweensplit_slash[1])>9 && Number(betweensplit_slash[1])<100) || (Number(betweensplit_hyphen[1])>9 && Number(betweensplit_hyphen[1])<100)  ){
      if( !isNaN(Number(event.key)) && (this.getActiveEditor().getValue().split(".").length-1<2 && this.getActiveEditor().getValue().split("/").length-1<2 && this.getActiveEditor().getValue().split("-").length-1<2 ) ){
        this.getActiveEditor().setValue(this.getActiveEditor().getValue() + event.key + splitdate);
        event.stopImmediatePropagation();
        event.preventDefault();
      }
    }} else if (event.key=='.' || event.key=='/' || event.key=='-' ){
       condition_split=false;
       if(this.getActiveEditor().getValue().substring(this.getActiveEditor().getValue().length - 1)==splitdate){ 
        this.getActiveEditor().setValue(this.getActiveEditor().getValue().substring(0,this.getActiveEditor().getValue().length - 1)+event.key)
        event.stopImmediatePropagation();
        event.preventDefault();
      }
    }
       //console.log(condition_split)

    }
        }
        else if(currentColIndex!=6) { // editable and adding other text columns || 
        if (decimalSeparator == ',') {
          if (event.key === '.') {
            //console.log(event)
            var selectedCell = this.getSelectedLast(); // Get selected cell object
            //var selectedRow = selectedCell[0][0]; // Get selected row index
            var selectedCol = selectedCell[1]; // Get selected column index
            console.log(selectedCell)
            //console.log(selectedCell[1])
            //console.log(selectedCol)

            console.log('selectedCol : '  + selectedCol)
            if(selectedCol==2){   // editable modify editable , it's about percentage
              console.log('we are inside selectedCol == 2')
              var cellpercent = this.getActiveEditor().TEXTAREA; // Get the DOM element representing the cell editor
              this.getActiveEditor().setValue(this.getActiveEditor().getValue() + ',');
              cellpercent.setSelectionRange(cellpercent.value.length-1, cellpercent.value.length-1); // Set the new cursor position
              event.stopImmediatePropagation();
              event.preventDefault();
            } else {
            this.getActiveEditor().setValue(this.getActiveEditor().getValue() + ',');
            event.stopImmediatePropagation();
            event.preventDefault();
          
          }
          }
          if (event.key === '.' && event.keyCode == 190) {
            this.getActiveEditor().setValue(this.getActiveEditor().getValue().substring(0, this.getActiveEditor().getValue().length - 1) + '.');
            event.stopImmediatePropagation();
            event.preventDefault();
          }
        }
      }
    },
     
      afterCreateRow: function(index, amount) {
        // Your custom logic goes here
        console.log('A new row has been added at index: ', index);
        console.log(amount)
        console.log(index)
        data22.push(['','','','','','',''])
        console.log(data22)
      },

      afterSelection: (r1, c1, r2, c2) => {
        var comment = hot.getCellMeta(r1, c1).comment;
        if (comment !== undefined) {
          const commentsPlugin = hot.getPlugin('comments');
          commentsPlugin.showAtCell(r1, c1);
          //return comment;
        } else {
          const commentsPlugin = hot.getPlugin('comments');
          commentsPlugin.hide();
        }
      },
     
      beforeChange: (changes, source) => {
        console.log('we are inside beforeChange x y z :')
        console.log(changes)
        console.log(source)
        const commentsPlugin = hot.getPlugin('comments');
        //console.log(hot.undoRedo.doneActions)
        //console.log(hot.undoRedo.doneActions[hot.undoRedo.doneActions.length-1])

        changes.forEach(([row, prop, oldValue, newValue]) => {
          if (oldValue == '' && newValue == null || oldValue == '' && newValue == '' && source == 'UndoRedo.undo') {
            commentsPlugin.removeCommentAtCell(row, prop);
            console.log('comments removed')
          }
          console.log(`Change in row ${row} property ${prop}: ${oldValue} -> ${newValue}`);
        });
        console.log('end before change')
      },

      columns: [
        //{ type: 'numeric' },
        {      
        className: "htRight htMiddle" ,
        validator: function (oldvalue, callback) { // validator of numbers or amounts
            const thisrow = this.row;
            const thiscol = this.col;
            //const value = oldvalue.replace(regexcurrenciesht, '');
            console.log('validator')
            console.log(oldvalue)
            console.log('validator is :' + oldvalue + 'and then')
            console.log(oldvalue=='')
            console.log(oldvalue==='')

             if (oldvalue != null) {//|| oldvalue.toString()!==null){
               var value = oldvalue.toString().replace(currencyht_intint, '');
               console.log('new VALuE in afterValidator is : ' + value)
             } else {
               console.log('we are inside validator oldvalue==null')
               var value = null;
             }

            //var value = oldvalue;

            //   const value = oldvalue.replace(currencyht_intint,'') ;
            // console.log('new VALuE in validator is : ' +  value);

            if (value == null ||
              /^\s*[-+]?(\s*\d+)\s*$/.test(value) || // /^\s*[-+]?(\d+)\s*$/.test(value) || // when the value is whole number like 45 1987 2 36 ... // /^\s*[-+]?(\d+)\s*\$?\s*$/.test("  1235$  ")
              /^\s*[-+]?(\s*\d+(\.\d*)?|\.\d+)\s*$/.test(value) || //1234567.89 (BY DEFAULT VALUE) AMERICAN NUMERIC FORMAT WITHOUT THOUSAND SEPARATOR
              /^\s*[-+]?(\s*\d+(,\d*)?|,\d+)\s*$/.test(value) || //1234567,89 EUROPEAN NUMERIC FORMAT WITHOUT THOUSAND SEPARATOR
              /^\s*[-+]?(\s*\d{1,3}( \d{3})*(,\d*)?|,\d+)\s*$/.test(value) || // 1 234 567,89 FRENCH NUMERIC FORMAT WITH THOUSAND SEPARATOR as space
              /^\s*[-+]?(\s*\d{1,3}(,\d{3})*(\.\d+)?|\.\d+)\s*$/.test(value) || // 1,234,567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as comma
              /^\s*[-+]?(\s*\d{1,3}(?:\.\d{3})+(?:,\d+)?)\s*(?=\s|$)/.test(value) || // 1.234.567,89 EUROPEAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as dot /^\s*[-+]?(\d{1,3}(?:[.,\s]\d{3})*(?:,\d+)?)\s*$/
              /^\s*[-+]?(\s*\d{1,3}( \d{3})*(\.\d*)?|\.\d+)\s*$/.test(value) ||   // 1 234 567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as space
              /^\s*[-+]?[\s]*[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value) || // 1.6e6 1.60E+04  -13.65E4  - 12.3E+03  scientific notation with E sign
              /^\s*[-+]?[\s]*[0-9]*,?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value)    // 1,6e6 1,60E+04  -13,65E4  - 12.3E+03  scientific notation with E sign


            ) {
              console.log('it returns true in validator')
              if (value !== oldvalue) {
                console.log('it returns true inside validator and value != oldvalud')
                //callback(true,
                //  hot.setDataAtCell(thisrow, thiscol, value)
                //)
                callback(true)
                //hot.setDataAtCell(row,prop,this.getData()[row][prop])
              } else {
                callback(true)
              }
            } else {
              console.log('we are in callback false')
              callback(false);
            }
          },
        renderer: function (instance, td, row, col, prop, oldvalue, cellProperties) { // renderer of numbers or amounts
          
           // console.log('renderer :')       
            //if (col == 1) { //editable column changeable , and it can be removed because renderer is inside column
              //const value = oldvalue.replace(regexcurrenciesht, '');
              
               if (oldvalue !== null) {
                 var value = oldvalue.toString().replace(currencyht_intint, '');
               } else {
                 var value = null
               }

              //var value=oldvalue;

              if (value == null || value == '') {
                td.innerHTML = ''
                data22[row][col] = td.innerHTML;
              } else if (decimalSeparator == "." && /^\s*[-+]?(\s*\d+)\s*$/.test(value)) {
                console.log('we are inside renderer . whole number')
                console.log(value)
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_intint_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_intint,
                  maximumFractionDigits: afterdigit_intint,
                });
                const value_without_whitespace = value.replace(/^\s*([-+])?\s*(\d+)\s*$/, '$1$2');
                const formattedNumber = formatter.format(Number(value_without_whitespace));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_intint;
                data22[row][col] = td.innerHTML;

              } else if (decimalSeparator == "," && /^\s*[-+]?(\s*\d+)\s*$/.test(value)) {
                console.log('we are inside renderer , whole number')
                console.log(value)
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_intint_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_intint,
                  maximumFractionDigits: afterdigit_intint,
                });
                const value_without_whitespace = value.replace(/^\s*([-+])?\s*(\d+)\s*$/, '$1$2');
                const formattedNumber = formatter.format(Number(value_without_whitespace));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_intint;
                data22[row][col] = td.innerHTML;


              } else if (decimalSeparator == '.' && /^\s*[-+]?(\s*\d+(\.\d*)?|\.\d+)\s*$/.test(value)) {
                console.log('we are inside rendere 1')
                console.log('//1234567.89 (BY DEFAULT VALUE) AMERICAN NUMERIC FORMAT WITHOUT THOUSAND SEPARATOR')
                console.log(value)
                const value_without_whitespace2 = value.replace(/^\s*([-+])\s*(\d+)/, '$1$2');

                //const userLocale = Intl.NumberFormat().resolvedOptions().locale || 'fr' || 'en'
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_intint_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_intint,
                  maximumFractionDigits: afterdigit_intint,
                }); //('en')
                if (Math.abs(Number(value_without_whitespace2)) < smallafterdigit_intint) {
                  const formatter22 = new Intl.NumberFormat(userLocale, {
                    useGrouping: usegrouping_intint_if_true,
                    style: 'decimal',
                    maximumFractionDigits: afterdigitsmallnb_intint,
                  });
                  const formattedNumber22 = formatter22.format(value_without_whitespace2);
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber22 + currencyht_toshow_intint
                  console.log('we are inside td.innerhtml < 0.01')
                  data22[row][col] = td.innerHTML;

                } else {
                  console.log('we are inside . and default and else (number value>0.01)')
                  const formattedNumber = formatter.format(Number(value_without_whitespace2));
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber + currencyht_toshow_intint;
                  data22[row][col] = td.innerHTML;

                }

                console.log(td.innerHTML)
              } else if (decimalSeparator == ',' && /^\s*[-+]?(\s*\d+(,\d*)?|,\d+)\s*$/.test(value)) {
                console.log('we are inside rendere 2')
                console.log('we are inside decimalseparator == , and ezaoeza ')
                console.log('//1234567,89 EUROPEAN FORMAT NUMERIC FORMAT WITHOUT THOUSAND')
                //const userLocale = Intl.NumberFormat().resolvedOptions().locale || 'fr' || 'en'
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_intint_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_intint,
                  maximumFractionDigits: afterdigit_intint,
                });
                const value_without_whitespace3 = value.replace(/^\s*([-+])\s*(\d+)/, '$1$2');

                console.log('value in second :')
                console.log(value_without_whitespace3)
                const value_without_whitespace32 = value_without_whitespace3.toString().replace(',', '.')
                //console.log('value2 :')
                //console.log(value2)
                console.log(Number(value_without_whitespace32))

                if (Math.abs(Number(value_without_whitespace32)) < smallafterdigit_intint) {
                  console.log('ifnumbervalue2222<0.01 comma')
                  console.log(Number(value_without_whitespace32))
                  const formatter33 = new Intl.NumberFormat(userLocale, {
                    useGrouping: usegrouping_intint_if_true,
                    style: 'decimal',
                    maximumFractionDigits: afterdigitsmallnb_intint,
                  });
                  const formattedNumber33 = formatter33.format(value_without_whitespace32);
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber33 + currencyht_toshow_intint;
                  data22[row][col] = td.innerHTML;

                } else {
                  const formattedNumber = formatter.format(value_without_whitespace32);
                  console.log(formattedNumber)

                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber + currencyht_toshow_intint;
                  data22[row][col] = td.innerHTML;

                }

              } else if (decimalSeparator == ',' && /^\s*[-+]?(\s*\d{1,3}( \d{3})*(,\d*)?|,\d+)\s*$/.test(value)) {
                console.log('we are inside rendere 3')
                console.log('we are inside else if 300 000,00')
                console.log('// 1 234 567,89 FRENCH NUMERIC FORMAT WITH THOUSAND SEPARATOR')

                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_intint_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_intint,
                  maximumFractionDigits: afterdigit_intint,
                });
                const value3 = value.replace(/\s/g, '').replace(',', '.');
                const formattedNumber = formatter.format(Number(value3).toFixed(2));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_intint;
                data22[row][col] = td.innerHTML;


              } else if (decimalSeparator == '.' && /^\s*[-+]?(\s*\d{1,3}(,\d{3})*(\.\d+)?|\.\d+)\s*$/.test(value)) {
                console.log('we are inside rendere 4')
                console.log('5,455,653.35 ')
                console.log('// 1,234,567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR')
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_intint_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_intint,
                  maximumFractionDigits: afterdigit_intint,
                });
                console.log('value in rendere 4 ')
                console.log(value)
                const value4 = value.replace(/,/g, '')
               console.log(hot.undoRedo.doneActions)
            /*    if(hot.undoRedo.doneActions.length>0){
                  
                hot.undoRedo.doneActions[hot.undoRedo.doneActions.length - 1].changes.forEach((x, y) => {
                  console.log('we are inside foreach in renderer')
                   if (x[0] == row && x[1] == col) {
                  console.log('we are inside condition renderer')
                  //x[3] = value4
                }
                })
                
              }*/
              //  hot.undoRedo.doneActions[hot.undoRedo.doneActions.length-1].changes[0][2]='820'
               // if(src=='CopyPaste.paste'){
               // console.log('inside copypaste.paste source in afterchange')
               // console.log(changes)
               //console.log(hot.undoRedo.doneActions[hot.undoRedo.doneActions.length-1].changes[0][2]='82')
               // }
               console.log('value4:') 
               console.log(value4)
                const formattedNumber = formatter.format(Number(value4).toFixed(2));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_intint;
                data22[row][col] = td.innerHTML;


              } else if (decimalSeparator == ',' && /^\s*[-+]?(\s*\d{1,3}(?:\.\d{3})+(?:,\d+)?)\s*(?=\s|$)/.test(value)) {
                // 1.234.567,89 EUROPEAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as dot
                console.log('we are inside rendere 5')
                console.log('5.300.000,00')
                console.log('// 1.234.567,89 EUROPEAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as dot')
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_intint_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_intint,
                  maximumFractionDigits: afterdigit_intint,
                });
                const value_without_whitespace4 = value.replace(/^\s*([-+])\s*(\d+)/, '$1$2')
                const value_without_whitespace45 = value_without_whitespace4.trim().replace(/\./g, '').replace(',', '.')
                //const value5 = value.trim().replace(/\./g, '')

                const formattedNumber = formatter.format(Number(value_without_whitespace45).toFixed(2));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_intint;
                data22[row][col] = td.innerHTML;

              } else if (decimalSeparator == '.' && /^\s*[-+]?(\s*\d{1,3}( \d{3})*(\.\d*)?|\.\d+)\s*$/.test(value)) {
                console.log('we are inside rendere 6')
                console.log('we are inside else if 300 000.00')
                console.log('// 1 234 567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR')

                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_intint_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_intint,
                  maximumFractionDigits: afterdigit_intint,
                });
                const value6 = value.replace(/\s/g, '');
                const formattedNumber = formatter.format(Number(value6).toFixed(2));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_intint;
                data22[row][col] = td.innerHTML;

              } else if (decimalSeparator == '.' && /^\s*[-+]?[\s]*[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value)) {
                console.log('we are inside rendere 7')
                console.log('we are inside scientific notation :');
                console.log('// 1.6e6 1.60E+04  -13.65E4  - 12.3E+03  scientific notation with E sign');
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_intint_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_intint,
                  maximumFractionDigits: afterdigit_intint,
                });
                const value7 = parseFloat(value.replace(/\s/g, ''));
                const formattedNumber = formatter.format(Number(value7));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_intint;
                data22[row][col] = td.innerHTML;

              } else if (decimalSeparator == ',' && /^\s*[-+]?[\s]*[0-9]*,?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value)) {
                //console.log('----------------------------------------rendere 8 ---------------------------------------- rendere 8 ------------------------')
                console.log('we are inside rendere 8')
                console.log('we are inside scientific notation with comma :');
                console.log('// 1,6e6 1,60E+04  -13,65E4  - 12,3E+03  scientific notation with E sign');
                console.log('value inside scientific notation with comma else if : ')
                const value8 = parseFloat(value.replace(',', '.').replace(/\s/g, ''));
                console.log('value8 : ')
                console.log(value8)

                if (Math.abs(Number(value8)) < smallafterdigit_intint) {
                  console.log('ifnumbervalue2222<0.01 comma sceintific number')
                  console.log(Number(value8))
                  const formatter88 = new Intl.NumberFormat(userLocale, {
                    useGrouping: usegrouping_intint_if_true,
                    style: 'decimal',
                    maximumFractionDigits: afterdigitsmallnb_intint,
                  });
                  const formattedNumber88 = formatter88.format(value8);
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber88 + currencyht_toshow_intint;
                  data22[row][col] = td.innerHTML;

                } else {
                  const formatter = new Intl.NumberFormat(userLocale, {
                    useGrouping: usegrouping_intint_if_true,
                    style: 'decimal',
                    minimumFractionDigits: afterdigit_intint,
                    maximumFractionDigits: afterdigit_intint,
                  });
                  const formattedNumber = formatter.format(Number(value8));
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber + currencyht_toshow_intint;
                  console.log(td.innerHTML)
                  data22[row][col] = td.innerHTML;

                }
              } else {
                console.log('WE ARE INSIDE LAST ELSE RENDERER')
              }
            
            cellProperties.className = 'htRight'; 
              }
        },


        {      
        className: "htRight htMiddle" ,
        validator: function (oldvalue, callback) { // validator of numbers or amounts
            const thisrow = this.row;
            const thiscol = this.col;
            //const value = oldvalue.replace(regexcurrenciesht, '');
            console.log('validator')
            console.log(oldvalue)
            console.log('validator is :' + oldvalue + 'and then')
            console.log(oldvalue=='')
            console.log(oldvalue==='')

            if (oldvalue != null) {//|| oldvalue.toString()!==null){
              var value = oldvalue.toString().replace(currencyht_nbnb, '');
              console.log('new VALuE in afterValidator is : ' + value)
            } else {
              console.log('we are inside validator oldvalue==null')
              var value = null;
            }
            //   const value = oldvalue.replace(currencyht_nbnb,'') ;
            // console.log('new VALuE in validator is : ' +  value);

            if (value == null ||
              /^\s*[-+]?(\s*\d+)\s*$/.test(value) || // /^\s*[-+]?(\d+)\s*$/.test(value) || // when the value is whole number like 45 1987 2 36 ... // /^\s*[-+]?(\d+)\s*\$?\s*$/.test("  1235$  ")
              /^\s*[-+]?(\s*\d+(\.\d*)?|\.\d+)\s*$/.test(value) || //1234567.89 (BY DEFAULT VALUE) AMERICAN NUMERIC FORMAT WITHOUT THOUSAND SEPARATOR
              /^\s*[-+]?(\s*\d+(,\d*)?|,\d+)\s*$/.test(value) || //1234567,89 EUROPEAN NUMERIC FORMAT WITHOUT THOUSAND SEPARATOR
              /^\s*[-+]?(\s*\d{1,3}( \d{3})*(,\d*)?|,\d+)\s*$/.test(value) || // 1 234 567,89 FRENCH NUMERIC FORMAT WITH THOUSAND SEPARATOR as space
              /^\s*[-+]?(\s*\d{1,3}(,\d{3})*(\.\d+)?|\.\d+)\s*$/.test(value) || // 1,234,567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as comma
              /^\s*[-+]?(\s*\d{1,3}(?:\.\d{3})+(?:,\d+)?)\s*(?=\s|$)/.test(value) || // 1.234.567,89 EUROPEAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as dot /^\s*[-+]?(\d{1,3}(?:[.,\s]\d{3})*(?:,\d+)?)\s*$/
              /^\s*[-+]?(\s*\d{1,3}( \d{3})*(\.\d*)?|\.\d+)\s*$/.test(value) ||   // 1 234 567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as space
              /^\s*[-+]?[\s]*[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value) || // 1.6e6 1.60E+04  -13.65E4  - 12.3E+03  scientific notation with E sign
              /^\s*[-+]?[\s]*[0-9]*,?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value)    // 1,6e6 1,60E+04  -13,65E4  - 12.3E+03  scientific notation with E sign


            ) {
              console.log('it returns true in validator')
              if (value !== oldvalue) {
                console.log('it returns true inside validator and value != oldvalud')
                //callback(true,
                //  hot.setDataAtCell(thisrow, thiscol, value)
                //)
                callback(true)
                //hot.setDataAtCell(row,prop,this.getData()[row][prop])
              } else {
                callback(true)
              }
            } else {
              console.log('we are in callback false')
              callback(false);
            }
          },
        renderer: function (instance, td, row, col, prop, oldvalue, cellProperties) { // renderer of numbers or amounts
          
          //  console.log('renderer :')       
            //if (col == 1) { //editable column changeable , and it can be removed because renderer is inside column
              //const value = oldvalue.replace(regexcurrenciesht, '');
              if (oldvalue !== null) {
                var value = oldvalue.toString().replace(currencyht_nbnb, '');
              } else {
                var value = null
              }

              if (value == null || value == '') {
                td.innerHTML = ''
                data22[row][col] = td.innerHTML;
              } else if (decimalSeparator == "." && /^\s*[-+]?(\s*\d+)\s*$/.test(value)) {
                console.log('we are inside renderer . whole number')
                console.log(value)
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_nbnb_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_nbnb,
                  maximumFractionDigits: afterdigit_nbnb,
                });
                const value_without_whitespace = value.replace(/^\s*([-+])?\s*(\d+)\s*$/, '$1$2');
                const formattedNumber = formatter.format(Number(value_without_whitespace));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_nbnb;
                data22[row][col] = td.innerHTML;

              } else if (decimalSeparator == "," && /^\s*[-+]?(\s*\d+)\s*$/.test(value)) {
                console.log('we are inside renderer , whole number')
                console.log(value)
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_nbnb_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_nbnb,
                  maximumFractionDigits: afterdigit_nbnb,
                });
                const value_without_whitespace = value.replace(/^\s*([-+])?\s*(\d+)\s*$/, '$1$2');
                const formattedNumber = formatter.format(Number(value_without_whitespace));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_nbnb;
                data22[row][col] = td.innerHTML;


              } else if (decimalSeparator == '.' && /^\s*[-+]?(\s*\d+(\.\d*)?|\.\d+)\s*$/.test(value)) {
                console.log('we are inside rendere 1')
                console.log('//1234567.89 (BY DEFAULT VALUE) AMERICAN NUMERIC FORMAT WITHOUT THOUSAND SEPARATOR')
                console.log(value)
                const value_without_whitespace2 = value.replace(/^\s*([-+])\s*(\d+)/, '$1$2');

                //const userLocale = Intl.NumberFormat().resolvedOptions().locale || 'fr' || 'en'
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_nbnb_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_nbnb,
                  maximumFractionDigits: afterdigit_nbnb,
                }); //('en')
                if (Math.abs(Number(value_without_whitespace2)) < smallafterdigit_nbnb) {
                  const formatter22 = new Intl.NumberFormat(userLocale, {
                    useGrouping: usegrouping_nbnb_if_true,
                    style: 'decimal',
                    maximumFractionDigits: afterdigitsmallnb_nbnb,
                  });
                  const formattedNumber22 = formatter22.format(value_without_whitespace2);
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber22 + currencyht_toshow_nbnb
                  console.log('we are inside td.innerhtml < 0.01')
                  data22[row][col] = td.innerHTML;

                } else {
                  console.log('we are inside . and default and else (number value>0.01)')
                  const formattedNumber = formatter.format(Number(value_without_whitespace2));
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber + currencyht_toshow_nbnb;
                  data22[row][col] = td.innerHTML;

                }

                console.log(td.innerHTML)
              } else if (decimalSeparator == ',' && /^\s*[-+]?(\s*\d+(,\d*)?|,\d+)\s*$/.test(value)) {
                console.log('we are inside rendere 2')
                console.log('we are inside decimalseparator == , and ezaoeza ')
                console.log('//1234567,89 EUROPEAN FORMAT NUMERIC FORMAT WITHOUT THOUSAND')
                //const userLocale = Intl.NumberFormat().resolvedOptions().locale || 'fr' || 'en'
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_nbnb_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_nbnb,
                  maximumFractionDigits: afterdigit_nbnb,
                });
                const value_without_whitespace3 = value.replace(/^\s*([-+])\s*(\d+)/, '$1$2');

                console.log('value in second :')
                console.log(value_without_whitespace3)
                const value_without_whitespace32 = value_without_whitespace3.toString().replace(',', '.')
                //console.log('value2 :')
                //console.log(value2)
                console.log(Number(value_without_whitespace32))

                if (Math.abs(Number(value_without_whitespace32)) < smallafterdigit_nbnb) {
                  console.log('ifnumbervalue2222<0.01 comma')
                  console.log(Number(value_without_whitespace32))
                  const formatter33 = new Intl.NumberFormat(userLocale, {
                    useGrouping: usegrouping_nbnb_if_true,
                    style: 'decimal',
                    maximumFractionDigits: afterdigitsmallnb_nbnb,
                  });
                  const formattedNumber33 = formatter33.format(value_without_whitespace32);
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber33 + currencyht_toshow_nbnb;
                  data22[row][col] = td.innerHTML;

                } else {
                  const formattedNumber = formatter.format(value_without_whitespace32);
                  console.log(formattedNumber)

                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber + currencyht_toshow_nbnb;
                  data22[row][col] = td.innerHTML;

                }

              } else if (decimalSeparator == ',' && /^\s*[-+]?(\s*\d{1,3}( \d{3})*(,\d*)?|,\d+)\s*$/.test(value)) {
                console.log('we are inside rendere 3')
                console.log('we are inside else if 300 000,00')
                console.log('// 1 234 567,89 FRENCH NUMERIC FORMAT WITH THOUSAND SEPARATOR')

                const formatter = new Intl.NumberFormat(userLocale, {
                  style: 'decimal',
                  useGrouping: usegrouping_nbnb_if_true,
                  minimumFractionDigits: afterdigit_nbnb,
                  maximumFractionDigits: afterdigit_nbnb,
                });
                const value3 = value.replace(/\s/g, '').replace(',', '.');
                const formattedNumber = formatter.format(Number(value3).toFixed(2));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_nbnb;
                data22[row][col] = td.innerHTML;


              } else if (decimalSeparator == '.' && /^\s*[-+]?(\s*\d{1,3}(,\d{3})*(\.\d+)?|\.\d+)\s*$/.test(value)) {
                console.log('we are inside rendere 4')
                console.log('5,455,653.35 ')
                console.log('// 1,234,567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR')
                const formatter = new Intl.NumberFormat(userLocale, {
                  style: 'decimal',
                  useGrouping: usegrouping_nbnb_if_true,
                  minimumFractionDigits: afterdigit_nbnb,
                  maximumFractionDigits: afterdigit_nbnb,
                });
                console.log('value in rendere 4 ')
                console.log(value)
                const value4 = value.replace(/,/g, '')
               console.log(hot.undoRedo.doneActions)
            /*    if(hot.undoRedo.doneActions.length>0){
                  
                hot.undoRedo.doneActions[hot.undoRedo.doneActions.length - 1].changes.forEach((x, y) => {
                  console.log('we are inside foreach in renderer')
                   if (x[0] == row && x[1] == col) {
                  console.log('we are inside condition renderer')
                  //x[3] = value4
                }
                })
                
              }*/
              //  hot.undoRedo.doneActions[hot.undoRedo.doneActions.length-1].changes[0][2]='820'
               // if(src=='CopyPaste.paste'){
               // console.log('inside copypaste.paste source in afterchange')
               // console.log(changes)
               //console.log(hot.undoRedo.doneActions[hot.undoRedo.doneActions.length-1].changes[0][2]='82')
               // }
               console.log('value4:') 
               console.log(value4)
                const formattedNumber = formatter.format(Number(value4).toFixed(2));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_nbnb;
                data22[row][col] = td.innerHTML;


              } else if (decimalSeparator == ',' && /^\s*[-+]?(\s*\d{1,3}(?:\.\d{3})+(?:,\d+)?)\s*(?=\s|$)/.test(value)) {
                // 1.234.567,89 EUROPEAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as dot
                console.log('we are inside rendere 5')
                console.log('5.300.000,00')
                console.log('// 1.234.567,89 EUROPEAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as dot')
                const formatter = new Intl.NumberFormat(userLocale, {
                  style: 'decimal',
                  useGrouping: usegrouping_nbnb_if_true,
                  minimumFractionDigits: afterdigit_nbnb,
                  maximumFractionDigits: afterdigit_nbnb,
                });
                const value_without_whitespace4 = value.replace(/^\s*([-+])\s*(\d+)/, '$1$2')
                const value_without_whitespace45 = value_without_whitespace4.trim().replace(/\./g, '').replace(',', '.')
                //const value5 = value.trim().replace(/\./g, '')

                const formattedNumber = formatter.format(Number(value_without_whitespace45).toFixed(2));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_nbnb;
                data22[row][col] = td.innerHTML;

              } else if (decimalSeparator == '.' && /^\s*[-+]?(\s*\d{1,3}( \d{3})*(\.\d*)?|\.\d+)\s*$/.test(value)) {
                console.log('we are inside rendere 6')
                console.log('we are inside else if 300 000.00')
                console.log('// 1 234 567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR')

                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_nbnb_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_nbnb,
                  maximumFractionDigits: afterdigit_nbnb,
                });
                const value6 = value.replace(/\s/g, '');
                const formattedNumber = formatter.format(Number(value6).toFixed(2));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_nbnb;
                data22[row][col] = td.innerHTML;

              } else if (decimalSeparator == '.' && /^\s*[-+]?[\s]*[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value)) {
                console.log('we are inside rendere 7')
                console.log('we are inside scientific notation :');
                console.log('// 1.6e6 1.60E+04  -13.65E4  - 12.3E+03  scientific notation with E sign');
                const formatter = new Intl.NumberFormat(userLocale, {
                  useGrouping: usegrouping_nbnb_if_true,
                  style: 'decimal',
                  minimumFractionDigits: afterdigit_nbnb,
                  maximumFractionDigits: afterdigit_nbnb,
                });
                const value7 = parseFloat(value.replace(/\s/g, ''));
                const formattedNumber = formatter.format(Number(value7));
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.innerHTML = formattedNumber + currencyht_toshow_nbnb;
                data22[row][col] = td.innerHTML;

              } else if (decimalSeparator == ',' && /^\s*[-+]?[\s]*[0-9]*,?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value)) {
                //console.log('----------------------------------------rendere 8 ---------------------------------------- rendere 8 ------------------------')
                console.log('we are inside rendere 8')
                console.log('we are inside scientific notation with comma :');
                console.log('// 1,6e6 1,60E+04  -13,65E4  - 12,3E+03  scientific notation with E sign');
                console.log('value inside scientific notation with comma else if : ')
                const value8 = parseFloat(value.replace(',', '.').replace(/\s/g, ''));
                console.log('value8 : ')
                console.log(value8)

                if (Math.abs(Number(value8)) < smallafterdigit_nbnb) {
                  console.log('ifnumbervalue2222<0.01 comma sceintific number')
                  console.log(Number(value8))
                  const formatter88 = new Intl.NumberFormat(userLocale, {
                    useGrouping: usegrouping_nbnb_if_true,
                    style: 'decimal',
                    maximumFractionDigits: afterdigitsmallnb_nbnb,
                  });
                  const formattedNumber88 = formatter88.format(value8);
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber88 + currencyht_toshow_nbnb;
                  data22[row][col] = td.innerHTML;

                } else {
                  const formatter = new Intl.NumberFormat(userLocale, {
                    useGrouping: usegrouping_nbnb_if_true,
                    style: 'decimal',
                    minimumFractionDigits: afterdigit_nbnb,
                    maximumFractionDigits: afterdigit_nbnb,
                  });
                  const formattedNumber = formatter.format(Number(value8));
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber + currencyht_toshow_nbnb;
                  console.log(td.innerHTML)
                  data22[row][col] = td.innerHTML;

                }
              } else {
                console.log('WE ARE INSIDE LAST ELSE RENDERER')
              }
            
            cellProperties.className = 'htRight'; 
              }
        },


       
        { 
          className: "htRight htMiddle" ,
          editor: PercentageEditor,
          validator: function (value, callback) { // validator of percentage
            const thisrow = this.row;
            const thiscol = this.col;
            //const value = oldvalue.replace(regexcurrenciesht, '');
            console.log('validator in percentage')
            console.log(value)

            if (value == null || // value == '' ||
              /^[-+]?(\s*\d+(\.\d+)?)\s*%$/.test(value.toString().trim()) || // for example 14.65%  "14.65 %"  
              /^[-+]?(\s*\d+(,\d+)?)\s*%$/.test(value.toString().trim()) || // for example 14,65%   "14,65 %"
              
              /^[-+]?(\s*\d+(\.\d+)?)\s*$/.test(value.toString().trim()) || // for example 14.65  "14.65 "  
              /^[-+]?(\s*\d+(,\d+)?)\s*$/.test(value.toString().trim()) // for example 14,65   "14,65 "
            ) {
              console.log('it returns true in percentage validator')             
              callback(true)              
            } else {
              console.log('we are in callback false percentage validator')
              callback(false);
            }
          },
          renderer: function (instance, td, row, col, prop, oldvalue, cellProperties) { // renderer of numbers or amounts
            //console.log('renderer percentage start')

            if (oldvalue==null){
            //console.log('renderer percentage 0 part')
            td.innerHTML='';
            data22[row][col] = td.innerHTML;      
            cellProperties.className = 'htRight'; 
            td.style.textAlign = 'right';
              
            } else if( //oldvalue == null || // value == '' ||
              /^[-+]?(\s*\d+(\.\d+)?)\s*%$/.test(oldvalue.toString().trim()) || // for example 14.65%  "14.65 %"  
              /^[-+]?(\s*\d+(,\d+)?)\s*%$/.test(oldvalue.toString().trim()) || // for example 14,65%   "14,65 %"
              
              /^[-+]?(\s*\d+(\.\d+)?)\s*$/.test(oldvalue.toString().trim()) || // for example 14.65  "14.65 "  
              /^[-+]?(\s*\d+(,\d+)?)\s*$/.test(oldvalue.toString().trim()) // for example 14,65   "14,65 "
            ) {
                 console.log('renderer percentage 1part')
                 const value_percentage_renderer = parseFloat(oldvalue.toString().replace(',', '.').replace('%','').replace(/\s/g, ''));
                 console.log(oldvalue)
                 console.log(value_percentage_renderer)
                 if(Math.abs(value_percentage_renderer)<smallafterdigit_percentage_percperc){
                  const formatter88_percentage = new Intl.NumberFormat(userLocale, {
                    style: 'decimal',
                    maximumFractionDigits: afterdigitsmallnb_percentage_percperc,
                    useGrouping: false // removing thousand separator
                  });
                  const formattedNumber88_percentage = formatter88_percentage.format(value_percentage_renderer);
                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber88_percentage+'%';
                  data22[row][col] = td.innerHTML+'%'

                 } else {
                 const formatter_percentage = new Intl.NumberFormat(userLocale, {
                    style: 'decimal',
                    minimumFractionDigits: afterdigit_percentage_percperc,
                    maximumFractionDigits: afterdigit_percentage_percperc,
                    useGrouping: false // removing thousand separator
                  });
                  console.log('renderer 2condition : ')
                  console.log(oldvalue)
                  console.log(value_percentage_renderer)
                  const formattedNumber_percentage = formatter_percentage.format(Number(value_percentage_renderer));
                  console.log(formattedNumber_percentage)

                  Handsontable.renderers.TextRenderer.apply(this, arguments);
                  td.innerHTML = formattedNumber_percentage+'%';
                //  console.log(td.innerHTML)
                  data22[row][col] = td.innerHTML+'%';      
                 //td.innerHTML=oldvalue;
                 cellProperties.className = 'htRight'; 
                 td.style.textAlign = 'right';
                 }
          }else {
            //console.log('renderer percentage 02 part')
            td.innerHTML='';
            data22[row][col] = td.innerHTML;      
            cellProperties.className = 'htRight'; 
            td.style.textAlign = 'right';
          }
          //console.log('renderer percentage end')

          }
        },


       { name:'rien' },


      { name: 'date',
       validator: function (value, callback) {  // validator of dates
         if( value==null || 
             /^\d{1,2}\/\d{1,2}\/\d{4}$/.test(value.trim().replace(/\s*\/\s*/g,"/")) ||  // "31/12 / 1995"
             /^\d{1,2}\-\d{1,2}\-\d{4}$/.test(value.trim().replace(/\s*-\s*/g,"-")) ||   // "31 - 12-1995"
             /^\d{1,2}\.\d{1,2}\.\d{4}$/.test(value.trim().replace(/\s*\.\s*/g,".")) ||   // "31.12. 1995"

             /^\d{4}\/\d{1,2}\/\d{1,2}$/.test(value.trim().replace(/\s*\/\s*/g,"/")) ||  // 1995/31/12
             /^\d{4}\-\d{1,2}\-\d{1,2}$/.test(value.trim().replace(/\s*-\s*/g,"-")) ||   // 1995-12-31
             /^\d{4}\.\d{1,2}\.\d{1,2}$/.test(value.trim().replace(/\s*\.\s*/g,".")) ||   // 1995.12.31

             /^\d{1,2}\/\d{1,2}\/\d{2}$/.test(value.trim().replace(/\s*\/\s*/g,"/")) ||   // 11/12/23
             /^\d{1,2}\-\d{1,2}\-\d{2}$/.test(value.trim().replace(/\s*-\s*/g,"-"))  ||   // 11-12-23
             /^\d{1,2}\.\d{1,2}\.\d{2}$/.test(value.trim().replace(/\s*\.\s*/g,".")) ||   // 11.12.23


             ///^\d{1,2}\/\d{1,2}$/.test(value.trim().replace(/\s*\/\s*/g,"/"))   // 01/12 25/12 99/11
             /^\d{1,2}\/\d{1,2}(\/)?$/.test(value.trim().replace(/\s*\/\s*/g,"/")) ||   // 01/12 25/12/ 99/11/
             /^\d{1,2}\-\d{1,2}(\-)?$/.test(value.trim().replace(/\s*-\s*/g,"-")) ||   // 01-12 25-12- 99-11-
             /^\d{1,2}\.\d{1,2}(\.)?$/.test(value.trim().replace(/\s*\.\s*/g,".")) ||  // 01.12 25.12. 99.11.
             
             /^\d{4}\/\d{1,2}(\/)?$/.test(value.trim().replace(/\s*\/\s*/g,"/")) ||   // 2023/12 2022/1/
             /^\d{4}\-\d{1,2}(\-)?$/.test(value.trim().replace(/\s*-\s*/g,"-")) ||   // 2001-12 2025-1-
             /^\d{4}\.\d{1,2}(\.)?$/.test(value.trim().replace(/\s*\.\s*/g,".")) ||   // 2001.2 2025.12.

             /^\d{1,2}\/\d{4}(\/)?$/.test(value.trim().replace(/\s*\/\s*/g,"/")) ||   // 12/2023 1/2022/
             /^\d{1,2}\-\d{4}(\-)?$/.test(value.trim().replace(/\s*-\s*/g,"-")) ||   // 12-2001 1-2025-
             /^\d{1,2}\.\d{4}(\.)?$/.test(value.trim().replace(/\s*\.\s*/g,".")) ||   // 3.2001 12.2025.

             /^\d{4}\/?$/.test(value.trim().replace(/\s*\/\s*/g,"/")) ||              // 2023  2022/
             /^\d{4}[-]?\s*$/.test(value.trim().replace(/\s*-\s*/g,"-")) ||              // 2023  2022-
             /^\d{4}[.]?\s*$/.test(value.trim().replace(/\s*\.\s*/g,"."))                 // 2023  2022.

         ){
           console.log('calback trueeeeeeeeeeeeee')
           callback(true)
         } else {
          console.log('calback falseeeeeeeeeeeeeee')
           callback(false)
         }

       },
       renderer: function (instance, td, row, col, prop, oldvalue, cellProperties) { // renderer of dates
            td.innerHTML=oldvalue;
            //data22[row][col] = td.innerHTML;      
            cellProperties.className = 'htRight'; 
            td.style.textAlign = 'right';
       }
      },


        { type: 'dropdown',
             source: ['','yellow', 'red', 'orange', 'green', 'blue', 'gray', 'black', 'white'], // editable later
             validator: function(value, callback) {  // editable
               if(value==null){
                 callback(true)
               }else if(['','yellow', 'red', 'orange', 'green', 'blue', 'gray', 'black', 'white'].includes(value)){
               callback(true)
             } else if (value===' ') {
               callback(true)
             } else {
               callback(false)
             }
             }
             
            },

        {className: "htRight htMiddle" ,   // emails
           validator: function(value, callback) { 
          console.log(value)
            if(value==null || /^[\w.-]+@[a-zA-Z0-9.,-]+\.[a-zA-Z]{2,}$/.test(value.trim()) ) {
                 callback(true)
             } else {
               callback(false)
             }
        },          
           renderer: function (instance, td, row, col, prop, oldvalue, cellProperties) { // renderer of dates
            td.innerHTML=oldvalue;
            //data22[row][col] = td.innerHTML;      
            cellProperties.className = 'htRight'; 
            td.style.textAlign = 'right';
       } 
      },
      { className: "htRight htMiddle" ,   // phone numbers,
         validator: function(value,callback){
          console.log(value)
            if(value==null || /^[\d+\(\)\/\s-]+$/.test(value.trim()) ) {
                 callback(true)
             } else {
               callback(false)
             }
         },
         renderer: function (instance, td, row, col, prop, oldvalue, cellProperties) { // renderer of dates
            td.innerHTML=oldvalue;
            //data22[row][col] = td.innerHTML;      
            cellProperties.className = 'htRight'; 
            td.style.textAlign = 'right';
            td.style.whiteSpace = 'normal' // wrap text
       } 

      },
      { type:'text' },

      ],
      afterValidate: function (isValid, oldvalue, row, prop, source) {
        const commentsPlugin = hot.getPlugin('comments');
        condition_split=true
        if(prop==4){  // afterValidate of dates,  editable the index later
        
          if (isValid && oldvalue == null ) {
            console.log('condition date 1')
            console.log('we are inside afterValidate date oldvalue==null')
            console.log('COULD END HERE')
            commentsPlugin.removeCommentAtCell(row, prop);
          } else if (isValid && oldvalue !== undefined && typeof oldvalue === 'string'){
            console.log('condition date 2')
               if(/\s+/.test(oldvalue)){
                 console.log('condition date 2.1 removes whitespaces')
                this.setDataAtCell(row, prop, oldvalue.trim().replace(/\s*\/\s*/g,"/").replace(/\s*-\s*/g,"-").replace(/\s*\.\s*/g,"."),'my_source_removewhitespacesign_date')
                commentsPlugin.removeCommentAtCell(row, prop);
               }else{
                console.log('condition date 2.2')
                if(/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(oldvalue.trim().replace(/\s*\/\s*/g,"/"))){
                  console.log('condition date 2.2.1  31/12/1995 like fr-FR and european an (en-US but with switching month and days) ')                  
                  var splitdate01='/';
                  if(navigator_language=='en-US' && usTimeZones.includes(userTimeZone)){
                    var [monthdate,daydate, yeardate] = oldvalue.split(splitdate01); // edit it modify it change it , when US date format occurs                  
                    // isValidDate('35/02/2002','/',1,2,3)
                    var is_validate_date=isValidDate(oldvalue,'/',2,1,3)
                  } else {
                    var [daydate,monthdate, yeardate] = oldvalue.split(splitdate01); // edit it modify it change it , when US date format occurs                  
                    isValidDate(oldvalue,'/',1,2,3);
                    var is_validate_date=isValidDate(oldvalue,'/',1,2,3)
                    console.log(is_validate_date)
                  }
                  if(is_validate_date){
                    console.log('daydate check : ')
                    console.log(daydate)                    
                    console.log('monthdate check : ')
                    console.log(monthdate)


                   if(navigator_language=='en-US'){
                   // 'jj/mm/aaaa' // 'mm/dd/yyyy'; // 12/31/1990 edit it later , modify it later  , change it later
                   var splitdate001='/';
                   if(usTimeZones.includes(userTimeZone)){
                         // var dateformatlanguage = 'mm/dd/aaaa';
                    
              if(daydate.toString().length==1 && monthdate.toString().length==1){
                           daydate='0'+daydate;
                           monthdate='0'+monthdate;
              this.setDataAtCell(row, prop, monthdate+splitdate001+daydate+splitdate001+yeardate,'my_source_date')

              } else if(daydate.toString().length==1 && monthdate.toString().length==2){
                           daydate='0'+daydate;
              this.setDataAtCell(row, prop, monthdate+splitdate001+daydate+splitdate001+yeardate,'my_source_date')
              } else if(daydate.toString().length==2 && monthdate.toString().length==1){
                           monthdate='0'+monthdate;  
              this.setDataAtCell(row, prop, monthdate+splitdate001+daydate+splitdate001+yeardate,'my_source_date')
              } else {
                           console.log('COULD END HERE')
                           commentsPlugin.removeCommentAtCell(row, prop);
                       }

                         } else {
                          if(daydate.toString().length==1 && monthdate.toString().length==1){
                           daydate='0'+daydate;
                           monthdate='0'+monthdate;
              this.setDataAtCell(row, prop, daydate+splitdate001+monthdate+splitdate001+yeardate,'my_source_date')

              } else if(daydate.toString().length==1 && monthdate.toString().length==2){
                           daydate='0'+daydate;
                           this.setDataAtCell(row, prop, daydate+splitdate001+monthdate+splitdate001+yeardate,'my_source_date')
              } else if(daydate.toString().length==2 && monthdate.toString().length==1){
                           monthdate='0'+monthdate;  
                           this.setDataAtCell(row, prop, daydate+splitdate001+monthdate+splitdate001+yeardate,'my_source_date')
              } else {
                           console.log('COULD END HERE')
                           commentsPlugin.removeCommentAtCell(row, prop);
                       }
                         }

                  } else if(navigator_language=='ko-KR' || navigator_language=='hu-HU'){
                    // 'aaaa.mm.jj'
                    var splitdate1='.';
                    this.setDataAtCell(row, prop, yeardate+splitdate1+monthdate+splitdate1+daydate,'my_source_date')
                    console.log('new date format : ' + yeardate+splitdate1+monthdate+splitdate1+daydate)

                  } else if(navigator_language=='ja-JP' || navigator_language=='ZH-CN'){
                    var splitdate1='/';
                    this.setDataAtCell(row, prop, yeardate+splitdate1+monthdate+splitdate1+daydate,'my_source_date')
                    console.log('new date format : ' + yeardate+splitdate1+monthdate+splitdate1+daydate)

    } else if(navigator_language=='en-CA'){
                    // 'aaaa-mm-jj' //'yyyy-mm-dd' // 1990-12-31
                    var splitdate1='-';
                    this.setDataAtCell(row, prop, yeardate+splitdate1+monthdate+splitdate1+daydate,'my_source_date')
                    console.log('new date format : ' + yeardate+splitdate1+monthdate+splitdate1+daydate)


    } else if(navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR'){
                    //'jj.mm.aaaa' //'dd.mm.yyyy' // 12.31.1990
                    var splitdate1='.';
                    this.setDataAtCell(row, prop, daydate+splitdate1+monthdate+splitdate1+yeardate,'my_source_date')
                    console.log('new date format : ' + daydate+splitdate1+monthdate+splitdate1+yeardate)

    } else {
      // european and other formats
      //'jj/mm/aaaa' // 'dd/mm/yyyy' // 31/12/1990
      var splitdate001 = '/';
      if(daydate.toString().length==1 && monthdate.toString().length==1){
                           daydate='0'+daydate;
                           monthdate='0'+monthdate;
                           console.log(daydate+splitdate001+monthdate+splitdate001+yeardate)
              this.setDataAtCell(row, prop, daydate+splitdate001+monthdate+splitdate001+yeardate,'my_source_date')

              } else if(daydate.toString().length==1 && monthdate.toString().length==2){
                           daydate='0'+daydate;
                           this.setDataAtCell(row, prop, daydate+splitdate001+monthdate+splitdate001+yeardate,'my_source_date')
              } else if(daydate.toString().length==2 && monthdate.toString().length==1){
                           monthdate='0'+monthdate;  
                           this.setDataAtCell(row, prop, daydate+splitdate001+monthdate+splitdate001+yeardate,'my_source_date')
              } else {
                           console.log('COULD END HERE')
                           commentsPlugin.removeCommentAtCell(row, prop);
                       }
    }
  } else {
    console.log('is_validate_date is false')
    console.log(row)
    console.log(prop)
    //commentsPlugin.setCommentAtCell(row, prop, "la date '" + oldvalue + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  ");
    commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'date_try_to_fix','fr-FR'))
    this.setDataAtCell(row, prop,'','my_source_empty_date')
  }
                }
  // **********************************************************************************
  // **********************************************************************************
  // ************************ condition date finished 2.2.1 *********************************
  // **********************************************************************************
  // **********************************************************************************
                
                else if (/^\d{1,2}\-\d{1,2}\-\d{4}$/.test(oldvalue.trim().replace(/\s*-\s*/g,"-"))){
                  console.log('condition date 2.2.2  31-12-1995 like no one')                  
                  var splitdate02='-';
                  //var [daydate,monthdate, yeardate] = oldvalue.split(splitdate02); // edit it modify it change it , when US date format occurs                  
                  if(navigator_language=='en-US' && usTimeZones.includes(userTimeZone)){
                    var [monthdate,daydate, yeardate] = oldvalue.split(splitdate02); // edit it modify it change it , when US date format occurs                  
                    // isValidDate('35/02/2002','/',1,2,3)
                    var is_validate_date=isValidDate(oldvalue,'-',2,1,3)
                  } else {
                    var [daydate,monthdate, yeardate] = oldvalue.split(splitdate02); // edit it modify it change it , when US date format occurs                  
                    isValidDate(oldvalue,'/',1,2,3);
                    var is_validate_date=isValidDate(oldvalue,'-',1,2,3)
                    console.log(is_validate_date)

                  }
                  if(is_validate_date){
                  
                   if(navigator_language=='en-US'){
                   // 'jj/mm/aaaa' // 'mm/dd/yyyy'; // 12/31/1990 edit it later , modify it later  , change it later
                   if(usTimeZones.includes(userTimeZone)){
                    var splitdate1='/';
                    this.setDataAtCell(row, prop, monthdate+splitdate1+daydate+splitdate1+yeardate,'my_source_date')
                    console.log('new date format : ' + monthdate+splitdate1+daydate+splitdate1+yeardate)   
                  
                   } else {
                    var splitdate1='/';
                    this.setDataAtCell(row, prop, daydate+splitdate1+monthdate+splitdate1+yeardate,'my_source_date')
                    console.log('new date format : ' + daydate+splitdate1+monthdate+splitdate1+yeardate)   
                  }
                  } else if(navigator_language=='ko-KR' || navigator_language=='hu-HU'){
                    // 'aaaa.mm.jj'
                    var splitdate1='.';
                    this.setDataAtCell(row, prop, yeardate+splitdate1+monthdate+splitdate1+daydate,'my_source_date')
                    console.log('new date format : ' + yeardate+splitdate1+monthdate+splitdate1+daydate)

                  } else if(navigator_language=='ja-JP' || navigator_language=='ZH-CN'){
                    var splitdate1='/';
                    this.setDataAtCell(row, prop, yeardate+splitdate1+monthdate+splitdate1+daydate,'my_source_date')
                    console.log('new date format : ' + yeardate+splitdate1+monthdate+splitdate1+daydate)

    } else if(navigator_language=='en-CA'){
                    // 'aaaa-mm-jj' //'yyyy-mm-dd' // 1990-12-31
                    var splitdate1='-';
                    this.setDataAtCell(row, prop, yeardate+splitdate1+monthdate+splitdate1+daydate,'my_source_date')
                    console.log('new date format : ' + yeardate+splitdate1+monthdate+splitdate1+daydate)


    } else if(navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR'){
                    //'jj.mm.aaaa' //'dd.mm.yyyy' // 12.31.1990
                    var splitdate1='.';
                    this.setDataAtCell(row, prop, daydate+splitdate1+monthdate+splitdate1+yeardate,'my_source_date')
                    console.log('new date format : ' + daydate+splitdate1+monthdate+splitdate1+yeardate)

    } else {
                    var splitdate1='/';
                    this.setDataAtCell(row, prop, daydate+splitdate1+monthdate+splitdate1+yeardate,'my_source_date')
                    console.log('new date format : ' + daydate+splitdate1+monthdate+splitdate1+yeardate)   
    } 
  } else {
    //commentsPlugin.setCommentAtCell(row, prop, "la date '" + oldvalue + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  ");
    commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'date_try_to_fix','fr-FR'))
    this.setDataAtCell(row, prop,'','my_source_empty_date')
  }

  // **********************************************************************************
  // **********************************************************************************
  // ************************ condition date 2 finished *********************************
  // **********************************************************************************
  // **********************************************************************************

  } else if (/^\d{1,2}\.\d{1,2}\.\d{4}$/.test(oldvalue.trim().replace(/\s*\.\s*/g,".")) ){
                  console.log('condition date 2.2.3  31.12.1995 like  de-DE date format ')                  
                  var splitdate03='.';
                  if(navigator_language=='en-US' && usTimeZones.includes(userTimeZone)){
                    var [monthdate,daydate, yeardate] = oldvalue.split(splitdate03); // edit it modify it change it , when US date format occurs                  
                    var is_validate_date=isValidDate(oldvalue,'.',2,1,3)
                  } else {
                    var [daydate,monthdate, yeardate] = oldvalue.split(splitdate03); // edit it modify it change it , when US date format occurs                  
                    var is_validate_date=isValidDate(oldvalue,'.',1,2,3)
                    //console.log(is_validate_date)

                  }
                  if(is_validate_date){
                                    
                  if(navigator_language=='en-US'){
                   // 'jj/mm/aaaa' // 'mm/dd/yyyy'; // 12/31/1990 edit it later , modify it later  , change it later
                    if(usTimeZones.includes(userTimeZone)){
                      var splitdate1='/';
                      this.setDataAtCell(row, prop, daydate+splitdate1+monthdate+splitdate1+yeardate,'my_source_date')
                      console.log('new date format : ' + monthdate+splitdate1+daydate+splitdate1+yeardate)
                    } else {
                      var splitdate1='/';
                      this.setDataAtCell(row, prop, daydate+splitdate1+monthdate+splitdate1+yeardate,'my_source_date')
                      console.log('new date format : ' + daydate+splitdate1+monthdate+splitdate1+yeardate)
                    }
                    
                  } else if(navigator_language=='ko-KR' || navigator_language=='hu-HU'){
                    // 'aaaa.mm.jj'
                    var splitdate1='.';
                    this.setDataAtCell(row, prop, yeardate+splitdate1+monthdate+splitdate1+daydate,'my_source_date')
                    console.log('new date format : ' + yeardate+splitdate1+monthdate+splitdate1+daydate)

                  } else if(navigator_language=='ja-JP' || navigator_language=='ZH-CN'){
                    var splitdate1='/';
                    this.setDataAtCell(row, prop, yeardate+splitdate1+monthdate+splitdate1+daydate,'my_source_date')
                    console.log('new date format : ' + yeardate+splitdate1+monthdate+splitdate1+daydate)

    } else if(navigator_language=='en-CA'){
                    // 'aaaa-mm-jj' //'yyyy-mm-dd' // 1990-12-31
                    var splitdate1='-';
                    this.setDataAtCell(row, prop, yeardate+splitdate1+monthdate+splitdate1+daydate,'my_source_date')
                    console.log('new date format : ' + yeardate+splitdate1+monthdate+splitdate1+daydate)


    } else if(navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR'){
                    //'jj.mm.aaaa' //'dd.mm.yyyy' // 12.31.1990
                    //var splitdate1='.';
                    //this.setDataAtCell(row, prop, daydate+splitdate1+monthdate+splitdate1+yeardate)
                    //console.log('new date format : ' + daydate+splitdate1+monthdate+splitdate1+yeardate)
                    
                    
                    var splitdate003 = '.';
      if(daydate.toString().length==1 && monthdate.toString().length==1){
                           daydate='0'+daydate;
                           monthdate='0'+monthdate;
                           console.log(daydate+splitdate003+monthdate+splitdate003+yeardate)
              this.setDataAtCell(row, prop, daydate+splitdate003+monthdate+splitdate003+yeardate,'my_source_date')

              } else if(daydate.toString().length==1 && monthdate.toString().length==2){
                           daydate='0'+daydate;
                           this.setDataAtCell(row, prop, daydate+splitdate003+monthdate+splitdate003+yeardate,'my_source_date')
              } else if(daydate.toString().length==2 && monthdate.toString().length==1){
                           monthdate='0'+monthdate;  
                           this.setDataAtCell(row, prop, daydate+splitdate003+monthdate+splitdate003+yeardate,'my_source_date')
              } else {
                           console.log('COULD END HERE')
                           commentsPlugin.removeCommentAtCell(row, prop);
                       }

    } else {
      // european and other formats
      //'jj/mm/aaaa' // 'dd/mm/yyyy' // 31/12/1990
                    var splitdate1='/';
                    this.setDataAtCell(row, prop, daydate+splitdate1+monthdate+splitdate1+yeardate,'my_source_date')
                    console.log('new date format : ' + daydate+splitdate1+monthdate+splitdate1+yeardate)   
                     }
                  } else {                
                    //commentsPlugin.setCommentAtCell(row, prop, "la date '" + oldvalue + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  ");
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'date_try_to_fix','fr-FR'))

                    this.setDataAtCell(row, prop,'','my_source_empty_date')
                 }   
                
  // **********************************************************************************
  // **********************************************************************************
  // ************************ condition date 2.2.3  31.12.1995 finished *********************************
  // **********************************************************************************
  // **********************************************************************************

} else if (/^\d{4}\/\d{1,2}\/\d{1,2}$/.test(oldvalue.trim().replace(/\s*\/\s*/g,"/")) ) {
    // 1995/12/31
    console.log('condition date 2.2.4  1995/12/31 like ja-JP')
                    
                  var splitdate04='/';
                  if(navigator_language=='en-US' && usTimeZones.includes(userTimeZone)){
                    var [yeardate,daydate,monthdate] = oldvalue.split(splitdate04); // edit it modify it change it , when US date format occurs                  
                    var is_validate_date=isValidDate(oldvalue,'/',3,1,2)
                  } else {
                    var [yeardate,monthdate,daydate] = oldvalue.split(splitdate04); // edit it modify it change it , when US date format occurs                  
                    var is_validate_date=isValidDate(oldvalue,'/',3,2,1)
                    //console.log(is_validate_date)

                  }
                  if(is_validate_date){
                                    
                  if(navigator_language=='en-US'){
                   // 'jj/mm/aaaa' // 'mm/dd/yyyy'; // 12/31/1990 edit it later , modify it later  , change it later
                    if(usTimeZones.includes(userTimeZone)){
                      var splitdate1='/';
                      this.setDataAtCell(row, prop, monthdate+splitdate1+daydate+splitdate1+yeardate,'my_source_date')
                      console.log('new date format : ' + monthdate+splitdate1+daydate+splitdate1+yeardate)
                    } else {
                      var splitdate1='/';
                      this.setDataAtCell(row, prop, daydate+splitdate1+monthdate+splitdate1+yeardate,'my_source_date')
                      console.log('new date format : ' + daydate+splitdate1+monthdate+splitdate1+yeardate)
                    }
                    
                  } else if(navigator_language=='ko-KR' || navigator_language=='hu-HU'){
                    // 'aaaa.mm.jj'
                    var splitdate1='.';
                    this.setDataAtCell(row, prop, yeardate+splitdate1+monthdate+splitdate1+daydate,'my_source_date')
                    console.log('new date format : ' + yeardate+splitdate1+monthdate+splitdate1+daydate)

                  } else if(navigator_language=='ja-JP' || navigator_language=='ZH-CN'){
                        // 1990/12/31
                    //var splitdate1='/';
                    //this.setDataAtCell(row, prop, yeardate+splitdate1+monthdate+splitdate1+daydate)
                    //console.log('new date format : ' + yeardate+splitdate1+monthdate+splitdate1+daydate)

                    var splitdate004 = '/';
      if(daydate.toString().length==1 && monthdate.toString().length==1){
                           daydate='0'+daydate;
                           monthdate='0'+monthdate;
              this.setDataAtCell(row, prop, yeardate+splitdate004+monthdate+splitdate004+daydate,'my_source_date')

              } else if(daydate.toString().length==1 && monthdate.toString().length==2){
                           daydate='0'+daydate;
                           this.setDataAtCell(row, prop, yeardate+splitdate004+monthdate+splitdate004+daydate,'my_source_date')
              } else if(daydate.toString().length==2 && monthdate.toString().length==1){
                           monthdate='0'+monthdate;  
                           this.setDataAtCell(row, prop, yeardate+splitdate004+monthdate+splitdate004+daydate,'my_source_date')
              } else {
                           console.log('COULD END HERE')
                           commentsPlugin.removeCommentAtCell(row, prop);
                       }


    } else if(navigator_language=='en-CA'){
                    // 'aaaa-mm-jj' //'yyyy-mm-dd' // 1990-12-31
                    var splitdate1='-';
                    this.setDataAtCell(row, prop, yeardate+splitdate1+monthdate+splitdate1+daydate,'my_source_date')
                    console.log('new date format : ' + yeardate+splitdate1+monthdate+splitdate1+daydate)

                    //console.log('COULD END HERE')
                    //commentsPlugin.removeCommentAtCell(row, prop);


    } else if(navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR'){
                    //'jj.mm.aaaa' //'dd.mm.yyyy' // 12.31.1990
                    var splitdate1='.';
                    this.setDataAtCell(row, prop, daydate+splitdate1+monthdate+splitdate1+yeardate,'my_source_date')
                    console.log('new date format : ' + daydate+splitdate1+monthdate+splitdate1+yeardate)
                    //console.log('COULD END HERE')
                    //commentsPlugin.removeCommentAtCell(row, prop);

    } else {
      // european and other formats
      //'jj/mm/aaaa' // 'dd/mm/yyyy' // 31/12/1990
                    var splitdate1='/';
                    this.setDataAtCell(row, prop, daydate+splitdate1+monthdate+splitdate1+yeardate,'my_source_date')
                    console.log('new date format : ' + daydate+splitdate1+monthdate+splitdate1+yeardate)   
                     }
                  } else {                
                    //commentsPlugin.setCommentAtCell(row, prop, "la date '" + oldvalue + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  ");
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'date_try_to_fix','fr-FR'))

                    this.setDataAtCell(row, prop,'','my_source_empty_date')
                 }
  // **********************************************************************************
  // **********************************************************************************
  // ************************ condition date 2.2.4  1995/12/31 finished *********************************
  // **********************************************************************************
  // **********************************************************************************
    } else if (/^\d{4}\-\d{1,2}\-\d{1,2}$/.test(oldvalue.trim().replace(/\s*-\s*/g,"-")) ) {
    // 1995-12-31 5rd condition
    console.log('condition date 2.2.5  1995-12-31 like en-CA')

                  var splitdate05='-';
                  if(navigator_language=='en-US' && usTimeZones.includes(userTimeZone)){
                    var [yeardate,daydate,monthdate] = oldvalue.split(splitdate05); // edit it modify it change it , when US date format occurs                  
                    var is_validate_date=isValidDate(oldvalue,'-',3,1,2)
                  } else {
                    var [yeardate,monthdate,daydate] = oldvalue.split(splitdate05); // edit it modify it change it , when US date format occurs                  
                    var is_validate_date=isValidDate(oldvalue,'-',3,2,1)
                    //console.log(is_validate_date)

                  }
                  if(is_validate_date){
                                    
                  if(navigator_language=='en-US'){
                   // 'jj/mm/aaaa' // 'mm/dd/yyyy'; // 12/31/1990 edit it later , modify it later  , change it later
                    if(usTimeZones.includes(userTimeZone)){
                      var splitdate1='/';
                      this.setDataAtCell(row, prop, monthdate+splitdate1+daydate+splitdate1+yeardate,'my_source_date')
                      console.log('new date format : ' + monthdate+splitdate1+daydate+splitdate1+yeardate)
                    } else {
                      var splitdate1='/';
                      this.setDataAtCell(row, prop, daydate+splitdate1+monthdate+splitdate1+yeardate,'my_source_date')
                      console.log('new date format : ' + daydate+splitdate1+monthdate+splitdate1+yeardate)
                    }
                    
                  } else if(navigator_language=='ko-KR' || navigator_language=='hu-HU'){
                    // 'aaaa.mm.jj'
                    var splitdate1='.';
                    this.setDataAtCell(row, prop, yeardate+splitdate1+monthdate+splitdate1+daydate,'my_source_date')
                    console.log('new date format : ' + yeardate+splitdate1+monthdate+splitdate1+daydate)

                  } else if(navigator_language=='ja-JP' || navigator_language=='ZH-CN'){
                        // 1990/12/31
                    var splitdate1='/';
                    this.setDataAtCell(row, prop, yeardate+splitdate1+monthdate+splitdate1+daydate,'my_source_date')
                    console.log('new date format : ' + yeardate+splitdate1+monthdate+splitdate1+daydate)

                    

    } else if(navigator_language=='en-CA'){
                    // 'aaaa-mm-jj' //'yyyy-mm-dd' // 1990-12-31


                    var splitdate005 = '-';
      if(daydate.toString().length==1 && monthdate.toString().length==1){
                           daydate='0'+daydate;
                           monthdate='0'+monthdate;
              this.setDataAtCell(row, prop, yeardate+splitdate005+monthdate+splitdate005+daydate,'my_source_date')

              } else if(daydate.toString().length==1 && monthdate.toString().length==2){
                           daydate='0'+daydate;
                           this.setDataAtCell(row, prop, yeardate+splitdate005+monthdate+splitdate005+daydate,'my_source_date')
              } else if(daydate.toString().length==2 && monthdate.toString().length==1){
                           monthdate='0'+monthdate;  
                           this.setDataAtCell(row, prop, yeardate+splitdate005+monthdate+splitdate005+daydate,'my_source_date')
              } else {
                           console.log('COULD END HERE')
                           commentsPlugin.removeCommentAtCell(row, prop);
                       }
                    //var splitdate1='-';
                    //this.setDataAtCell(row, prop, yeardate+splitdate1+monthdate+splitdate1+daydate)
                    //console.log('new date format : ' + yeardate+splitdate1+monthdate+splitdate1+daydate)


    } else if(navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR'){
                    //'jj.mm.aaaa' //'dd.mm.yyyy' // 12.31.1990
                    var splitdate1='.';
                    this.setDataAtCell(row, prop, daydate+splitdate1+monthdate+splitdate1+yeardate,'my_source_date')
                    console.log('new date format : ' + daydate+splitdate1+monthdate+splitdate1+yeardate)
                    //console.log('COULD END HERE')
                    //commentsPlugin.removeCommentAtCell(row, prop);

    } else {
      // european and other formats
      //'jj/mm/aaaa' // 'dd/mm/yyyy' // 31/12/1990
                    var splitdate1='/';
                    this.setDataAtCell(row, prop, daydate+splitdate1+monthdate+splitdate1+yeardate,'my_source_date')
                    console.log('new date format : ' + daydate+splitdate1+monthdate+splitdate1+yeardate)   
                     }
                  } else {                
                    //commentsPlugin.setCommentAtCell(row, prop, "la date '" + oldvalue + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  ");
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'date_try_to_fix','fr-FR'))
                    this.setDataAtCell(row, prop,'','my_source_empty_date')
                 }
  // **********************************************************************************
  // **********************************************************************************
  // ************************ condition date 2.2.5  1995-12-31 finished *********************************
  // **********************************************************************************
  // **********************************************************************************
} else if (/^\d{4}\.\d{1,2}\.\d{1,2}$/.test(oldvalue.trim().replace(/\s*\.\s*/g,".")) ) {
    // 1995.12.31 6rd condition
    console.log('condition date 2.2.6  1995.12.31 like ko-KR')

                  var splitdate06='.';
                  if(navigator_language=='en-US' && usTimeZones.includes(userTimeZone)){
                    var [yeardate,daydate,monthdate] = oldvalue.split(splitdate06); // edit it modify it change it , when US date format occurs                  
                    var is_validate_date=isValidDate(oldvalue,'.',3,1,2)
                  } else {
                    var [yeardate,monthdate,daydate] = oldvalue.split(splitdate06); // edit it modify it change it , when US date format occurs                  
                    var is_validate_date=isValidDate(oldvalue,'.',3,2,1)
                    //console.log(is_validate_date)

                  }
                  if(is_validate_date){
                                    
                  if(navigator_language=='en-US'){
                   // 'jj/mm/aaaa' // 'mm/dd/yyyy'; // 12/31/1990 edit it later , modify it later  , change it later
                    if(usTimeZones.includes(userTimeZone)){
                      var splitdate1='/';
                      this.setDataAtCell(row, prop, monthdate+splitdate1+daydate+splitdate1+yeardate,'my_source_date')
                      console.log('new date format : ' + monthdate+splitdate1+daydate+splitdate1+yeardate)
                    } else {
                      var splitdate1='/';
                      this.setDataAtCell(row, prop, daydate+splitdate1+monthdate+splitdate1+yeardate,'my_source_date')
                      console.log('new date format : ' + daydate+splitdate1+monthdate+splitdate1+yeardate)
                    }
                    
                  } else if(navigator_language=='ko-KR' || navigator_language=='hu-HU'){
                    // 'aaaa.mm.jj'
                    //var splitdate1='.';
                    //this.setDataAtCell(row, prop, yeardate+splitdate1+monthdate+splitdate1+daydate)
                    //console.log('new date format : ' + yeardate+splitdate1+monthdate+splitdate1+daydate)


                    var splitdate006 = '.';
      if(daydate.toString().length==1 && monthdate.toString().length==1){
                           daydate='0'+daydate;
                           monthdate='0'+monthdate;
              this.setDataAtCell(row, prop, yeardate+splitdate006+monthdate+splitdate006+daydate,'my_source_date')

              } else if(daydate.toString().length==1 && monthdate.toString().length==2){
                           daydate='0'+daydate;
                           this.setDataAtCell(row, prop, yeardate+splitdate006+monthdate+splitdate006+daydate,'my_source_date')
              } else if(daydate.toString().length==2 && monthdate.toString().length==1){
                           monthdate='0'+monthdate;  
                           this.setDataAtCell(row, prop, yeardate+splitdate006+monthdate+splitdate006+daydate,'my_source_date')
              } else {
                           console.log('COULD END HERE')
                           commentsPlugin.removeCommentAtCell(row, prop);
                       }
                  } else if(navigator_language=='ja-JP' || navigator_language=='ZH-CN'){
                        // 1990/12/31
                    var splitdate1='/';
                    this.setDataAtCell(row, prop, yeardate+splitdate1+monthdate+splitdate1+daydate,'my_source_date')
                    console.log('new date format : ' + yeardate+splitdate1+monthdate+splitdate1+daydate)

                    

    } else if(navigator_language=='en-CA'){
                    // 'aaaa-mm-jj' //'yyyy-mm-dd' // 1990-12-31
                    var splitdate1='-';
                    this.setDataAtCell(row, prop, yeardate+splitdate1+monthdate+splitdate1+daydate,'my_source_date')
                    console.log('new date format : ' + yeardate+splitdate1+monthdate+splitdate1+daydate)
                    
                    //console.log('COULD END HERE')
                    //commentsPlugin.removeCommentAtCell(row, prop);

    } else if(navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR'){
                    //'jj.mm.aaaa' //'dd.mm.yyyy' // 12.31.1990
                    var splitdate1='.';
                    this.setDataAtCell(row, prop, daydate+splitdate1+monthdate+splitdate1+yeardate,'my_source_date')
                    console.log('new date format : ' + daydate+splitdate1+monthdate+splitdate1+yeardate)
                    //console.log('COULD END HERE')
                    //commentsPlugin.removeCommentAtCell(row, prop);

    } else {
      // european and other formats
      //'jj/mm/aaaa' // 'dd/mm/yyyy' // 31/12/1990
                    var splitdate1='/';
                    this.setDataAtCell(row, prop, daydate+splitdate1+monthdate+splitdate1+yeardate,'my_source_date')
                    console.log('new date format : ' + daydate+splitdate1+monthdate+splitdate1+yeardate)   
                     }
                  } else {                
                    //commentsPlugin.setCommentAtCell(row, prop, "la date '" + oldvalue + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  ");
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'date_try_to_fix','fr-FR'))

                    this.setDataAtCell(row, prop,'','my_source_empty_date')
                 }
// **********************************************************************************
  // **********************************************************************************
  // ************************ condition date 2.2.6  1995.12.31 finished *********************************
  // **********************************************************************************
  // **********************************************************************************
                } else if(/^\d{1,2}\/\d{1,2}\/\d{2}$/.test(oldvalue.trim().replace(/\s*\/\s*/g,"/")) ){
                  console.log('condition date 2.2.7  31/12/95 like fr-FR and european an (en-US but with switching month and days) ')                  
                  var splitdate01='/';
                  if(navigator_language=='en-CA' || navigator_language=='ko-KR' || navigator_language=='hu-HU' || navigator_language=='ja-JP' || navigator_language=='ZH-CN' ){
                    var [yeardate,monthdate,daydate] = oldvalue.split(splitdate01); // edit it modify it change it , when US date format occurs                  
                    if(Number(yeardate)>30){
                      yeardate='19'+yeardate;
                    } else {
                      yeardate='20'+yeardate
                    }
                    this.setDataAtCell(row, prop,yeardate+splitdate01+monthdate+splitdate01+daydate,'my_source_date')
                  } else {
                    //if(navigator_language=='en-US' || navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR' ){
                    var [daydate,monthdate,yeardate] = oldvalue.split(splitdate01); // edit it modify it change it , when US date format occurs                  

                    if(Number(yeardate)>30){
                      yeardate='19'+yeardate;
                    } else {
                      yeardate='20'+yeardate
                    }
                    this.setDataAtCell(row, prop,daydate+splitdate01+monthdate+splitdate01+yeardate,'my_source_date')
                  }
                  
                  
  // **********************************************************************************
  // **********************************************************************************
  // ************************ condition date finished 2.2.7 *********************************
  // **********************************************************************************
  // **********************************************************************************
} else if(/^\d{1,2}\-\d{1,2}\-\d{2}$/.test(oldvalue.trim().replace(/\s*-\s*/g,"-")) ){
                  console.log('condition date 2.2.8  31-12-95  ')                  
                  var splitdate01='-';
                  if(navigator_language=='en-CA' || navigator_language=='ko-KR' || navigator_language=='hu-HU' || navigator_language=='ja-JP' || navigator_language=='ZH-CN' ){   // maybe edit later change it later modify it later
                    var [yeardate,monthdate,daydate] = oldvalue.split(splitdate01); // edit it modify it change it , when US date format occurs                  
                    if(Number(yeardate)>30){
                      yeardate='19'+yeardate;
                    } else {
                      yeardate='20'+yeardate
                    }
                    this.setDataAtCell(row, prop,yeardate+splitdate01+monthdate+splitdate01+daydate,'my_source_date')
                  } else {
                    //if(navigator_language=='en-US' || navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR' ){
                    var [daydate,monthdate,yeardate] = oldvalue.split(splitdate01); // edit it modify it change it , when US date format occurs                  

                    if(Number(yeardate)>30){
                      yeardate='19'+yeardate;
                    } else {
                      yeardate='20'+yeardate
                    }
                    this.setDataAtCell(row, prop,daydate+splitdate01+monthdate+splitdate01+yeardate,'my_source_date')
                  }
                  
                  
  // **********************************************************************************
  // **********************************************************************************
  // ************************ condition date finished 2.2.8 *********************************
  // **********************************************************************************
  // **********************************************************************************
} else if(/^\d{1,2}\.\d{1,2}\.\d{2}$/.test(oldvalue.trim().replace(/\s*\.\s*/g,".")) ){
                  console.log('condition date 2.2.9  31.12.95  ')                  
                  var splitdate01='.';
                  if(navigator_language=='en-CA' || navigator_language=='ko-KR' || navigator_language=='hu-HU' || navigator_language=='ja-JP' || navigator_language=='ZH-CN' ){   // maybe edit later change it later modify it later
                    var [yeardate,monthdate,daydate] = oldvalue.split(splitdate01); // edit it modify it change it , when US date format occurs                  
                    if(Number(yeardate)>30){
                      yeardate='19'+yeardate;
                    } else {
                      yeardate='20'+yeardate;
                    }
                    this.setDataAtCell(row, prop,yeardate+splitdate01+monthdate+splitdate01+daydate,'my_source_date')
                  } else {
                    //if(navigator_language=='en-US' || navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR' ){
                    var [daydate,monthdate,yeardate] = oldvalue.split(splitdate01); // edit it modify it change it , when US date format occurs                  

                    if(Number(yeardate)>30){
                      yeardate='19'+yeardate;
                    } else {
                      yeardate='20'+yeardate
                    }
                    this.setDataAtCell(row, prop,daydate+splitdate01+monthdate+splitdate01+yeardate,'my_source_date')
                  }
  // **********************************************************************************
  // **********************************************************************************
  // ************************ condition date finished 2.2.9 *********************************
  // **********************************************************************************
  // **********************************************************************************
                  } else if (/^\d{1,2}\/\d{1,2}(\/)?$/.test(oldvalue.trim().replace(/\s*\/\s*/g,"/"))){
                    console.log('condition date 2.2.10   like  31/12 12/06/  13/23 1/3 ')     
                    console.log(oldvalue)             
                    var splitdate01='/';
                    var [datepart1,datepart2] =  oldvalue.split(splitdate01)
                    console.log(datepart1)
                    console.log(datepart2)
                    if(navigator_language=='en-CA' || navigator_language=='ko-KR' || navigator_language=='hu-HU' || navigator_language=='ja-JP' || navigator_language=='ZH-CN' ){   // maybe edit later change it later modify it later
                    //var [yeardate,monthdate,daydate] = oldvalue.split(splitdate01); // edit it modify it change it , when US date format occurs                  
                    var [datepart1,datepart2] =  oldvalue.split(splitdate01)

                    if(Number(datepart2)>12){
                      var [daydate,monthdate,yeardate]=["01",datepart1,datepart2]
                      //yeardate='19'+yeardate;
                    } else {
                      const currentDate = new Date();
                      const currentYear = currentDate.getFullYear();
                      var [daydate,monthdate,yeardate]=[datepart1,datepart2,currentYear.toString()]
                      //yeardate='20'+yeardate;
                    }
                    this.setDataAtCell(row, prop,yeardate+splitdate01+monthdate+splitdate01+daydate,'my_source_date')
                  } else {
                    console.log('else navigator language')

                    //if(navigator_language=='en-US' || navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR' ){
                      var [datepart1,datepart2] =  oldvalue.split(splitdate01)

                  if(Number(datepart2)>12){
                    var [daydate,monthdate,yeardate]=["01",datepart1,datepart2]
                  } else {
                     const currentDate = new Date();
                     const currentYear = currentDate.getFullYear();
                     var [daydate,monthdate,yeardate]=[datepart1,datepart2,currentYear.toString()]
                   //yeardate='20'+yeardate;
                  }
                  console.log('before setdata')
                  console.log(daydate+splitdate01+monthdate+splitdate01+yeardate)
                    this.setDataAtCell(row, prop,daydate+splitdate01+monthdate+splitdate01+yeardate,'my_source_date')
                  }
  // **********************************************************************************
  // **********************************************************************************
  // ************************ condition date finished 2.2.10 *********************************
  // **********************************************************************************
  // **********************************************************************************
              } else if (/^\d{1,2}\-\d{1,2}(\-)?$/.test(oldvalue.trim().replace(/\s*-\s*/g,"-"))){
                console.log('condition date 2.2.11   like  31-12 12-06  13-23 1-3 ')     
                    console.log(oldvalue)             
                    var splitdate01='-';
                    var [datepart1,datepart2] =  oldvalue.split(splitdate01)
                    console.log(datepart1)
                    console.log(datepart2)
                    if(navigator_language=='en-CA' || navigator_language=='ko-KR' || navigator_language=='hu-HU' || navigator_language=='ja-JP' || navigator_language=='ZH-CN' ){   // maybe edit later change it later modify it later
                    //var [yeardate,monthdate,daydate] = oldvalue.split(splitdate01); // edit it modify it change it , when US date format occurs                  
                    var [datepart1,datepart2] =  oldvalue.split(splitdate01)

                    if(Number(datepart2)>12){
                      var [daydate,monthdate,yeardate]=["01",datepart1,datepart2]
                      //yeardate='19'+yeardate;
                    } else {
                      const currentDate = new Date();
                      const currentYear = currentDate.getFullYear();
                      var [daydate,monthdate,yeardate]=[datepart1,datepart2,currentYear.toString()]
                      //yeardate='20'+yeardate;
                    }
                    this.setDataAtCell(row, prop,yeardate+splitdate01+monthdate+splitdate01+daydate,'my_source_date')
                  } else {
                    console.log('else navigator language')

                    //if(navigator_language=='en-US' || navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR' ){
                      var [datepart1,datepart2] =  oldvalue.split(splitdate01)

                  if(Number(datepart2)>12){
                    var [daydate,monthdate,yeardate]=["01",datepart1,datepart2]
                  } else {
                     const currentDate = new Date();
                     const currentYear = currentDate.getFullYear();
                     var [daydate,monthdate,yeardate]=[datepart1,datepart2,currentYear.toString()]
                   //yeardate='20'+yeardate;
                  }
                  console.log('before setdata')
                  console.log(daydate+splitdate01+monthdate+splitdate01+yeardate)
                    this.setDataAtCell(row, prop,daydate+splitdate01+monthdate+splitdate01+yeardate,'my_source_date')
                  }


  // **********************************************************************************
  // **********************************************************************************
  // ************************ condition date finished 2.2.11 *********************************
  // **********************************************************************************
  // **********************************************************************************
                  } else if (/^\d{1,2}\.\d{1,2}(\.)?$/.test(oldvalue.trim().replace(/\s*\.\s*/g,"."))){
                    console.log('condition date 2.2.12   like  31.12. 12.06.  13.23 1.3 ')     
                    console.log(oldvalue)             
                    var splitdate01='.';
                    var [datepart1,datepart2] =  oldvalue.split(splitdate01)
                    console.log(datepart1)
                    console.log(datepart2)
                    if(navigator_language=='en-CA' || navigator_language=='ko-KR' || navigator_language=='hu-HU' || navigator_language=='ja-JP' || navigator_language=='ZH-CN' ){   // maybe edit later change it later modify it later
                    //var [yeardate,monthdate,daydate] = oldvalue.split(splitdate01); // edit it modify it change it , when US date format occurs                  
                    var [datepart1,datepart2] =  oldvalue.split(splitdate01)

                    if(Number(datepart2)>12){
                      var [daydate,monthdate,yeardate]=["01",datepart1,datepart2]
                      //yeardate='19'+yeardate;
                    } else {
                      const currentDate = new Date();
                      const currentYear = currentDate.getFullYear();
                      var [daydate,monthdate,yeardate]=[datepart1,datepart2,currentYear.toString()]
                      //yeardate='20'+yeardate;
                    }
                    this.setDataAtCell(row, prop,yeardate+splitdate01+monthdate+splitdate01+daydate,'my_source_date')
                  } else {
                    console.log('else navigator language')

                    //if(navigator_language=='en-US' || navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR' ){
                      var [datepart1,datepart2] =  oldvalue.split(splitdate01)

                  if(Number(datepart2)>12){
                    var [daydate,monthdate,yeardate]=["01",datepart1,datepart2]
                  } else {
                     const currentDate = new Date();
                     const currentYear = currentDate.getFullYear();
                     var [daydate,monthdate,yeardate]=[datepart1,datepart2,currentYear.toString()]
                   //yeardate='20'+yeardate;
                  }
                  console.log('before setdata')
                  console.log(daydate+splitdate01+monthdate+splitdate01+yeardate)
                    this.setDataAtCell(row, prop,daydate+splitdate01+monthdate+splitdate01+yeardate,'my_source_date')
                  }
  // **********************************************************************************
  // **********************************************************************************
  // ************************ condition date finished 2.2.12 *********************************
  // **********************************************************************************
  // **********************************************************************************
                  } else if (/^\d{4}\/\d{1,2}(\/)?$/.test(oldvalue.trim().replace(/\s*\/\s*/g,"/"))){
                    console.log('condition date 2.2.13   like  2031/12. 2012/06/  2013/2 ')     
                    console.log(oldvalue)             
                    var splitdate01='/';
                    var [datepart1,datepart2] =  oldvalue.split(splitdate01)
                    console.log(datepart1)
                    console.log(datepart2)
                    if(navigator_language=='en-CA' || navigator_language=='ko-KR' || navigator_language=='hu-HU' || navigator_language=='ja-JP' || navigator_language=='ZH-CN' ){   // maybe edit later change it later modify it later
                      var [datepart1,datepart2] =  oldvalue.split(splitdate01)
                      if(Number(datepart2)>12){
                          //var [daydate,monthdate,yeardate]=["01",datepart1,datepart2]
                          //commentsPlugin.setCommentAtCell(row, prop, "la date '" + oldvalue + "' n'est pas valide ");
                          commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'date_no_valid','fr-FR'))

                          this.setDataAtCell(row, prop,'','my_source_empty_date')
                        } else {
                            if(datepart2.toString().length==1){
                                var [yeardate,monthdate,daydate]=[datepart1,"0"+datepart2,"01"]
                                } else {
                                      var [yeardate,monthdate,daydate]=[datepart1,datepart2,"01"]
                                     }
                                     this.setDataAtCell(row, prop,daydate+splitdate01+monthdate+splitdate01+yeardate,'my_source_date')
                                      //yeardate='20'+yeardate;
                          }
                      } else {
                    console.log('else navigator language')

                    //if(navigator_language=='en-US' || navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR' ){
                  var [datepart1,datepart2] =  oldvalue.split(splitdate01)

                  if(Number(datepart2)>12){
                    //var [daydate,monthdate,yeardate]=["01",datepart1,datepart2]
                    //commentsPlugin.setCommentAtCell(row, prop, "la date '" + oldvalue + "' n'est pas valide ");
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'date_no_valid','fr-FR'))

                    this.setDataAtCell(row, prop,'','my_source_empty_date')
                  } else {
                    if(datepart2.toString().length==1){
                      var [yeardate,monthdate,daydate]=[datepart1,"0"+datepart2,"01"]
                    } else {
                      var [yeardate,monthdate,daydate]=[datepart1,datepart2,"01"]
                    }
                    this.setDataAtCell(row, prop,daydate+splitdate01+monthdate+splitdate01+yeardate,'my_source_date')

                   //yeardate='20'+yeardate;
                  }
                  //console.log('before setdata')
                  //console.log(daydate+splitdate01+monthdate+splitdate01+yeardate)
                  }
                  
                    // **********************************************************************************
  // **********************************************************************************
  // ************************ condition date finished 2.2.13 *********************************
  // **********************************************************************************
  // **********************************************************************************
} else if (/^\d{4}\-\d{1,2}(\-)?$/.test(oldvalue.trim().replace(/\s*-\s*/g,"-"))){
                    console.log('condition date 2.2.14   like  2031-12. 2012-06-  2013-2 ')     
                    console.log(oldvalue)             
                    var splitdate01='-';
                    var [datepart1,datepart2] =  oldvalue.split(splitdate01)
                    console.log(datepart1)
                    console.log(datepart2)
                    if(navigator_language=='en-CA' || navigator_language=='ko-KR' || navigator_language=='hu-HU' || navigator_language=='ja-JP' || navigator_language=='ZH-CN' ){   // maybe edit later change it later modify it later
                      var [datepart1,datepart2] =  oldvalue.split(splitdate01)
                      if(Number(datepart2)>12){
                          //var [daydate,monthdate,yeardate]=["01",datepart1,datepart2]
                          //commentsPlugin.setCommentAtCell(row, prop, "la date '" + oldvalue + "' n'est pas valide ");
                          commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'date_no_valid','fr-FR'))

                          this.setDataAtCell(row, prop,'','my_source_empty_date')
                        } else {
                            if(datepart2.toString().length==1){
                                var [yeardate,monthdate,daydate]=[datepart1,"0"+datepart2,"01"]
                                } else {
                                      var [yeardate,monthdate,daydate]=[datepart1,datepart2,"01"]
                                     }
                                     this.setDataAtCell(row, prop,daydate+splitdate01+monthdate+splitdate01+yeardate,'my_source_date')
                                      //yeardate='20'+yeardate;
                          }
                      } else {
                    console.log('else navigator language')

                    //if(navigator_language=='en-US' || navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR' ){
                  var [datepart1,datepart2] =  oldvalue.split(splitdate01)

                  if(Number(datepart2)>12){
                    //var [daydate,monthdate,yeardate]=["01",datepart1,datepart2]
                   // commentsPlugin.setCommentAtCell(row, prop, "la date '" + oldvalue + "' n'est pas valide ");
                   commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'date_no_valid','fr-FR'))

                    this.setDataAtCell(row, prop,'','my_source_empty_date')
                  } else {
                    if(datepart2.toString().length==1){
                      var [yeardate,monthdate,daydate]=[datepart1,"0"+datepart2,"01"]
                    } else {
                      var [yeardate,monthdate,daydate]=[datepart1,datepart2,"01"]
                    }
                    this.setDataAtCell(row, prop,daydate+splitdate01+monthdate+splitdate01+yeardate,'my_source_date')

                   //yeardate='20'+yeardate;
                  }
                  //console.log('before setdata')
                  //console.log(daydate+splitdate01+monthdate+splitdate01+yeardate)
                  }
                  
                    // **********************************************************************************
  // **********************************************************************************
  // ************************ condition date finished 2.2.14 *********************************
  // **********************************************************************************
  // **********************************************************************************
} else if (/^\d{4}\.\d{1,2}(\.)?$/.test(oldvalue.trim().replace(/\s*\.\s*/g,"."))){
                    console.log('condition date 2.2.15   like  2031.12. 2012.06.  2013.2 ')     
                    console.log(oldvalue)             
                    var splitdate01='.';
                    var [datepart1,datepart2] =  oldvalue.split(splitdate01)
                    console.log(datepart1)
                    console.log(datepart2)
                    if(navigator_language=='en-CA' || navigator_language=='ko-KR' || navigator_language=='hu-HU' || navigator_language=='ja-JP' || navigator_language=='ZH-CN' ){   // maybe edit later change it later modify it later
                      var [datepart1,datepart2] =  oldvalue.split(splitdate01)
                      if(Number(datepart2)>12){
                          //var [daydate,monthdate,yeardate]=["01",datepart1,datepart2]
                          //commentsPlugin.setCommentAtCell(row, prop, "la date '" + oldvalue + "' n'est pas valide ");
                          commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'date_no_valid','fr-FR'))

                          this.setDataAtCell(row, prop,'','my_source_empty_date')
                        } else {
                            if(datepart2.toString().length==1){
                                var [yeardate,monthdate,daydate]=[datepart1,"0"+datepart2,"01"]
                                } else {
                                      var [yeardate,monthdate,daydate]=[datepart1,datepart2,"01"]
                                     }
                                     this.setDataAtCell(row, prop,daydate+splitdate01+monthdate+splitdate01+yeardate,'my_source_date')
                                      //yeardate='20'+yeardate;
                          }
                      } else {
                    console.log('else navigator language')

                    //if(navigator_language=='en-US' || navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR' ){
                  var [datepart1,datepart2] =  oldvalue.split(splitdate01)

                  if(Number(datepart2)>12){
                    //var [daydate,monthdate,yeardate]=["01",datepart1,datepart2]
                    //commentsPlugin.setCommentAtCell(row, prop, "la date '" + oldvalue + "' n'est pas valide ");
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'date_no_valid','fr-FR'))

                    this.setDataAtCell(row, prop,'','my_source_empty_date')
                  } else {
                    if(datepart2.toString().length==1){
                      var [yeardate,monthdate,daydate]=[datepart1,"0"+datepart2,"01"]
                    } else {
                      var [yeardate,monthdate,daydate]=[datepart1,datepart2,"01"]
                    }
                    this.setDataAtCell(row, prop,daydate+splitdate01+monthdate+splitdate01+yeardate,'my_source_date')

                   //yeardate='20'+yeardate;
                  }
                  //console.log('before setdata')
                  //console.log(daydate+splitdate01+monthdate+splitdate01+yeardate)
                  }
  // **********************************************************************************
  // **********************************************************************************
  // ************************ condition date finished 2.2.15 *********************************
  // **********************************************************************************
  // **********************************************************************************

                  } else if (/^\d{1,2}\/\d{4}(\/)?$/.test(oldvalue.trim().replace(/\s*\/\s*/g,"/"))){
                    console.log('condition date 2.2.16   like  12/2023 06/2012/  2/2013/ ')     
                    console.log(oldvalue)             
                    var splitdate01='/';
                    var [datepart2,datepart1] =  oldvalue.split(splitdate01)
                    console.log(datepart1)
                    console.log(datepart2)
                    if(navigator_language=='en-CA' || navigator_language=='ko-KR' || navigator_language=='hu-HU' || navigator_language=='ja-JP' || navigator_language=='ZH-CN' ){   // maybe edit later change it later modify it later
                      var [datepart2,datepart1] =  oldvalue.split(splitdate01)
                      if(Number(datepart2)>12){
                          //var [daydate,monthdate,yeardate]=["01",datepart1,datepart2]
                          //commentsPlugin.setCommentAtCell(row, prop, "la date '" + oldvalue + "' n'est pas valide ");
                          commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'date_no_valid','fr-FR'))

                          this.setDataAtCell(row, prop,'','my_source_empty_date')
                        } else {
                            if(datepart2.toString().length==1){
                                var [yeardate,monthdate,daydate]=[datepart1,"0"+datepart2,"01"]
                                } else {
                                      var [yeardate,monthdate,daydate]=[datepart1,datepart2,"01"]
                                     }
                                     this.setDataAtCell(row, prop,daydate+splitdate01+monthdate+splitdate01+yeardate,'my_source_date')
                                      //yeardate='20'+yeardate;
                          }
                      } else {
                    console.log('else navigator language')

                    //if(navigator_language=='en-US' || navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR' ){
                  var [datepart2,datepart1] =  oldvalue.split(splitdate01)

                  if(Number(datepart2)>12){
                    //var [daydate,monthdate,yeardate]=["01",datepart1,datepart2]
                    //commentsPlugin.setCommentAtCell(row, prop, "la date '" + oldvalue + "' n'est pas valide ");
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'date_no_valid','fr-FR'))

                    this.setDataAtCell(row, prop,'','my_source_empty_date')
                  } else {
                    if(datepart2.toString().length==1){
                      var [yeardate,monthdate,daydate]=[datepart1,"0"+datepart2,"01"]
                    } else {
                      var [yeardate,monthdate,daydate]=[datepart1,datepart2,"01"]
                    }
                    this.setDataAtCell(row, prop,daydate+splitdate01+monthdate+splitdate01+yeardate,'my_source_date')

                   //yeardate='20'+yeardate;
                  }
                  //console.log('before setdata')
                  //console.log(daydate+splitdate01+monthdate+splitdate01+yeardate)
                  }
                    // **********************************************************************************
  // **********************************************************************************
  // ************************ condition date finished 2.2.16 *********************************
  // **********************************************************************************
  // **********************************************************************************

                  } else if (/^\d{1,2}\-\d{4}(\-)?$/.test(oldvalue.trim().replace(/\s*-\s*/g,"-"))){
                    console.log('condition date 2.2.17   like  12-2023 06-2012-  2-2013- ')     
                    console.log(oldvalue)             
                    var splitdate01='-';
                    var [datepart2,datepart1] =  oldvalue.split(splitdate01)
                    console.log(datepart1)
                    console.log(datepart2)
                    if(navigator_language=='en-CA' || navigator_language=='ko-KR' || navigator_language=='hu-HU' || navigator_language=='ja-JP' || navigator_language=='ZH-CN' ){   // maybe edit later change it later modify it later
                      var [datepart2,datepart1] =  oldvalue.split(splitdate01)
                      if(Number(datepart2)>12){
                          //var [daydate,monthdate,yeardate]=["01",datepart1,datepart2]
                          //commentsPlugin.setCommentAtCell(row, prop, "la date '" + oldvalue + "' n'est pas valide ");
                          commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'date_no_valid','fr-FR'))

                          this.setDataAtCell(row, prop,'','my_source_empty_date')
                        } else {
                            if(datepart2.toString().length==1){
                                var [yeardate,monthdate,daydate]=[datepart1,"0"+datepart2,"01"]
                                } else {
                                      var [yeardate,monthdate,daydate]=[datepart1,datepart2,"01"]
                                     }
                                     this.setDataAtCell(row, prop,daydate+splitdate01+monthdate+splitdate01+yeardate,'my_source_date')
                                      //yeardate='20'+yeardate;
                          }
                      } else {
                    console.log('else navigator language')

                    //if(navigator_language=='en-US' || navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR' ){
                  var [datepart2,datepart1] =  oldvalue.split(splitdate01)

                  if(Number(datepart2)>12){
                    //var [daydate,monthdate,yeardate]=["01",datepart1,datepart2]
                    //commentsPlugin.setCommentAtCell(row, prop, "la date '" + oldvalue + "' n'est pas valide ");
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'date_no_valid','fr-FR'))

                    this.setDataAtCell(row, prop,'','my_source_empty_date')
                  } else {
                    if(datepart2.toString().length==1){
                      var [yeardate,monthdate,daydate]=[datepart1,"0"+datepart2,"01"]
                    } else {
                      var [yeardate,monthdate,daydate]=[datepart1,datepart2,"01"]
                    }
                    this.setDataAtCell(row, prop,daydate+splitdate01+monthdate+splitdate01+yeardate,'my_source_date')

                   //yeardate='20'+yeardate;
                  }
                  //console.log('before setdata')
                  //console.log(daydate+splitdate01+monthdate+splitdate01+yeardate)
                  } 
                    // **********************************************************************************
  // **********************************************************************************
  // ************************ condition date finished 2.2.17 *********************************
  // **********************************************************************************
  // **********************************************************************************

                  } else if (/^\d{1,2}\.\d{4}(\.)?$/.test(oldvalue.trim().replace(/\s*\.\s*/g,"."))){
                    console.log('condition date 2.2.18   like  12.2023 06.2012.  2.2013. ')     
                    console.log(oldvalue)             
                    var splitdate01='.';
                    var [datepart2,datepart1] =  oldvalue.split(splitdate01)
                    console.log(datepart1)
                    console.log(datepart2)
                    if(navigator_language=='en-CA' || navigator_language=='ko-KR' || navigator_language=='hu-HU' || navigator_language=='ja-JP' || navigator_language=='ZH-CN' ){   // maybe edit later change it later modify it later
                      var [datepart2,datepart1] =  oldvalue.split(splitdate01)
                      if(Number(datepart2)>12){
                          //var [daydate,monthdate,yeardate]=["01",datepart1,datepart2]
                          //commentsPlugin.setCommentAtCell(row, prop, "la date '" + oldvalue + "' n'est pas valide ");
                          commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'date_no_valid','fr-FR'))
                          this.setDataAtCell(row, prop,'','my_source_empty_date')
                        } else {
                            if(datepart2.toString().length==1){
                                var [yeardate,monthdate,daydate]=[datepart1,"0"+datepart2,"01"]
                                } else {
                                      var [yeardate,monthdate,daydate]=[datepart1,datepart2,"01"]
                                     }
                                     this.setDataAtCell(row, prop,daydate+splitdate01+monthdate+splitdate01+yeardate,'my_source_date')
                                      //yeardate='20'+yeardate;
                          }
                      } else {
                    console.log('else navigator language')

                    //if(navigator_language=='en-US' || navigator_language=='de-DE' || navigator_language=='ru-RU' || navigator_language=='tr-TR' ){
                  var [datepart2,datepart1] =  oldvalue.split(splitdate01)

                  if(Number(datepart2)>12){
                    //var [daydate,monthdate,yeardate]=["01",datepart1,datepart2]
                    //commentsPlugin.setCommentAtCell(row, prop, "la date '" + oldvalue + "' n'est pas valide ");
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'date_no_valid','fr-FR'))
                    this.setDataAtCell(row, prop,'','my_source_empty_date')
                  } else {
                    if(datepart2.toString().length==1){
                      var [yeardate,monthdate,daydate]=[datepart1,"0"+datepart2,"01"]
                    } else {
                      var [yeardate,monthdate,daydate]=[datepart1,datepart2,"01"]
                    }
                    this.setDataAtCell(row, prop,daydate+splitdate01+monthdate+splitdate01+yeardate,'my_source_date')

                   //yeardate='20'+yeardate;
                  }
                  //console.log('before setdata')
                  //console.log(daydate+splitdate01+monthdate+splitdate01+yeardate)
                  } 


                      // **********************************************************************************
  // **********************************************************************************
  // ************************ condition date finished 2.2.18 *********************************
  // **********************************************************************************
  // **********************************************************************************

                  } else if (/^\d{4}\/?$/.test(oldvalue.trim().replace(/\s*\/\s*/g,"/"))){
                    console.log('condition date 2.2.19   like  2023 2022/ ')     
                    console.log(oldvalue)             
                    var splitdate01='/';
                    var [yearpart0,yearpart00] =  oldvalue.split(splitdate01)
                    this.setDataAtCell(row, prop,"01"+splitdate01+"01"+splitdate01+yearpart0,'my_source_date')
                    
                      // **********************************************************************************
  // **********************************************************************************
  // ************************ condition date finished 2.2.19 *********************************
  // **********************************************************************************
  // **********************************************************************************
                  } else if (/^\d{4}[-]?\s*$/.test(oldvalue.trim().replace(/\s*-\s*/g,"-")) ){
                    console.log('condition date 2.2.20   like  2023 2022- ')     
                    console.log(oldvalue)             
                    var splitdate01='-';
                    var [yearpart0,yearpart00] =  oldvalue.split(splitdate01)
                    this.setDataAtCell(row, prop,"01"+splitdate01+"01"+splitdate01+yearpart0,'my_source_date')
                    
                      // **********************************************************************************
  // **********************************************************************************
  // ************************ condition date finished 2.2.20 *********************************
  // **********************************************************************************
  // **********************************************************************************
          
                } else if (/^\d{4}[.]?\s*$/.test(oldvalue.trim().replace(/\s*\.\s*/g,"."))){
                    console.log('condition date 2.2.21   like  2023 2022. ')     
                    console.log(oldvalue)             
                    var splitdate01='.';
                    var [yearpart0,yearpart00] =  oldvalue.split(splitdate01)
                    this.setDataAtCell(row, prop,"01"+splitdate01+"01"+splitdate01+yearpart0,'my_source_date')
                    
                      // **********************************************************************************
  // **********************************************************************************
  // ************************ condition date finished 2.2.21 *********************************
  // **********************************************************************************
  // **********************************************************************************
                  }
           
                }            

          }  else if ( oldvalue =='') {
            console.log('condition date 3')
            console.log('do nothing could end here')
            } else {
              console.log('condition date 4')
            //commentsPlugin.setCommentAtCell(row, prop, "la date '" + oldvalue + "' n'est pas valide ");
            commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'date_no_valid','fr-FR'))
            this.setDataAtCell(row, prop,'','my_source_empty_date')
            //console.log('do nothing could end here')
            console.log('removes')
          }

        } 
        else if(prop==2){ // afterValidate of percentage,  editable the index later 
        

        console.log(isValid)
        console.log(oldvalue)
        console.log(source)
          console.log('we are inside aftervalidate prop==2')
          if (isValid && oldvalue == null ) {
            console.log('condition percentage 1')
            console.log('we are inside afterValidate percentage value==null')
            console.log('COULD END HERE')
            commentsPlugin.removeCommentAtCell(row, prop);
          } else if (isValid && oldvalue !== undefined && typeof oldvalue === 'string'){
            if(Math.abs(Number(oldvalue.toString().replace('%','').replace(',','.').replace(/\s+/g, '').trim()))>bignbpercent_percperc){
              console.log('condition percentage 1,2')
              console.log('if the number is too big')
              //commentsPlugin.setCommentAtCell(row, prop, "La valeur que vous avez saisie dépasse la limite autorisée !!");
              commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'limit_autor','fr-FR'))
              this.setDataAtCell(row, prop,'','my_source_empty_percentage')
            } else if (Math.abs(Number(oldvalue.toString().replace('%','').replace(',','.').replace(/\s+/g, '').trim())  ) <smallnbpercent_percperc) {
              console.log('condition percentage 1,35')
              console.log('if the number is too small')
              //commentsPlugin.setCommentAtCell(row, prop, "La valeur que vous avez saisie dépasse la limite autorisée !!");
              //this.setDataAtCell(row, prop,0,'my_source_empty_percentage')
              this.setDataAtCell(row, prop,0,'my_source_convertitto_0')

              // to view later  
            } else if(/^[-+]?(\s*\d+)\s*%$/.test(oldvalue.toString().trim())){
              console.log('if the value is integer and with %')
              console.log('condition percentage 1,5')
              if((/\s+%$/.test(oldvalue.trim()) || /^[-+]\s/.test(oldvalue.trim())  ) ){ 
              // condition for removing leading zerors if((/\s+%$/.test(oldvalue.trim()) || /^[-+]\s/.test(oldvalue.trim()) || /^(\+|\-)?0+/.test(oldvalue.trim())  ) ){ 
                console.log('condition percentage 1,5.1')
                // removing leading zerors this.setDataAtCell(row, prop, oldvalue.replace(/\s+/g, '').trim().replace(/^(\+|\-)?0+/, '$1'),'my_source_removewhitespacesign_percentage')
                this.setDataAtCell(row, prop, oldvalue.replace(/\s+/g, '').trim(),'my_source_removewhitespacesign_percentage')
                commentsPlugin.removeCommentAtCell(row, prop);
              } else {
                if(Number(oldvalue.replace('%','').trim())<0 && is_negativenb_accepted_percperc==false){
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'refuse_negative','fr-FR'))
                    this.setDataAtCell(row, prop, '', 'my_source_empty');
                } else {
                  if(Number.isInteger(Number(oldvalue.replace('%','').trim()))==false && is_float_accepted_percperc==false ){
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'refuse_float','fr-FR'))
                    this.setDataAtCell(row, prop, '', 'my_source_empty');
                  } else {
                console.log('condition percentage 1,5.2');
                console.log('could end here');
                commentsPlugin.removeCommentAtCell(row, prop);
              }    
              }
              }
            } else if (/^[-+]?\s*\d+\s*$/.test(oldvalue.toString().trim())){
              console.log('if the value is integer and without %')
              console.log('condition percentage 1,7')
              if((/^[-+]\s/.test(oldvalue.trim()) )){ 
                console.log('condition percentage 1,7.1')
                this.setDataAtCell(row, prop, oldvalue.replace(/\s+/g, '').trim()+'%','my_source_removewhitespacesign_percentage')
                commentsPlugin.removeCommentAtCell(row, prop);
              } else {
                if(Number(oldvalue.replace('%','').trim())<0 && is_negativenb_accepted_percperc==false){
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'refuse_negative','fr-FR'))
                    this.setDataAtCell(row, prop, '', 'my_source_empty');
                } else {
                  if(Number.isInteger(Number(oldvalue.replace('%','').trim()))==false && is_float_accepted_percperc==false ){
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'refuse_float','fr-FR'))
                    this.setDataAtCell(row, prop, '', 'my_source_empty');
                  } else {
                console.log('condition percentage 1,7.2');
                console.log('could end here');
                commentsPlugin.removeCommentAtCell(row, prop);
                  }
                }
              }

            } else if( /^[-+]?(\s*\d+(\.\d+)?)\s*$/.test(oldvalue.toString().trim())){
              console.log('condition percentage 2.1')
              if(decimalSeparator=='.'){    
                console.log('condition percentage 2.1.1')            
                  console.log(' "+ 15.63" or "12.36" or "19"  and without % , so we add it and we remove whitespaces')
                  //this.setDataAtCell(row, prop, oldvalue.replace(/\s+/g, '').trim()+'%')
                  this.setDataAtCell(row, prop, Number(oldvalue.replace(/\s+/g, '').trim()).toFixed(decimalnumbers_toshow_withoutrenderer_inpercentage_percperc).replace(/\.?0+$/, "")+'%','my_source_removewhitespacesign_percentage')

                  commentsPlugin.removeCommentAtCell(row, prop);

              } else if (decimalSeparator==','){
                console.log('condition percentage 2.1.2')            
                  console.log('may cause problem')
                  //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + oldvalue + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + oldvalue.replace(/\s+/g, '').trim().replace('.', ',') + " est correct (virguale à la place du point)");
                  //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + oldvalue + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + oldvalue.replace(/\s+/g, '').trim().replace('.', ',') + " est correct (virguale à la place du point)");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'val_try_to_fix_comma_instead_dot','fr-FR'))

                  this.setDataAtCell(row, prop, '', 'my_source_empty_percentage');
              }
            } else if(/^[-+]?(\s*\d+(,\d+)?)\s*$/.test(oldvalue.toString().trim())){
              console.log('condition percentage 2.2')
              if(decimalSeparator=='.'){
                console.log('condition percentage 2.2.1')
                  console.log('may cause problem')
                  //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + oldvalue + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + oldvalue.replace(/\s+/g, '').trim().replace(',', '.') + " est correct (point à la place de la virgule)");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'val_try_to_fix_dot_instead_comma','fr-FR'))

                  this.setDataAtCell(row, prop, '', 'my_source_empty_percentage');
              } else if (decimalSeparator==','){
                console.log('condition percentage 2.2.2')
                console.log(' "+ 15,63" or "12,36" or "19"  and without % , so we add it and we remove whitespaces')
                this.setDataAtCell(row, prop, Number(oldvalue.replace(/\s+/g, '').trim().replace(',','.')).toFixed(decimalnumbers_toshow_withoutrenderer_inpercentage_percperc).replace(/\.?0+$/, "").replace('.',',')+'%','my_source_removewhitespacesign_percentage')
                commentsPlugin.removeCommentAtCell(row, prop);

              }
            } else if (/^[-+]?(\s*\d+(\.\d+)?)\s*%$/.test(oldvalue.toString().trim())){
              console.log('condition percentage 2.3')
              if(decimalSeparator=='.'){
                console.log('condition percentage 2.3.1')
                if((/\s+%$/.test(oldvalue.trim()) || /^[-+]\s/.test(oldvalue.trim()) )){ 
                  console.log('condition percentage 2.3.1.1')
                  this.setDataAtCell(row, prop, Number(oldvalue.replace(/\s+/g, '').trim().replace('%','')).toFixed(decimalnumbers_toshow_withoutrenderer_inpercentage_percperc).replace(/\.?0+$/, "")+'%','my_source_removewhitespacesign_percentage' )
                  commentsPlugin.removeCommentAtCell(row, prop);
                 } else {
                  if( (oldvalue.toString().replace('%','').split('.')[1] || '').length>decimalnumbers_toshow_withoutrenderer_inpercentage_percperc ) {
                    console.log('condition percentage 2.3.1.1.5')
                    if( Math.abs(Number(oldvalue.toString().replace('%','')))<smallafterdigit_percentage_percperc ){ // smallafterdigit_percentage_percperc like 0.01 in case of 2
                      this.setDataAtCell(row, prop,0,'my_source_convertitto_0');
                      commentsPlugin.removeCommentAtCell(row, prop);
                    } else {                  
                    this.setDataAtCell(row, prop, Number(oldvalue.toString().replace('%','')).toFixed(decimalnumbers_toshow_withoutrenderer_inpercentage_percperc).replace(/\.?0+$/, "")+'%','my_source_removegreaterdecimalnumbers_percentage' )
                    commentsPlugin.removeCommentAtCell(row, prop); 
                  }

                  } else {
                  if(Number(oldvalue.replace('%','').trim())<0 && is_negativenb_accepted_percperc==false){
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'refuse_negative','fr-FR'))
                    this.setDataAtCell(row, prop, '', 'my_source_empty');
                } else {
                  if(Number.isInteger(Number(oldvalue.replace('%','').trim()))==false && is_float_accepted_percperc==false ){
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'refuse_float','fr-FR'))
                    this.setDataAtCell(row, prop, '', 'my_source_empty');
                  } else {
                  console.log('condition percentage 2.3.1.2')
                  console.log('could end here')
                  commentsPlugin.removeCommentAtCell(row, prop);
                  }
                }
                }
                }
                } else if(decimalSeparator==','){
                  console.log('condition percentage 2.3.2')
                  //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + oldvalue + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + oldvalue.replace(/\s+/g, '').trim().replace('.', ',') + " est correct (virgule à la place du point)");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'val_try_to_fix_comma_instead_dot','fr-FR'))

                  this.setDataAtCell(row, prop, '', 'my_source_empty_percentage');
                }
              } else if (/^[-+]?(\s*\d+(,\d+)?)\s*%$/.test(oldvalue.toString().trim())){
                console.log('condition percentage 2.4')
                console.log('aa')
                if(decimalSeparator=='.'){
                  console.log('condition percentage 2.4.1')
                  //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + oldvalue + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + oldvalue.replace(/\s+/g, '').trim().replace(',', '.') + " est correct (point à la place de la virgule)");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'val_try_to_fix_dot_instead_comma','fr-FR'))

                  this.setDataAtCell(row, prop, '', 'my_source_empty_percentage');
                } else if (decimalSeparator==','){
                  console.log('condition percentage 2.4.2')
                    if((/\s+%$/.test(oldvalue.trim()) || /^[-+]\s/.test(oldvalue.trim()) )){ 
                      console.log('condition percentage 2.4.2.1')
                       this.setDataAtCell(row, prop, Number(oldvalue.replace(/\s+/g, '').trim().replace('%','').replace(',','.')).toFixed(decimalnumbers_toshow_withoutrenderer_inpercentage_percperc).replace(/\.?0+$/, "").replace('.',',')+'%','my_source_removewhitespacesign_percentage' )
                       commentsPlugin.removeCommentAtCell(row, prop);
                     } else {
                       if( (oldvalue.toString().replace('%','').replace(',','.').split('.')[1] || '').length>decimalnumbers_toshow_withoutrenderer_inpercentage_percperc ){
                          console.log('condition percentage 2.4.2.1.5')
                             //console.log(oldvalue)
                            //console.log(Number(oldvalue.toString().replace('%','').replace(',','.'))<0 )
                            //if( Math.abs(Number(oldvalue.toString().replace('%','').replace(',','.'))) < smallafterdigit_percentage_percperc ){
                            //  console.log('cons1.1')
                            //  this.setDataAtCell(row, prop, Number(oldvalue.toString().trim().replace('%','').replace(',','.')).toFixed(afterdigitsmallnb_percentage_percperc).replace(/\.?0+$/, "").replace('.',',')+'%','my_source_removegreaterdecimalnumbers_percentage' )
                            //  commentsPlugin.removeCommentAtCell(row, prop);
                           //   } else {
                            if( Math.abs(Number(oldvalue.toString().replace('%','').replace(',','.') ))<smallafterdigit_percentage_percperc ){ // smallafterdigit_percentage_percperc like 0.01 in case of 2
                              this.setDataAtCell(row, prop,0,'my_source_convertitto_0');
                              commentsPlugin.removeCommentAtCell(row, prop);
                            } else {
                                console.log('cons1.2')
                                this.setDataAtCell(row, prop, Number(oldvalue.toString().trim().replace('%','').replace(',','.')).toFixed(decimalnumbers_toshow_withoutrenderer_inpercentage_percperc).replace(/\.?0+$/, "").replace('.',',')+'%','my_source_removegreaterdecimalnumbers_percentage' )
                                commentsPlugin.removeCommentAtCell(row, prop);
                            }
                                // }

                       } else {
                        if(Number(oldvalue.replace('%','').replace(',','.').trim())<0 && is_negativenb_accepted_percperc==false){
                          commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'refuse_negative','fr-FR'))
                          this.setDataAtCell(row, prop, '', 'my_source_empty');
                            } else {
                              if(Number.isInteger(Number(oldvalue.replace('%','').replace(',','.').trim()))==false && is_float_accepted_percperc==false ){
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'refuse_float','fr-FR'))
                    this.setDataAtCell(row, prop, '', 'my_source_empty');
                  } else {
                            console.log('condition percentage 2.4.2.2')
                            console.log('could end here')
                            commentsPlugin.removeCommentAtCell(row, prop);
                       }
                      }
                      }

                   }  
                }
           }
           } else if (oldvalue=='%'){
            //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + oldvalue + "' n'est pas valide ");
            console.log('condition percentage 2.%')
            this.setDataAtCell(row, prop,'','my_source_empty_percentage')
           } else if ( oldvalue =='') {
            console.log('condition percentage 3')
            console.log('do nothing could end here')
            } else {
              console.log('condition percentage 4')
            //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + oldvalue + "' n'est pas valide ");
            commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'percentage_no_valid_isvalidfalse_end','fr-FR'))

            this.setDataAtCell(row, prop,'','my_source_empty_percentage')

            console.log('do nothing could end here')
            console.log('removes')
          }
        }
        
        else if (prop==1) {  // afterValidate of numbers and amounts
          

          console.log('value : aftervalidate')
          console.log(oldvalue)
          console.log(typeof oldvalue)

          if (oldvalue !== null) {
            if (oldvalue.toString().includes(currencyht_nbnb) && currencyht_nbnb!=''   ) {
              console.log('new VALuE in afterValidator will be : ' + oldvalue.toString().replace(currencyht_nbnb, ''))
              this.setDataAtCell(row, prop, oldvalue.toString().replace(currencyht_nbnb, ''), 'my_source');
            } else {
              var value = oldvalue //.toString() ;
              console.log('new VALuE in afterValidator still be : ' + value)
            }

          } else {
            var value = null
          }
          //const value = oldvalue.replace(regexcurrenciesht, '');

          console.log('source in afterValidate is : ')
          console.log(source)
          console.log(value)
          console.log(typeof value)
          console.log(/^\s*[-+]?(\s*\d+)\s*$/.test(value))

          if (isValid && value == null) {
            console.log('we are inside afterValidate value==null')
            console.log('COULD END HERE')

          } else if (isValid && value !== undefined && typeof value === 'string' && /^\s*[-+]?(\s*\d+)\s*$/.test(value)) {
            console.log('integer number')
            if (/^[-+](?=\s)\s*\d+\s*$/.test(value.trim())) {
              console.log('if there is a whitespace between sign +/- and the value so remove this whitespace')
              console.log('we will call my_source_removewhitespacesign')
              this.setDataAtCell(row, prop, value.replace(/^\s*([-+])?\s*(\d+)\s*$/, '$1$2'), 'my_source_removewhitespacesign');
            } else {
              if (Math.abs(Number(value.trim())) < bignb_nbnb) {
                if (decimalSeparator == '.') {
                  console.log('condition afterValidate whole number .')
                  if(Number(value.trim())<0 && is_negativenb_accepted_nbnb==false){
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'refuse_negative','fr-FR'))
                    this.setDataAtCell(row, prop, '', 'my_source_empty');
                  } else {
                  console.log('do nothing')
                  console.log('COULD END HERE')
                  commentsPlugin.removeCommentAtCell(row, prop);
                  }

                } else if (decimalSeparator == ",") {
                  if(Number(value.trim())<0 && is_negativenb_accepted_nbnb==false){
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'refuse_negative','fr-FR'))
                    this.setDataAtCell(row, prop, '', 'my_source_empty');
                  } else {
                  console.log('do nothing')
                  console.log('COULD END HERE')
                  commentsPlugin.removeCommentAtCell(row, prop);
                  }
                }
              } else {
                //commentsPlugin.setCommentAtCell(row, prop, "La valeur que vous avez saisie dépasse la limite autorisée !!");
                commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'limit_autor','fr-FR'))

                this.setDataAtCell(row, prop, '', 'my_source_empty');
              }
            }
          } else if (isValid && value !== undefined && typeof value === 'string' && /^\s*[-+]?(\s*\d+(\.\d*)?|\.\d+)\s*$/.test(value)) {
            //1234567.89 (BY DEFAULT VALUE) AMERICAN NUMERIC FORMAT WITHOUT THOUSAND SEPARATOR
            //const value_without_whitespace2= value.replace(/^\s*([-+])\s*(\d+)/, '$1$2');

            if (/^\s*[-+]\s+\d/.test(value.trim())) {
              console.log('if there is whitespaces between sign +/- and the value so remove this whitespace like + 123456.89  ')
              console.log('we will call my_source_removewhitespacesign')
              this.setDataAtCell(row, prop, value.replace(/^\s*([-+])\s*(\d+)/, '$1$2'), 'my_source_removewhitespacesign');
            } else {
              if (decimalSeparator == '.') {
                console.log('condition 3 ta3 do nothing')
                console.log('//1234567.89 (BY DEFAULT VALUE) AMERICAN NUMERIC FORMAT WITHOUT THOUSAND SEPARATOR')
                if (Math.abs(Number(value.trim())) < bignb_nbnb) {
                  //commentsPlugin.removeCommentAtCell(row, prop);
                  //console.log('COULD END HERE')

                  if((value.trim().toString().split('.')[1] || '').length>decimalnumbers_toshow_withoutrenderer_innumbers_nbnb) {
                    this.setDataAtCell(row, prop,Number(value.trim()).toFixed(decimalnumbers_toshow_withoutrenderer_innumbers_nbnb).replace(/\.?0+$/, "") , 'my_source');
                    commentsPlugin.removeCommentAtCell(row, prop);
                  } else {
                    if(Number(value.trim())<0 && is_negativenb_accepted_nbnb==false){
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'refuse_negative','fr-FR'))
                    this.setDataAtCell(row, prop, '', 'my_source_empty');
                  } else {
                    console.log('COULD END HERE')
                    commentsPlugin.removeCommentAtCell(row, prop);
                  }
                  }


                } else {
                  //commentsPlugin.setCommentAtCell(row, prop, "La valeur que vous avez saisie dépasse la limite autorisée !!");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'limit_autor','fr-FR'))
                  this.setDataAtCell(row, prop, '', 'my_source_empty');
                }

                // do nothing
              } else if (decimalSeparator == ',') {
                console.log('condition 4')
                //this.setDataAtCell(row, prop, value.trim().replace('.', ','));
                //commentsPlugin.removeCommentAtCell(row,prop);

                if (/^\s*[-+]?(\s*\d{1,3}(\.\d{3})*|\d+)(,\d+)?\s*$/.test(value)) {
                  console.log('condition 4.1')
                  console.log('when 12.151')
                  this.setDataAtCell(row, prop, value.replace('.', ''), 'my_source');
                  commentsPlugin.removeCommentAtCell(row, prop);
                } else {
                  console.log('condition 4.2')
                  //alert('voulez vous dire que 3.16 egale a 3,14 ? si oui changer svp ')
                  //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + Number(value).toLocaleString(userLocale) + " est correct");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'val_try_to_fix_4','fr-FR'))
                  commentsPlugin.showAtCell(row, prop);
                  this.setDataAtCell(row, prop, '', 'my_source_empty');
                }

              }
            }
          } else if (isValid && value !== undefined && typeof value === 'string' && /^\s*[-+]?(\s*\d+(,\d*)?|,\d+)\s*$/.test(value)) {
            //1234567,89 EUROPEAN NUMERIC FORMAT WITHOUT THOUSAND SEPARATOR
            if (/^\s*[-+]\s+\d/.test(value.trim())) {
              console.log('if there is whitespaces between sign +/- and the value so remove this whitespace like + 123456.89  ')
              console.log('we will call my_source_removewhitespacesign')
              this.setDataAtCell(row, prop, value.replace(/^\s*([-+])\s*(\d+)/, '$1$2'), 'my_source_removewhitespacesign');
            } else {
              if (decimalSeparator == '.') {

                // WINDOWS ANGLAIS w NUMBER FRNACAIS
                // MAY CAUSE PROBLEM WITH NUMBERS
                // we have to do something
                console.log('may cause problem 1')
                //alert('may cause problem')
                console.log('condition 1 ')
                if (/^\s*[-+]?(\s*\d{1,3}(,\d{3})*(\.\d+)?|\.\d+)\s*$/.test(value)) {
                  console.log('condition 1.1')
                  console.log('like whole number with , as thousand separator 1,234')
                  this.setDataAtCell(row, prop, value.replace(/,/g, ''), 'my_source');
                  commentsPlugin.removeCommentAtCell(row, prop);

                } else {
                  console.log('condition 1.2')
                  console.log('may cause problem')
                  //alert('do you want to mean that ' + value + ' = ' + value.trim().replace(',', '.') + ' ?' )
                  //this.setDataAtCell(row, prop, value.trim().replace(',', '.'));
                  //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + value.trim().replace(',', '.') + " est correct");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'val_try_to_fix_5','fr-FR'))
                  this.setDataAtCell(row, prop, '', 'my_source_empty');
                }

                //this.setDataAtCell(row, prop, value.replace(/,/g, '') );

              } else if (decimalSeparator == ',') {
                // do nothing
                console.log('condition 2 ta3 do nothing')
                //this.setDataAtCell(row, prop, value.trim());
                //console.log('COULD END HERE')

                if (Math.abs(Number(value.trim().replace(',', '.'))) < bignb_nbnb) {
                  console.log('less than bignb_nbnb')
                  console.log(value)
                  console.log((Number(value.toString().trim().replace(',', '.')).toString().split('.')[1] || '').length)
                  //commentsPlugin.removeCommentAtCell(row, prop);
                  if((value.toString().trim().replace(',', '.').toString().split('.')[1] || '').length>decimalnumbers_toshow_withoutrenderer_innumbers_nbnb) {
                    console.log('inside first condition')
                    console.log(Number(value.toString().trim().replace(',', '.')).toFixed(decimalnumbers_toshow_withoutrenderer_innumbers_nbnb).replace(/\.?0+$/, "").replace('.', ','))
                    this.setDataAtCell(row, prop,Number(value.trim().replace(',', '.')).toFixed(decimalnumbers_toshow_withoutrenderer_innumbers_nbnb).replace(/\.?0+$/, "").replace('.', ',') , 'my_source');
                    commentsPlugin.removeCommentAtCell(row, prop);
                  } else {
                    if(Number(value.trim().replace(',','.'))<0 && is_negativenb_accepted_nbnb==false){
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'refuse_negative','fr-FR'))
                    this.setDataAtCell(row, prop, '', 'my_source_empty');
                  } else {
                    console.log('COULD END HERE')
                    commentsPlugin.removeCommentAtCell(row, prop);
                  }
                  }

                } else {
                  //commentsPlugin.setCommentAtCell(row, prop, "La valeur que vous avez saisie dépasse la limite autorisée !!");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'limit_autor','fr-FR'))
                  this.setDataAtCell(row, prop, '', 'my_source_empty');
                }


              }
            }
          } else if (isValid && value !== undefined && typeof value === 'string' && /^\s*[-+]?(\s*\d{1,3}( \d{3})*(,\d*)?|,\d+)\s*$/.test(value)) {
            // 1 234 567,89 FRENCH NUMERIC FORMAT WITH THOUSAND SEPARATOR
            console.log('condition out 5')
            console.log('// 1 234 567,89 FRENCH NUMERIC FORMAT WITH THOUSAND SEPARATOR')
            //this.setDataAtCell(row, prop, value.replace(/\s/g, '').replace(',', '.') );
            //console.log(value.replace(/\s/g, '').replace(',', '.'))
            console.log(value.replace(/\s/g, ''))
            this.setDataAtCell(row, prop, value.replace(/\s/g, ''), 'my_source');



          } else if (isValid && value !== undefined && typeof value === 'string' && /^\s*[-+]?(\s*\d{1,3}(,\d{3})*(\.\d+)?|\.\d+)\s*$/.test(value)) {

            console.log('// 1,234,567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR')
            console.log('condition out 6 ')
            if (decimalSeparator == ',') {
              // may cause problem
              console.log('condition out 6.1')
              //alert('veuillez corriger l'ecriture selon la format de vos parametres)
              //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + Number(value.replace(/,/g, '')).toLocaleString(userLocale) + " est correct");
              commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'val_try_to_fix_6','fr-FR'))
              this.setDataAtCell(row, prop, '', 'my_source_empty');

            } else {
              //
              console.log('condition out 6.2')
            
              this.setDataAtCell(row, prop, value.replace(/,/g, ''), 'my_source');
              commentsPlugin.removeCommentAtCell(row, prop);

            }
            //this.setDataAtCell(row, prop, value.replace(/,/g, '') );
            // 1,234,567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR

          } else if (isValid && value !== undefined && typeof value === 'string' && /^\s*[-+]?(\s*\d{1,3}(?:\.\d{3})+(?:,\d+)?)\s*(?=\s|$)/.test(value)) {
            // 1.234.567,89 EUROPEAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as dot
            if (/^\s*[-+]\s+\d/.test(value.trim())) {
              console.log('if there is whitespaces between sign +/- and the value so remove this whitespace like + 1.234.567,89  ')
              console.log('we will call my_source_removewhitespacesign')
              this.setDataAtCell(row, prop, value.replace(/^\s*([-+])\s*(\d+)/, '$1$2'), 'my_source_removewhitespacesign');
            } else {
              if (/^\s*[-+]?(?=\d)(?:(?:\d{1,3}(?:[.,\s]\d{3}){0,2})|(?:\d+))(?:,\d+)?(?<=,[\d,]*),(?!\d*,)\d+(?:\.\d+)?\s*$/.test(value)) {
                console.log('condition out 7.1')
                console.log('like 1,234,56 or 1.234.567,8956,78')
                //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + value + "' n'est pas valide pour cette cellule. Veuillez saisir uniquement des valeurs numériques");
                commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'val_try_to_fix_fill_only_numbers','fr-FR'))
                this.setDataAtCell(row, prop, '', 'my_source_empty');
              } else {
                console.log('condition out 7')
                console.log('// 1.234.567,89 EUROPEAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as dot')
                //this.setDataAtCell(row, prop, value.trim().replace(/\./g, '').replace(',', '.') );
                if (decimalSeparator == ',') {
                  this.setDataAtCell(row, prop, value.trim().replace(/\./g, ''), 'my_source');
                  commentsPlugin.removeCommentAtCell(row, prop);

                } else {
                  console.log('condition out 7.3')
                  console.log('1.234.567 whole number')
                  //this.setDataAtCell(row, prop, value.trim().replace(/\./g, '') );
                  //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + value.trim().replace(/\./g, '').replace(',', '.') + " est correct");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'val_try_to_fix_8','fr-FR'))
                  this.setDataAtCell(row, prop, '', 'my_source_empty');
                }
              }
            }
          } else if (isValid && value !== undefined && typeof value === 'string' && /^\s*[-+]?(\s*\d{1,3}( \d{3})*(\.\d*)?|\.\d+)\s*$/.test(value)) {
            // 1 234 567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR
            console.log('condition out 8')
            console.log('// 1 234 567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR')
            this.setDataAtCell(row, prop, value.replace(/\s/g, ''), 'my_source');
            console.log(value.replace(/\s/g, ''))
            commentsPlugin.removeCommentAtCell(row, prop);

          } else if (isValid && value !== undefined && typeof value === 'string' && /^\s*[-+]?[\s]*[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value)) {
            console.log('condition out 12 ')
            // we a re inside scientific notation when mantissa is integer
            if (/^[+-]?[\s]+\d+(\.\d+)?([eE][+-]?\d+)?$/.test(value.trim())) {
              console.log('if there is whitespaces between sign +/- and the value so remove this whitespace like + 5e6  ')
              console.log('we will call my_source_removewhitespacesign')
              this.setDataAtCell(row, prop, value.trim().replace(/\s/g, ''), 'my_source_removewhitespacesign');
              commentsPlugin.removeCommentAtCell(row, prop);

            } else {
              if (Math.abs(Number(value)) > Number(bignb_nbnb) || Math.abs(Number(value)) < Number(smallnb_nbnb)) {
                //commentsPlugin.setCommentAtCell(row, prop, "La valeur que vous avez saisie dépasse la limite autorisée !!");
                commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'limit_autor','fr-FR'))
                this.setDataAtCell(row, prop, '', 'my_source_empty');
              } else {
                if (Math.abs(Number(value)) < smallafterdigit_nbnb) {
                  console.log('we are in the case when integer scientific notation less than smallafterdigit_nbnb')
                  if (decimalSeparator == '.') {
                    this.setDataAtCell(row, prop, Number(value).toFixed(Math.abs(BigNumber(value).e)).toString(), 'my_source');
                    commentsPlugin.removeCommentAtCell(row, prop);

                  } else {
                    this.setDataAtCell(row, prop, Number(value).toFixed(Math.abs(BigNumber(value).e)).toString().replace('.', ','), 'my_source');
                    commentsPlugin.removeCommentAtCell(row, prop);

                  }
                } else {
                  if (decimalSeparator == '.') {
                    console.log('integer scinetific notation and english dot')
                    this.setDataAtCell(row, prop, parseFloat(value.replace(/\s/g, '')).toString(), 'my_source');
                    console.log(parseFloat(value.replace(/\s/g, '')).toString())
                    commentsPlugin.removeCommentAtCell(row, prop);

                  } else if (decimalSeparator == ',') {
                    console.log('integer scinetific notation and european comma')
                    this.setDataAtCell(row, prop, parseFloat(value.replace(/\s/g, '')).toString().replace('.', ','), 'my_source');
                    console.log(parseFloat(value.replace(/\s/g, '')).toString().replace('.', ','))
                    commentsPlugin.removeCommentAtCell(row, prop);

                  }
                }
              }
            }
          } else if (isValid && value !== undefined && typeof value === 'string' && /^\s*[-+]?[\s]*[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value)) {
            // we are inside scientific notation :
            // 1.6e6 1.60E+04  -13.65E4  - 12.3E+03  scientific notation with E sign
            console.log('condition out 9')
            console.log(value)
            if (Math.abs(Number(value)) > Number(bignb_nbnb) || Math.abs(Number(value)) < Number(smallnb_nbnb)) {
              //commentsPlugin.setCommentAtCell(row, prop, "La valeur que vous avez saisie dépasse la limite autorisée !!");
              commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'limit_autor','fr-FR'))
              this.setDataAtCell(row, prop, '', 'my_source_empty');

            } else {
              if (Math.abs(Number(value)) < smallafterdigit_nbnb) {
                if (decimalSeparator == '.') {
                  console.log('scientific format float mantissa and decimal separator is dot/dot and less than 0.01')
                  this.setDataAtCell(row, prop, Number(value).toFixed(Math.abs(BigNumber(value).e)).toString(), 'my_source');
                  commentsPlugin.removeCommentAtCell(row, prop);

                } else if (decimalSeparator == ',') {
                  console.log('scientific format float mantissa and decimal separator is dot/comma and less than 0.01')
                 // commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres ");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'val_try_to_fix','fr-FR'))
 
                  this.setDataAtCell(row, prop, '', 'my_source_empty');
                }
              } else {
                if (decimalSeparator == '.') {
                  console.log('scinetific notation and english dot')
                  console.log('scientific format float mantissa and decimal separator is dot/dot and greater than 0.01')
                  console.log(parseFloat(value.replace(/\s/g, '')))
                  this.setDataAtCell(row, prop, parseFloat(value.replace(/\s/g, '')).toString(), 'my_source');
                  commentsPlugin.removeCommentAtCell(row, prop)

                } else if (decimalSeparator == ',') {
                  console.log('scientific format float mantissa and decimal separator is dot/comma and greater than 0.01')
                  console.log('scinetific notation and european comma')
                 // commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres ");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'val_try_to_fix','fr-FR'))

                  this.setDataAtCell(row, prop, '', 'my_source_empty');
                  // this.setDataAtCell(row, prop, parseFloat(value.replace(/\s/g, '')).toString().replace('.',',') );
                  // console.log(parseFloat(value.replace(/\s/g, '')).toString().replace('.',',') )
                }
                //commentsPlugin.removeCommentAtCell(row,prop);

                console.log('end conditon 9')
              }
            }
          } else if (isValid && value !== undefined && typeof value === 'string' && /^\s*[-+]?[\s]*[0-9]*,?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value)) {
            // we are inside scientific notation with comma :
            // 1,6e6 1.60E+04  -13,65E4  - 12,3E+03  scientific notation with E sign
            console.log('condition out 10')
            console.log(value)
            const value1010 = value.replace(',', '.').replace(/\s/g, '')
            console.log('value1010 : ')
            console.log(value1010)
            if (Math.abs(Number(value1010)) > Number(bignb_nbnb) || Math.abs(Number(value1010)) < Number(smallnb_nbnb)) {
              //commentsPlugin.setCommentAtCell(row, prop, "La valeur que vous avez saisie dépasse la limite autorisée !!");
              commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'limit_autor','fr-FR'))
              this.setDataAtCell(row, prop, '', 'my_source_empty');

            } else {
              if (Math.abs(Number(value1010)) < smallafterdigit_nbnb) {
                if (decimalSeparator == '.') {
                  console.log('scientific format float mantissa and decimal separator is comma/dot and less than 0.01')
                  //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres ");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'val_try_to_fix','fr-FR'))

                  this.setDataAtCell(row, prop, '', 'my_source_empty');
                } else if (decimalSeparator == ',') {
                  //bg=BigNumber(val)
                  //expo=Math.abs(BigNumber(value1010).e)
                  //Number(value1010).toFixed(Math.abs(BigNumber(value1010).e))
                  //console.log('******************************************* we are inside condition out 10 less than 0.01 *******************************************')
                  console.log('scientific format float mantissa and decimal separator is comma/comma and less than 0.01')
                  this.setDataAtCell(row, prop, Number(value1010).toFixed(Math.abs(BigNumber(value1010).e)).toString().replace('.', ','), 'my_source');
                  commentsPlugin.removeCommentAtCell(row, prop);
                }

              } else {
                if (decimalSeparator == '.') {
                  //maybe it will be a problem here : to fix after
                  console.log('scientific format float mantissa and decimal separator is comma/dot and greather than 0.01')
                  //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + value + "' n'est pas valide pour cette cellule. Veuillez saisir uniquement des valeurs numériques");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'val_try_to_fix_fill_only_numbers','fr-FR'))

                  hot.setDataAtCell(row, prop, '', 'my_source_empty')
                } else if (decimalSeparator == ',') {
                  //console.log(' ////////////////////////////// we are inside condition out 10 decimal separator , /////////////////////////////////////////////')
                  console.log('scientific format float mantissa and decimal separator is comma/comma and greather than 0.01')
                  console.log(parseFloat(value.replace(',', '.').replace(/\s/g, '')))
                  this.setDataAtCell(row, prop, parseFloat(value.replace(',', '.').replace(/\s/g, '')).toString().replace('.', ','), 'my_source');
                  commentsPlugin.removeCommentAtCell(row, prop);

                }
                console.log('end conditon 10')
              }
            }
          } else if (value == '') {
            console.log('do nothing , we are in last invalid')
            console.log('COULD END HERE')
            console.log(isValid)
            console.log(source)

            //commentsPlugin.removeCommentAtCell(row,prop); //aa

          } else if (isValid == false) {
            console.log('we are before COMMENT CONTENTS !!!!!!!!!!!!!!!!!!!!!!!!!!')
            console.log(value)
            //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + value + "' n'est pas valide pour cette cellule. Veuillez saisir uniquement des valeurs numériques");
            commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'val_try_to_fix_fill_only_numbers','fr-FR'))

            //commentsPlugin.setCommentAtCell(row, prop, 'Please enter only numbers.<br><br><p style="color:red;">Veuillez entrer uniquement des nombres.</p>');

            commentsPlugin.showAtCell(row, prop);
            console.log('isvalid==false')
            //hot.setDataAtCell(row,prop,this.getData()[row][prop])
            hot.setDataAtCell(row, prop, '', 'my_source_empty')
          } else {
            console.log('WE ARE IN THE END OF AFTERVALIDATE , THE ELSE PART : ')
            hot.setDataAtCell(row, prop, '', 'my_source_empty')
            //hot.setDataAtCell(row, prop, null, 'my_source_else_empty')
            console.log('condition out 11 ')
            console.log(isValid)
            console.log(value !== undefined)
            console.log(typeof value)
            console.log(/^\s*[-+]?(\s*\d+(\.\d*)?|\.\d+)\s*$/.test(value))
            console.log(/^\s*[-+]?(\s*\d+(,\d*)?|,\d+)\s*$/.test(value))

          }
        }
        
        else if (prop==5){ // afterValidate of dropdown
         console.log('prop==5')
          if(oldvalue==null){
              console.log('we are inside null');
              commentsPlugin.removeCommentAtCell(row,prop);

            }else if(!isValid){
              console.log('first cond')
              //commentsPlugin.setCommentAtCell(row, prop, "Veuillez choisir une valeur incluse dans la liste");
              commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'dropdown_included','fr-FR'))
              this.setDataAtCell(row, prop,' ','my_source_empty_dropdown');
              //this.setDataAtCell(row, prop,'');
            } else if (oldvalue===' ') {
              console.log('2 cond')
              //commentsPlugin.removeCommentAtCell(row,prop);
              commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'dropdown_included','fr-FR'))
              //commentsPlugin.setCommentAtCell(row, prop, "Veuillez choisir une valeur incluse dans la liste");
              
              //this.setDataAtCell(row, prop,'');
            } else {
              console.log('3 cond')
              commentsPlugin.removeCommentAtCell(row,prop);
            }
        }
       
         else if (prop==6){ // afterValidate of emails
         console.log('prop==6')
         console.log(isValid)

         if (isValid && oldvalue == null ) {
            console.log('condition email  1')
            console.log('we are inside afterValidate email value==null')
            console.log('COULD END HERE')
            commentsPlugin.removeCommentAtCell(row, prop);
          } else if (isValid && oldvalue !== undefined && typeof oldvalue === 'string'){
              if(/^\s+|\s+$/g.test(oldvalue)){
                console.log('if there is a trainling whitespace between ')
                console.log('we will call my_source_removewhitespacesign_email')
                this.setDataAtCell(row, prop, oldvalue.trim(), 'my_source_removewhitespacesign');
                commentsPlugin.removeCommentAtCell(row,prop);
              } else if(oldvalue.length>emails_length_em){
                commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'email_invalid','fr-FR'))
                this.setDataAtCell(row, prop,'','my_source_empty_email');
              } else {
                console.log('COULD END HERE')
                console.log('do nothing')
                commentsPlugin.removeCommentAtCell(row,prop);
              }
            }
            else if ( oldvalue =='') {
            console.log('condition email 3')
            console.log('do nothing could end here')
            } else {
              console.log('condition email 4')
            //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + oldvalue + "' n'est pas valide ");
            commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'email_invalid','fr-FR'))
            this.setDataAtCell(row, prop,'','my_source_empty_email')

            console.log('do nothing could end here')
            console.log('removes')
          }
        }
         else if (prop==7){ // afterValidate of phone numbers
         console.log('prop==7')
         console.log(isValid)

         if (isValid && oldvalue == null ) {
            console.log('condition phonenumbers  1')
            console.log('we are inside afterValidate phonenumbers value==null')
            console.log('COULD END HERE')
            commentsPlugin.removeCommentAtCell(row, prop);
          } else if (isValid && oldvalue !== undefined && typeof oldvalue === 'string'){
              if(/^\s+|\s+$/g.test(oldvalue)){
                console.log('if there is a trainling whitespace between ')
                console.log('we will call my_source_removewhitespacesign')
                this.setDataAtCell(row, prop, oldvalue.trim(), 'my_source_removewhitespacesign');
                commentsPlugin.removeCommentAtCell(row,prop);
              } else if(oldvalue.length>phonenumbers_length_pn){
                commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'phonenumbers_invalid','fr-FR'))
                this.setDataAtCell(row, prop,'','my_source_empty_phonenumbers');
              } else {
                console.log('COULD END HERE')
                console.log('do nothing')
                commentsPlugin.removeCommentAtCell(row,prop);
              }
            }
            else if ( oldvalue =='') {
            console.log('condition phonenumbers 3')
            console.log('do nothing could end here')
            } else {
              console.log('condition phonenumbers 4')
            //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + oldvalue + "' n'est pas valide ");
            commentsPlugin.setCommentAtCell(row, prop,comments_messages(oldvalue,'phonenumbers_invalid','fr-FR'))

            this.setDataAtCell(row, prop,'','my_source_empty_phonenumbers')

            console.log('do nothing could end here')
            console.log('removes')
          }
        }
       
        else if (prop==0) {  // afterValidate of integers
          

          console.log('value : aftervalidate')
          console.log(oldvalue)
          console.log(typeof oldvalue)

           if (oldvalue !== null) {
             if (oldvalue.toString().includes(currencyht_intint) && currencyht_intint!=''  ) {
               console.log('new VALuE in afterValidator will be : ' + oldvalue.toString().replace(currencyht_intint, ''))
               this.setDataAtCell(row, prop, oldvalue.toString().replace(currencyht_intint, ''), 'my_source');
             } else {
               var value = oldvalue //.toString() ;
               console.log('new VALuE in afterValidator still be : ' + value)
             }

           } else {
             var value = null
           }

          //var value=oldvalue;
          //const value = oldvalue.replace(regexcurrenciesht, '');

          console.log('source in afterValidate is : ')
          console.log(source)
          console.log(value)
          console.log(typeof value)
          console.log(/^\s*[-+]?(\s*\d+)\s*$/.test(value))

          if (isValid && value == null) {
            console.log('we are inside afterValidate value==null')
            console.log('COULD END HERE')

          } else if (isValid && value !== undefined && typeof value === 'string' && /^\s*[-+]?(\s*\d+)\s*$/.test(value)) {
            console.log('integer number')
            if (/^[-+](?=\s)\s*\d+\s*$/.test(value.trim())) {
              console.log('if there is a whitespace between sign +/- and the value so remove this whitespace')
              console.log('we will call my_source_removewhitespacesign')
              this.setDataAtCell(row, prop, value.replace(/^\s*([-+])?\s*(\d+)\s*$/, '$1$2'), 'my_source_removewhitespacesign');
            } else {
              if (Math.abs(Number(value.trim())) < bignb_intint) {
                if (decimalSeparator == '.') {
                  console.log('condition afterValidate whole number .')

                  if(Number(value.trim())<0 && is_negativenb_accepted_intint==false){
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'refuse_negative','fr-FR'))
                    this.setDataAtCell(row, prop, '', 'my_source_empty');
                  } else {
                    if(Number.isInteger(Number(value.trim()))==false && is_float_accepted_intint==false ){
                         commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'refuse_float','fr-FR'))
                         this.setDataAtCell(row, prop, '', 'my_source_empty');
                    }else {
                     console.log('do nothing')
                     console.log('COULD END HERE')
                     commentsPlugin.removeCommentAtCell(row, prop);
                    }
                }
                } else if (decimalSeparator == ",") {
                  if(Number(value.trim())<0 && is_negativenb_accepted_intint==false){
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'refuse_negative','fr-FR'))
                    this.setDataAtCell(row, prop, '', 'my_source_empty');
                  } else {
                    if(Number.isInteger(Number(value.trim()))==false && is_float_accepted_intint==false ){
                         commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'refuse_float','fr-FR'))
                         this.setDataAtCell(row, prop, '', 'my_source_empty');
                    } else {
                  console.log('do nothing')
                  console.log('COULD END HERE')
                  commentsPlugin.removeCommentAtCell(row, prop);
                  }}
                }
              } else {
                //commentsPlugin.setCommentAtCell(row, prop, "La valeur que vous avez saisie dépasse la limite autorisée !!");
                commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'limit_autor','fr-FR'))
                this.setDataAtCell(row, prop, '', 'my_source_empty');
              }
            }
          } else if (isValid && value !== undefined && typeof value === 'string' && /^\s*[-+]?(\s*\d+(\.\d*)?|\.\d+)\s*$/.test(value)) {
            //1234567.89 (BY DEFAULT VALUE) AMERICAN NUMERIC FORMAT WITHOUT THOUSAND SEPARATOR
            //const value_without_whitespace2= value.replace(/^\s*([-+])\s*(\d+)/, '$1$2');

            if (/^\s*[-+]\s+\d/.test(value.trim())) {
              console.log('if there is whitespaces between sign +/- and the value so remove this whitespace like + 123456.89  ')
              console.log('we will call my_source_removewhitespacesign')
              this.setDataAtCell(row, prop, value.replace(/^\s*([-+])\s*(\d+)/, '$1$2'), 'my_source_removewhitespacesign');
            } else {
              if (decimalSeparator == '.') {
                console.log('condition 3 ta3 do nothing')
                console.log('//1234567.89 (BY DEFAULT VALUE) AMERICAN NUMERIC FORMAT WITHOUT THOUSAND SEPARATOR')
                if (Math.abs(Number(value.trim())) < bignb_intint) {
                  //commentsPlugin.removeCommentAtCell(row, prop);
                  //console.log('COULD END HERE')

                  if((value.trim().toString().split('.')[1] || '').length>decimalnumbers_toshow_withoutrenderer_innumbers_intint) {
                    this.setDataAtCell(row, prop,Number(value.trim()).toFixed(decimalnumbers_toshow_withoutrenderer_innumbers_intint).replace(/\.?0+$/, "") , 'my_source');
                    commentsPlugin.removeCommentAtCell(row, prop);
                  } else {
                    if(Number(value.trim())<0 && is_negativenb_accepted_intint==false){
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'refuse_negative','fr-FR'))
                    this.setDataAtCell(row, prop, '', 'my_source_empty');
                  } else {
                    if(Number.isInteger(Number(value.trim()))==false && is_float_accepted_intint==false ){
                         commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'refuse_float','fr-FR'))
                         this.setDataAtCell(row, prop, '', 'my_source_empty');
                    }else {
                    console.log('COULD END HERE')
                    commentsPlugin.removeCommentAtCell(row, prop);
                  }
                }
                  }


                } else {
                  //commentsPlugin.setCommentAtCell(row, prop, "La valeur que vous avez saisie dépasse la limite autorisée !!");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'limit_autor','fr-FR'))
                  this.setDataAtCell(row, prop, '', 'my_source_empty');
                }

                // do nothing
              } else if (decimalSeparator == ',') {
                console.log('condition 4')
                //this.setDataAtCell(row, prop, value.trim().replace('.', ','));
                //commentsPlugin.removeCommentAtCell(row,prop);

                if (/^\s*[-+]?(\s*\d{1,3}(\.\d{3})*|\d+)(,\d+)?\s*$/.test(value)) {
                  console.log('condition 4.1')
                  console.log('when 12.151')
                  this.setDataAtCell(row, prop, value.replace('.', ''), 'my_source');
                  commentsPlugin.removeCommentAtCell(row, prop);
                } else {
                  console.log('condition 4.2')
                  //alert('voulez vous dire que 3.16 egale a 3,14 ? si oui changer svp ')
                  //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + Number(value).toLocaleString(userLocale) + " est correct");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'val_try_to_fix_4','fr-FR'))
                  commentsPlugin.showAtCell(row, prop);
                  this.setDataAtCell(row, prop, '', 'my_source_empty');
                }

              }
            }
          } else if (isValid && value !== undefined && typeof value === 'string' && /^\s*[-+]?(\s*\d+(,\d*)?|,\d+)\s*$/.test(value)) {
            //1234567,89 EUROPEAN NUMERIC FORMAT WITHOUT THOUSAND SEPARATOR
            if (/^\s*[-+]\s+\d/.test(value.trim())) {
              console.log('if there is whitespaces between sign +/- and the value so remove this whitespace like + 123456.89  ')
              console.log('we will call my_source_removewhitespacesign')
              this.setDataAtCell(row, prop, value.replace(/^\s*([-+])\s*(\d+)/, '$1$2'), 'my_source_removewhitespacesign');
            } else {
              if (decimalSeparator == '.') {

                // WINDOWS ANGLAIS w NUMBER FRNACAIS
                // MAY CAUSE PROBLEM WITH NUMBERS
                // we have to do something
                console.log('may cause problem 1')
                //alert('may cause problem')
                console.log('condition 1 ')
                if (/^\s*[-+]?(\s*\d{1,3}(,\d{3})*(\.\d+)?|\.\d+)\s*$/.test(value)) {
                  console.log('condition 1.1')
                  console.log('like whole number with , as thousand separator 1,234')
                  this.setDataAtCell(row, prop, value.replace(/,/g, ''), 'my_source');
                  commentsPlugin.removeCommentAtCell(row, prop);

                } else {
                  console.log('condition 1.2')
                  console.log('may cause problem')
                  //alert('do you want to mean that ' + value + ' = ' + value.trim().replace(',', '.') + ' ?' )
                  //this.setDataAtCell(row, prop, value.trim().replace(',', '.'));
                  //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + value.trim().replace(',', '.') + " est correct");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'val_try_to_fix_5','fr-FR'))
                  this.setDataAtCell(row, prop, '', 'my_source_empty');
                }

                //this.setDataAtCell(row, prop, value.replace(/,/g, '') );

              } else if (decimalSeparator == ',') {
                // do nothing
                console.log('condition 2 ta3 do nothing')
                //this.setDataAtCell(row, prop, value.trim());
                //console.log('COULD END HERE')

                if (Math.abs(Number(value.trim().replace(',', '.'))) < bignb_intint) {
                  console.log('less than bignb_intint')
                  console.log(value)
                  console.log((Number(value.toString().trim().replace(',', '.')).toString().split('.')[1] || '').length)
                  //commentsPlugin.removeCommentAtCell(row, prop);
                  if((value.toString().trim().replace(',', '.').toString().split('.')[1] || '').length>decimalnumbers_toshow_withoutrenderer_innumbers_intint) {
                    console.log('inside first condition')
                    console.log(Number(value.toString().trim().replace(',', '.')).toFixed(decimalnumbers_toshow_withoutrenderer_innumbers_intint).replace(/\.?0+$/, "").replace('.', ','))
                    this.setDataAtCell(row, prop,Number(value.trim().replace(',', '.')).toFixed(decimalnumbers_toshow_withoutrenderer_innumbers_intint).replace(/\.?0+$/, "").replace('.', ',') , 'my_source');
                    commentsPlugin.removeCommentAtCell(row, prop);
                  } else {
                   if(Number(value.trim().replace(',', '.'))<0 && is_negativenb_accepted_intint==false){
                    commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'refuse_negative','fr-FR'))
                    this.setDataAtCell(row, prop, '', 'my_source_empty');
                  } else {
                    if(Number.isInteger(Number(value.trim().replace(',','.')))==false && is_float_accepted_intint==false ){
                         commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'refuse_float','fr-FR'))
                         this.setDataAtCell(row, prop, '', 'my_source_empty');
                    }else {
                    console.log('COULD END HERE')
                    commentsPlugin.removeCommentAtCell(row, prop);
                  }
                }
                  }

                } else {
                  //commentsPlugin.setCommentAtCell(row, prop, "La valeur que vous avez saisie dépasse la limite autorisée !!");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'limit_autor','fr-FR'))
                  this.setDataAtCell(row, prop, '', 'my_source_empty');
                }


              }
            }
          } else if (isValid && value !== undefined && typeof value === 'string' && /^\s*[-+]?(\s*\d{1,3}( \d{3})*(,\d*)?|,\d+)\s*$/.test(value)) {
            // 1 234 567,89 FRENCH NUMERIC FORMAT WITH THOUSAND SEPARATOR
            console.log('condition out 5')
            console.log('// 1 234 567,89 FRENCH NUMERIC FORMAT WITH THOUSAND SEPARATOR')
            //this.setDataAtCell(row, prop, value.replace(/\s/g, '').replace(',', '.') );
            //console.log(value.replace(/\s/g, '').replace(',', '.'))
            console.log(value.replace(/\s/g, ''))
            this.setDataAtCell(row, prop, value.replace(/\s/g, ''), 'my_source');



          } else if (isValid && value !== undefined && typeof value === 'string' && /^\s*[-+]?(\s*\d{1,3}(,\d{3})*(\.\d+)?|\.\d+)\s*$/.test(value)) {

            console.log('// 1,234,567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR')
            console.log('condition out 6 ')
            if (decimalSeparator == ',') {
              // may cause problem
              console.log('condition out 6.1')
              //alert('veuillez corriger l'ecriture selon la format de vos parametres)
              //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + Number(value.replace(/,/g, '')).toLocaleString(userLocale) + " est correct");
              commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'val_try_to_fix_6','fr-FR'))
              this.setDataAtCell(row, prop, '', 'my_source_empty');

            } else {
              //
              console.log('condition out 6.2')
            
              this.setDataAtCell(row, prop, value.replace(/,/g, ''), 'my_source');
              commentsPlugin.removeCommentAtCell(row, prop);

            }
            //this.setDataAtCell(row, prop, value.replace(/,/g, '') );
            // 1,234,567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR

          } else if (isValid && value !== undefined && typeof value === 'string' && /^\s*[-+]?(\s*\d{1,3}(?:\.\d{3})+(?:,\d+)?)\s*(?=\s|$)/.test(value)) {
            // 1.234.567,89 EUROPEAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as dot
            if (/^\s*[-+]\s+\d/.test(value.trim())) {
              console.log('if there is whitespaces between sign +/- and the value so remove this whitespace like + 1.234.567,89  ')
              console.log('we will call my_source_removewhitespacesign')
              this.setDataAtCell(row, prop, value.replace(/^\s*([-+])\s*(\d+)/, '$1$2'), 'my_source_removewhitespacesign');
            } else {
              if (/^\s*[-+]?(?=\d)(?:(?:\d{1,3}(?:[.,\s]\d{3}){0,2})|(?:\d+))(?:,\d+)?(?<=,[\d,]*),(?!\d*,)\d+(?:\.\d+)?\s*$/.test(value)) {
                console.log('condition out 7.1')
                console.log('like 1,234,56 or 1.234.567,8956,78')
                //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + value + "' n'est pas valide pour cette cellule. Veuillez saisir uniquement des valeurs numériques");
                commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'val_try_to_fix_fill_only_numbers','fr-FR'))
                this.setDataAtCell(row, prop, '', 'my_source_empty');
              } else {
                console.log('condition out 7')
                console.log('// 1.234.567,89 EUROPEAN NUMERIC FORMAT WITH THOUSAND SEPARATOR as dot')
                //this.setDataAtCell(row, prop, value.trim().replace(/\./g, '').replace(',', '.') );
                if (decimalSeparator == ',') {
                  this.setDataAtCell(row, prop, value.trim().replace(/\./g, ''), 'my_source');
                  commentsPlugin.removeCommentAtCell(row, prop);

                } else {
                  console.log('condition out 7.3')
                  console.log('1.234.567 whole number')
                  //this.setDataAtCell(row, prop, value.trim().replace(/\./g, '') );
                  //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres  |  " + value.trim().replace(/\./g, '').replace(',', '.') + " est correct");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'val_try_to_fix_8','fr-FR'))
                  this.setDataAtCell(row, prop, '', 'my_source_empty');
                }
              }
            }
          } else if (isValid && value !== undefined && typeof value === 'string' && /^\s*[-+]?(\s*\d{1,3}( \d{3})*(\.\d*)?|\.\d+)\s*$/.test(value)) {
            // 1 234 567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR
            console.log('condition out 8')
            console.log('// 1 234 567.89 AMERICAN NUMERIC FORMAT WITH THOUSAND SEPARATOR')
            this.setDataAtCell(row, prop, value.replace(/\s/g, ''), 'my_source');
            console.log(value.replace(/\s/g, ''))
            commentsPlugin.removeCommentAtCell(row, prop);

          } else if (isValid && value !== undefined && typeof value === 'string' && /^\s*[-+]?[\s]*[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value)) {
            console.log('condition out 12 ')
            // we a re inside scientific notation when mantissa is integer
            if (/^[+-]?[\s]+\d+(\.\d+)?([eE][+-]?\d+)?$/.test(value.trim())) {
              console.log('if there is whitespaces between sign +/- and the value so remove this whitespace like + 5e6  ')
              console.log('we will call my_source_removewhitespacesign')
              this.setDataAtCell(row, prop, value.trim().replace(/\s/g, ''), 'my_source_removewhitespacesign');
              commentsPlugin.removeCommentAtCell(row, prop);

            } else {
              if (Math.abs(Number(value)) > Number(bignb_intint) || Math.abs(Number(value)) < Number(smallnb_intint)) {
                //commentsPlugin.setCommentAtCell(row, prop, "La valeur que vous avez saisie dépasse la limite autorisée !!");
                commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'limit_autor','fr-FR'))
                this.setDataAtCell(row, prop, '', 'my_source_empty');
              } else {
                if (Math.abs(Number(value)) < smallafterdigit_intint) {
                  console.log('we are in the case when integer scientific notation less than smallafterdigit_intint')
                  if (decimalSeparator == '.') {
                    this.setDataAtCell(row, prop, Number(value).toFixed(Math.abs(BigNumber(value).e)).toString(), 'my_source');
                    commentsPlugin.removeCommentAtCell(row, prop);

                  } else {
                    this.setDataAtCell(row, prop, Number(value).toFixed(Math.abs(BigNumber(value).e)).toString().replace('.', ','), 'my_source');
                    commentsPlugin.removeCommentAtCell(row, prop);

                  }
                } else {
                  if (decimalSeparator == '.') {
                    console.log('integer scinetific notation and english dot')
                    this.setDataAtCell(row, prop, parseFloat(value.replace(/\s/g, '')).toString(), 'my_source');
                    console.log(parseFloat(value.replace(/\s/g, '')).toString())
                    commentsPlugin.removeCommentAtCell(row, prop);

                  } else if (decimalSeparator == ',') {
                    console.log('integer scinetific notation and european comma')
                    this.setDataAtCell(row, prop, parseFloat(value.replace(/\s/g, '')).toString().replace('.', ','), 'my_source');
                    console.log(parseFloat(value.replace(/\s/g, '')).toString().replace('.', ','))
                    commentsPlugin.removeCommentAtCell(row, prop);

                  }
                }
              }
            }
          } else if (isValid && value !== undefined && typeof value === 'string' && /^\s*[-+]?[\s]*[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value)) {
            // we are inside scientific notation :
            // 1.6e6 1.60E+04  -13.65E4  - 12.3E+03  scientific notation with E sign
            console.log('condition out 9')
            console.log(value)
            if (Math.abs(Number(value)) > Number(bignb_intint) || Math.abs(Number(value)) < Number(smallnb_intint)) {
              //commentsPlugin.setCommentAtCell(row, prop, "La valeur que vous avez saisie dépasse la limite autorisée !!");
              commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'limit_autor','fr-FR'))
              this.setDataAtCell(row, prop, '', 'my_source_empty');

            } else {
              if (Math.abs(Number(value)) < smallafterdigit_intint) {
                if (decimalSeparator == '.') {
                  console.log('scientific format float mantissa and decimal separator is dot/dot and less than 0.01')
                  this.setDataAtCell(row, prop, Number(value).toFixed(Math.abs(BigNumber(value).e)).toString(), 'my_source');
                  commentsPlugin.removeCommentAtCell(row, prop);

                } else if (decimalSeparator == ',') {
                  console.log('scientific format float mantissa and decimal separator is dot/comma and less than 0.01')
                 // commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres ");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'val_try_to_fix','fr-FR'))
 
                  this.setDataAtCell(row, prop, '', 'my_source_empty');
                }
              } else {
                if (decimalSeparator == '.') {
                  console.log('scinetific notation and english dot')
                  console.log('scientific format float mantissa and decimal separator is dot/dot and greater than 0.01')
                  console.log(parseFloat(value.replace(/\s/g, '')))
                  this.setDataAtCell(row, prop, parseFloat(value.replace(/\s/g, '')).toString(), 'my_source');
                  commentsPlugin.removeCommentAtCell(row, prop)

                } else if (decimalSeparator == ',') {
                  console.log('scientific format float mantissa and decimal separator is dot/comma and greater than 0.01')
                  console.log('scinetific notation and european comma')
                 // commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres ");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'val_try_to_fix','fr-FR'))

                  this.setDataAtCell(row, prop, '', 'my_source_empty');
                  // this.setDataAtCell(row, prop, parseFloat(value.replace(/\s/g, '')).toString().replace('.',',') );
                  // console.log(parseFloat(value.replace(/\s/g, '')).toString().replace('.',',') )
                }
                //commentsPlugin.removeCommentAtCell(row,prop);

                console.log('end conditon 9')
              }
            }
          } else if (isValid && value !== undefined && typeof value === 'string' && /^\s*[-+]?[\s]*[0-9]*,?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(value)) {
            // we are inside scientific notation with comma :
            // 1,6e6 1.60E+04  -13,65E4  - 12,3E+03  scientific notation with E sign
            console.log('condition out 10')
            console.log(value)
            const value1010 = value.replace(',', '.').replace(/\s/g, '')
            console.log('value1010 : ')
            console.log(value1010)
            if (Math.abs(Number(value1010)) > Number(bignb_intint) || Math.abs(Number(value1010)) < Number(smallnb_intint)) {
              //commentsPlugin.setCommentAtCell(row, prop, "La valeur que vous avez saisie dépasse la limite autorisée !!");
              commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'limit_autor','fr-FR'))
              this.setDataAtCell(row, prop, '', 'my_source_empty');

            } else {
              if (Math.abs(Number(value1010)) < smallafterdigit_intint) {
                if (decimalSeparator == '.') {
                  console.log('scientific format float mantissa and decimal separator is comma/dot and less than 0.01')
                  //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + value + "' n'est pas valide , Essayer de corriger l'ecriture selon le format de vos paramétres ");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'val_try_to_fix','fr-FR'))

                  this.setDataAtCell(row, prop, '', 'my_source_empty');
                } else if (decimalSeparator == ',') {
                  //bg=BigNumber(val)
                  //expo=Math.abs(BigNumber(value1010).e)
                  //Number(value1010).toFixed(Math.abs(BigNumber(value1010).e))
                  //console.log('******************************************* we are inside condition out 10 less than 0.01 *******************************************')
                  console.log('scientific format float mantissa and decimal separator is comma/comma and less than 0.01')
                  this.setDataAtCell(row, prop, Number(value1010).toFixed(Math.abs(BigNumber(value1010).e)).toString().replace('.', ','), 'my_source');
                  commentsPlugin.removeCommentAtCell(row, prop);
                }

              } else {
                if (decimalSeparator == '.') {
                  //maybe it will be a problem here : to fix after
                  console.log('scientific format float mantissa and decimal separator is comma/dot and greather than 0.01')
                  //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + value + "' n'est pas valide pour cette cellule. Veuillez saisir uniquement des valeurs numériques");
                  commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'val_try_to_fix_fill_only_numbers','fr-FR'))

                  hot.setDataAtCell(row, prop, '', 'my_source_empty')
                } else if (decimalSeparator == ',') {
                  //console.log(' ////////////////////////////// we are inside condition out 10 decimal separator , /////////////////////////////////////////////')
                  console.log('scientific format float mantissa and decimal separator is comma/comma and greather than 0.01')
                  console.log(parseFloat(value.replace(',', '.').replace(/\s/g, '')))
                  this.setDataAtCell(row, prop, parseFloat(value.replace(',', '.').replace(/\s/g, '')).toString().replace('.', ','), 'my_source');
                  commentsPlugin.removeCommentAtCell(row, prop);

                }
                console.log('end conditon 10')
              }
            }
          } else if (value == '') {
            console.log('do nothing , we are in last invalid')
            console.log('COULD END HERE')
            console.log(isValid)
            console.log(source)

            //commentsPlugin.removeCommentAtCell(row,prop); //aa

          } else if (isValid == false) {
            console.log('we are before COMMENT CONTENTS !!!!!!!!!!!!!!!!!!!!!!!!!!')
            console.log(value)
            //commentsPlugin.setCommentAtCell(row, prop, "la valeur '" + value + "' n'est pas valide pour cette cellule. Veuillez saisir uniquement des valeurs numériques");
            commentsPlugin.setCommentAtCell(row, prop,comments_messages(value,'val_try_to_fix_fill_only_numbers','fr-FR'))

            //commentsPlugin.setCommentAtCell(row, prop, 'Please enter only numbers.<br><br><p style="color:red;">Veuillez entrer uniquement des nombres.</p>');

            commentsPlugin.showAtCell(row, prop);
            console.log('isvalid==false')
            //hot.setDataAtCell(row,prop,this.getData()[row][prop])
            hot.setDataAtCell(row, prop, '', 'my_source_empty')
          } else {
            console.log('WE ARE IN THE END OF AFTERVALIDATE , THE ELSE PART : ')
            hot.setDataAtCell(row, prop, '', 'my_source_empty')
            //hot.setDataAtCell(row, prop, null, 'my_source_else_empty')
            console.log('condition out 11 ')
            console.log(isValid)
            console.log(value !== undefined)
            console.log(typeof value)
            console.log(/^\s*[-+]?(\s*\d+(\.\d*)?|\.\d+)\s*$/.test(value))
            console.log(/^\s*[-+]?(\s*\d+(,\d*)?|,\d+)\s*$/.test(value))

          }
        }
        
        
      },



    });

    hot.addHook('afterChange', function (changes, src) {
      console.log('start afterChange')
      console.log('lastelement_supthan1 start : ' + lastelement_supthan1)
      console.log(changes)
      console.log(src)

      if(hot.undoRedo.isUndoAvailable()){
         hot.undoRedo.doneActions[hot.undoRedo.doneActions.length-1].src=src;
       }
      console.log('source : ' + src)
      //console.log(hot.undoRedo.doneActions)
      //console.log(hot.undoRedo.doneActions[hot.undoRedo.doneActions.length-1].changes.toString())
   if(src=='Autofill.fill' && changes.length>1){
    lastelement_supthan1=hot.undoRedo.doneActions.length
   } else if (src=='edit' && changes.length>1 && changes.every(row => row[3] === null) ){
    console.log('we are incase afterchange where src==edit and changes.length>1')
    //alert('edit and changes>1')
    lastelement_supthan1=hot.undoRedo.doneActions.length
   }


   if(src=='my_source' || src=='my_source_removewhitespacesign' || src=='my_source_removewhitespacesign_percentage' || src=='my_source_removegreaterdecimalnumbers_percentage' || src=='my_source_convertitto_0' || src=='my_source_removewhitespacesign_date' || src=='my_source_date'){
    var shouldBreak = false;
    console.log('before entering loop , lastelement_supthan1 is : ' + lastelement_supthan1)
    for (let index = hot.undoRedo.doneActions.length-1; index >lastelement_supthan1 && !shouldBreak; index--) {
      const element = hot.undoRedo.doneActions[index].changes.length;
      console.log('****** WE ARE INSIDE LOOP UNTIL lastelement_supthan1 ****** index :' + index + ' *** and element : ' + element)
      if(element>1){
        console.log('we enter element>1 condition')
        hot.undoRedo.doneActions[index].changes.forEach((x,y)=>{
          console.log('we are inside foreach in renderer')
                if (x[0] == changes[0][0] && x[1] == changes[0][1]) {
                console.log('we are inside condition renderer')
                x[3] = changes[0][3]
                lastelement_supthan1=index;
                console.log('lastelement_supthan1 is ' + lastelement_supthan1)
                hot.undoRedo.doneActions.pop()
                shouldBreak = true;
                return;

            }
        })
      }
      console.log(element)
    }
  }
  console.log('shouldbreak is : ' + shouldBreak )
  console.log(shouldBreak==false)
  //console.log('index after the end of loop part : ' + typeof index==undefined ? 'a' : index)
      if ( (src == 'my_source' || src=='my_source_removewhitespacesign' || src=='my_source_removewhitespacesign_percentage' || src=='my_source_removegreaterdecimalnumbers_percentage' || src=='my_source_convertitto_0' || src=='my_source_removewhitespacesign_date' || src=='my_source_date') && !shouldBreak) {
        console.log('afterchange mysource62 and we will pop it')
        hot.undoRedo.doneActions[hot.undoRedo.doneActions.length - 2].changes.forEach((x, y) => {
                  console.log('we are inside foreach in renderer')
                   if (x[0] == changes[0][0] && x[1] == changes[0][1]) {
                  console.log('we are inside condition renderer')
                  x[3] = changes[0][3]
                  lastelement_supthan1=hot.undoRedo.doneActions.length-2
                  hot.undoRedo.doneActions.pop()
                  shouldBreak=true;
                }
                })
      }
      if( (src == 'my_source_empty' && changes[0][2]!='')  || (src=='my_source_empty_percentage' && changes[0][2]!='' ) || (src=='my_source_empty_date' && changes[0][2]!='' ) || (src=='my_source_empty_dropdown' && changes[0][2]!=' ' ) || (src=='my_source_empty_email' && changes[0][2]!='' ) || (src=='my_source_empty_phonenumbers' && changes[0][2]!='' ) ){
        console.log('when src == my_source_empty and changes[0][2]!= "" ')
        //hot.undoRedo.doneActions[hot.undoRedo.doneActions.length - 2].changes[0][3]=''
        hot.undoRedo.doneActions[hot.undoRedo.doneActions.length - 2].changes.forEach((x, y) => {
                  console.log('3-we are inside foreach in renderer')
                   if (x[0] == changes[0][0] && x[1] == changes[0][1]) {
                  console.log('3-we are inside condition renderer')
                  x[3] = ''
                  hot.undoRedo.doneActions.pop()
                  //shouldBreak=true;
                }
                })

      }
      console.log('lastelement_supthan1 end : ' + lastelement_supthan1)
      console.log('end afterChange')
      console.log(changes)
      console.log(hot.undoRedo.doneActions)
      console.log(hot.undoRedo.doneActions[hot.undoRedo.doneActions.length-1])
      console.log('data22 afterchage : ')
      changes.forEach((x,y)=>{
        if(x[1]!==1){
          data22[x[0]][x[1]]=x[3]
        }
      })
      console.log(data22)
      console.log(' ----------------------------- ---------------------------- ------')
    })


    const decimalSwitcher = document.getElementById('decimal-switcher');
    decimalSwitcher.addEventListener('click', function () {
      if (decimalSeparator === '.') {
        decimalSeparator = ',';
        const data = hot.getSourceData();
        const newData = data.map(row => row.map(cell => {
          if (/^\s*[-+]?(\s*\d+(\.\d*)?|\.\d+)\s*$/.test(cell)) { //1234567.89 (BY DEFAULT VALUE) AMERICAN NUMERIC FORMAT WITHOUT THOUSAND SEPARATOR
            return cell.toString().replace('.', ',');
          } else {
            return cell;
          }
        }));
        hot.loadData(newData);
      } else {
        decimalSeparator = '.';
        console.log('the new decimal separator is : ' + decimalSeparator)
        const data = hot.getSourceData();
        const newData = data.map(row => row.map(cell => {
          if (/^\s*[-+]?(\s*\d+(,\d*)?|,\d+)\s*$/.test(cell)) { //1234567,89 EUROPEAN FORMAT NUMERIC FORMAT WITHOUT THOUSAND
            return cell.toString().replace(',', '.');
          } else {
            return cell;
          }
        }));
        hot.loadData(newData);

      }
      console.log('OUTSIDE : the new decimal separator is : ' + decimalSeparator)

    });


  </script>
</body>

</html>
