<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    

<!-- <script src="http://docs.handsontable.com/0.20.2/bower_components/handsontable/dist/handsontable.full.js"></script>
<link type="text/css" rel="stylesheet" href="http://docs.handsontable.com/0.20.2/bower_components/handsontable/dist/handsontable.full.min.css"> -->


<script src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css">

<script src="http://docs.handsontable.com/0.20.2/bower_components/numeraljs/languages/de.js"></script>
<script src="https://unpkg.com/sheetclip"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<script src="https://cdn.jsdelivr.net/npm/numbro@2.3.6/dist/numbro.min.js"></script>

<script src="jspdf.min.js"></script>
<script src="jspdf.plugin.autotable.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">

<script src="https://cdn.jsdelivr.net/npm/accounting/accounting.min.js"></script>
<script src='https://cdn.jsdelivr.net/npm/bignumber.js@9.1.0/bignumber.min.js'></script>



<link rel="stylesheet" href="tableur/style.css">
<link rel="stylesheet" href="tableur/modalcss.css">  <!-- //is_date_exist==false change the modal width-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css" crossorigin="anonymous">

<!-- <script src="lodash.js"> </script> -->
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>

<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" > -->

<!-- <link rel="stylesheet" href="tableur/bootstrapdropdownmin.scss"> -->


<title>Document</title>
<style>
  .custom-dropdown .dropdown-toggle {
    width: 150px; /* Set your desired width here */
  }
</style>
</head>
<body>
  <script src="http://code.jquery.com/jquery-2.0.3.min.js" ></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
  <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> -->

<div id="allofthem">
  <div id="toolbar" style="z-index: 999999999;">
    <div id="leftside" style="padding-top:3px;">
      <button id="undoBttn" style="font-size:18px;cursor:pointer;">
        <i class="material-icons">undo</i>
      </button>

      <button id="redoBttn" style="font-size:18px;cursor:pointer;">
        <i class="material-icons">redo</i>
      </button>
  </div>
    <div id="'rightside">
      
      
      <button type="button" class="btn btn-outline-dark" id="openModalButton" style="font-size:14px;border:0px;cursor: pointer;padding-bottom: 1px;padding-right: 1px;color: cadetblue;background-color: transparent;" data-toggle="modal" data-target="#myModal">
        <i class="fa-solid fa-globe fa-lg" style=" font-size: 1.25em;line-height: .05em;vertical-align: -0.18em;"></i>
      </button>
      
      <div class="modal-overlay" id="myModal">
        <!-- <script type="module" src="./tableur/modal_language.js"></script> -->
        <div class="modal">
          <div class="modal-header">
            <h2 id='title_formatmodal' class="modal-title">Choose Format</h2>
            <span class="close">&times;</span>
          </div>
        
          <div class="modal-content">
        
            <div class="menu-container numeric-menu">
              <div class="format-options">
                <p id='title_numericformatmodal'> Choose the numeric format:</p>
                <label>
                  <input  type="radio" name="numeric-format" value="," checked>
                  <span id='title_eu_numericformatmodal'>European Format </span> (<span class="example">1500,42</span>)
                  <div id='title_eu_under_numericformatmodal' class="underexample">(comma , as Decimal Separator)</div>
                </label>
                <br>
                <label>
                  <input  type="radio" name="numeric-format" value=".">
                  <span id='title_us_numericformatmodal' >American Format </span>(<span class="example">1500.42</span>)
                  <div id='title_us_under_numericformatmodal' class="underexample">(dot . as Decimal Separator)</div>
                </label>
              </div>
            </div>
        
            <!-- //is_date_exist==false -->
            <div class="menu-container date-menu"> 
              <div class="format-options">
                <p id="title_formatmodal_date">Choose the date format:</p>
                <label>
                  <input type="radio" name="date-format" value="fr-FR" checked>
                  European Date Format (<span class="example2">31/12/1990</span>)
                </label>
                <br>
                <label>
                  <input type="radio" name="date-format" value="en-US">
                  American Date Format (<span class="example2">12/31/1990</span>)
                </label>
                <br>
                <label>
                  <input type="radio" name="date-format" value="de-DE">
                  Deutschland Date Format (<span class="example2">31.12.1990</span>)
                </label>
                <br>
                <label>
                  <input type="radio" name="date-format" value="en-CA">
                  Canadian Date Format (<span class="example2">1990-12-31</span>)
                </label>
                <br>
                <label>
                  <input type="radio" name="date-format" value="ja-JP">
                  Japonese Date Format (<span class="example2">1990/12/31</span>)
                </label>
                <br>            
                <label>
                  <input type="radio" name="date-format" value="ko-KR">
                  Korean Date Format (<span class="example2">1990.12.31</span>)
                </label>
              </div>
            </div>
        
          </div>
        
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary close-button">Close</button>
            <button type="submit" class="btn btn-primary">Submit</button>
          </div>
        </div>
      </div>
      
      <button id="finishBttn">TÃ©rminer</button>  <!-- editable -->
      
      <button id="logoutBttn" style="font-size:18px;cursor:pointer; border: 0px;vertical-align: -0.395em">
        <i class="material-icons">logout</i>
      </button>

      <div class="modal-overlay" id="myModal_logout">
        <!-- <script type="module" src="./tableur/modal_language.js"></script> -->
        <div class="modal" style="width: 550px;">
          <div class="modal-header">
            <h2 id='title_formatmodal_logout' class="modal-title">Preliminary information</h2>
            <span class="close">&times;</span>
          </div>
        
          <div class="modal-content">
        
            <div class="menu-container numeric-menu">
              <div class="format-options">
                <p id='title_numericformatmodal_logout'> Choose the numeric format:</p>
                <br>

                <div class="dropdown custom-dropdown">
                  <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Select an option
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <li><a class="dropdown-item" href="#">Option 1</a></li>
                    <li><a class="dropdown-item" href="#">Option 2</a></li>
                    <li><a class="dropdown-item" href="#">Option 3</a></li>
                    <li><a class="dropdown-item" href="#">Option 4</a></li>
                  </ul>
                </div>
              
                <label>
                  <input  type="radio" name="numeric-format" value=".">
                  <span id='title_us_numericformatmodal_logout' >American Format </span>(<span class="example">1500.42</span>)
                  <div id='title_us_under_numericformatmodal_logout' class="underexample">(dot . as Decimal Separator)</div>
                </label>
              </div>
            </div>
          </div>
                    
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary close-button">Close</button>
            <button type="submit" class="btn btn-primary">Submit</button>
          </div>
        </div>
      </div>
      
    </div>
  </div>

        
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
      </body>
    
        
        



        <!-- <button  onclick="sendValue()" class='material-symbols-outlined' style="font-size:18px;cursor:pointer;">save</button> 
           <br>
        <button onclick="handleFct()" class='material-symbols-outlined' style="font-size:18px;cursor:pointer;">sync</button>        
      -->
          </div>

          
    <div id="example1" class="hot handsontable htColumnHeaders"></div>
  </div>

<script type='module'>
  import { comments_messages } from './tableur/comments_messages.js';
  import { existsInArray } from './tableur/existsInArray.js'
  import { isValidDate } from './tableur/isValidDate.js'; //is_date_exist==false
  import { columnsdata } from './tableur/columnsdata.js';
  import { ddatafct,data22fct } from './tableur/ddata.js';
  import { normalcellloop,cellscells } from './tableur/normalcellloop.js'
  import { afterValidatefct } from './tableur/afterValidate.js'
  import { 
    //decimalSeparator,userLocale,navigator_language,
        userTimeZone,usTimeZones, //is_date_exist==false
        getVal_dateformatlanguage , //is_date_exist==false
        getVal_splitdate, //is_date_exist==false

        setInputValue_userLocale2,
        setInputValue_navigator_language2, //is_date_exist==false 

        getInputValue_userLocale2,
        getInputValue_navigator_language2, //is_date_exist==false
        getValue_decimalSeparator2,
        setInputValue_decimalSeparator2,
        
        
        navigator_language2_bydefault_ifnotexist, //is_date_exist==false
        userlocale2_bydefault_ifnotexist, 
        decimalseparator2_bydefault_ifnotexist,
        
        getInputValue_ds_haschanged,
        setInputValue_ds_haschanged,

        use_all_language_modal_depend_langbrowser, 
        which_lanaguage_touse_if_langbrowserisflse,

        all_european_formal_are_test,
        all_european_formal_are,

        convertDateFormat, //is_date_exist==false

        getInputValue_use_english_date_by_user_himeself_in_modal, //is_date_exist==false
        setInputValue_use_english_date_by_user_himeself_in_modal, //is_date_exist==false

        getInputValue_navigator_language2_avant_modify, //is_date_exist==false
        setInputValue_navigator_language2_avant_modify, //is_date_exist==false

        getInputValue_hot_undone2,
        setInputValue_hot_undone2
        

       } from './tableur/intials_inputs_nb.js'
  import { afterChangefct } from './tableur/afterChange.js'

  import { warningpopup, errorpopup } from './tableur/popups.js'
  import { mergecellsarray } from './tableur/mergecells.js'
  import { beforeKeyDownfct } from './tableur/beforeKeyDown.js'
  import { beforeChangeFct } from './tableur/beforeChange.js'
  
  import { pdf_return_table_to_downloading_Fct } from './tableur/pdf_return_table_to_downloading.js';

  import { pdf_edit_size_table_to_downloading_sadeg_Fct } from './tableur/pdf_edit_size_table_to_downloading_sadeg.js';






  //#region modal script
  function setTitlemodalformat(language2) { //is_date_exist==false pqrt of it
      //var language = getInputValue_userLocale2() || navigator.language || navigator.userLanguage;
      //console.log('langauge of the modal will be : ')
      //console.log(language2)
      if(use_all_language_modal_depend_langbrowser==true){
        var language=language2
      } else {
        var language=which_lanaguage_touse_if_langbrowserisflse
      }

      var title_formatmodal = document.getElementById("title_formatmodal");
      var title_numericformatmodal = document.getElementById("title_numericformatmodal");
      var title_eu_numericformatmodal = document.getElementById("title_eu_numericformatmodal");
      var title_eu_under_numericformatmodal = document.getElementById("title_eu_under_numericformatmodal");
      var title_us_numericformatmodal = document.getElementById("title_us_numericformatmodal");
      var title_us_under_numericformatmodal = document.getElementById("title_us_under_numericformatmodal"); 

      var title_formatmodal_date = document.getElementById("title_formatmodal_date"); //is_date_exist==false
      
       if (language.startsWith("fr")) {
  title_formatmodal.textContent = "Choisissez le format";
  title_numericformatmodal.textContent = "Choisissez le format numÃ©rique :";
  title_eu_numericformatmodal.textContent = "Format europÃ©en";
  title_eu_under_numericformatmodal.textContent = "(virgule , comme sÃ©parateur dÃ©cimal)";
  title_us_numericformatmodal.textContent = "Format amÃ©ricain";
  title_us_under_numericformatmodal.textContent = "(point . comme sÃ©parateur dÃ©cimal)";

  title_formatmodal_date.textContent = "Choisissez le format de date"; //is_date_exist==false

} else if (language.startsWith("de")) {
  title_formatmodal.textContent = "Format wÃ¤hlen";
  title_numericformatmodal.textContent = "WÃ¤hlen Sie das Zahlenformat:";
  title_eu_numericformatmodal.textContent = "EuropÃ¤isches Format";
  title_eu_under_numericformatmodal.textContent = "(Komma , als Dezimaltrennzeichen)";
  title_us_numericformatmodal.textContent = "Amerikanisches Format";
  title_us_under_numericformatmodal.textContent = "(Punkt . als Dezimaltrennzeichen)";

  title_formatmodal_date.textContent = "WÃ¤hlen Sie das Datumsformat"; //is_date_exist==false

} else if (language.startsWith("es")) {
  title_formatmodal.textContent = "Elegir formato";
  title_numericformatmodal.textContent = "Elegir el formato numÃ©rico:";
  title_eu_numericformatmodal.textContent = "Formato Europeo";
  title_eu_under_numericformatmodal.textContent = "(coma , como separador decimal)";
  title_us_numericformatmodal.textContent = "Formato Americano";
  title_us_under_numericformatmodal.textContent = "(punto . como separador decimal)";

  title_formatmodal_date.textContent = "Elige el formato de fecha"; //is_date_exist==false

  
} else {

title_formatmodal.textContent = "Choose Format";
title_numericformatmodal.textContent = "Choose the numeric format:";
title_eu_numericformatmodal.textContent = "European Format";
title_eu_under_numericformatmodal.textContent = "(comma , as Decimal Separator)";
title_us_numericformatmodal.textContent = "American Format";
title_us_under_numericformatmodal.textContent = "(dot . as Decimal Separator)";

title_formatmodal_date.textContent = "Choose the date format"; //is_date_exist==false


}      }


  

    // Call the setTitlemodalformat function when the page loads

  const modalOverlay = document.getElementById("myModal");
  const openModalButton = document.getElementById("openModalButton");
  const closeModalButton = modalOverlay.querySelector(".close-button");
  const closeButton = modalOverlay.querySelector(".close");


  const dateRadios = document.querySelectorAll('input[name="date-format"]');
  const dateValues = Array.from(dateRadios).map(radio => radio.value);  //is_date_exist==false

  const numericRadios = document.querySelectorAll('input[name="numeric-format"]');
  const numericValues = Array.from(numericRadios).map(numeric => numeric.value);
  //console.log('numericValues')
  //console.log(numericValues)


  
  openModalButton.setAttribute('data-tooltip', comments_messages("",'tooltip_modalformat',getInputValue_userLocale2()));
  openModalButton.addEventListener('mouseenter', () => {
    openModalButton.classList.add('tooltip');
      });
    
  openModalButton.addEventListener('mouseleave', () => {
        openModalButton.classList.remove('tooltip');
  });
 
  if (!numericValues.includes((1234567.73).toLocaleString(getInputValue_userLocale2(), { style: 'decimal' }).substring(9, 10))){
    setInputValue_userLocale2(userlocale2_bydefault_ifnotexist);
    setInputValue_decimalSeparator2(decimalseparator2_bydefault_ifnotexist)
    
    //console.log(getInputValue_userLocale2())
    let radioElement_numeric = document.querySelector('input[name="numeric-format"][value="'+(1234567.73).toLocaleString(userlocale2_bydefault_ifnotexist, { style: 'decimal' }).substring(9, 10)+'"]');
    radioElement_numeric.checked = true;  
  }


  if (!dateValues.includes(getInputValue_navigator_language2())){ //is_date_exist==false
    // editable later for russian and turkey and some others
      setInputValue_navigator_language2(navigator_language2_bydefault_ifnotexist);
      //console.log(getInputValue_navigator_language2())
      let radioElement = document.querySelector('input[name="date-format"][value='+navigator_language2_bydefault_ifnotexist+']');
      radioElement.checked = true;  
    }



  openModalButton.addEventListener("click", function() {
    //console.log('openmodalbt ::')
    //console.log(getInputValue_userLocale2())
    //console.log((1234567.73).toLocaleString(getInputValue_userLocale2(), { style: 'decimal' }).substring(9, 10).toString())

    let radioElement_numeric = document.querySelector('input[name="numeric-format"][value="'+(1234567.73).toLocaleString(getInputValue_userLocale2(), { style: 'decimal' }).substring(9, 10).toString()+'"]');
    radioElement_numeric.checked = true;

    //is_date_exist==false:
    let radioElement =         document.querySelector('input[name="date-format"][value='+getInputValue_navigator_language2()+']');
    radioElement.checked = true;

    modalOverlay.style.display = "block";
    // setInputValue_navigator_language2(getInputValue_navigator_language2())
  });

  closeModalButton.addEventListener("click", function() {
    modalOverlay.style.display = "none";  

  });

  closeButton.addEventListener("click", function() {
    modalOverlay.style.display = "none";


  });

  // Add event listeners or any other logic related to the modal


    const submitButton = document.querySelector(".modal-footer .btn-primary");



    // Update the default checked state
  
    let selectedNumericFormat = (1234567.73).toLocaleString(getInputValue_userLocale2(), { style: 'decimal' }).substring(9, 10);
    numericRadios.forEach(function(numeric) {      
      numeric.addEventListener("click", function() {  
        selectedNumericFormat = this.value;     
      });
    });

    
    let selectedDateFormat = getInputValue_navigator_language2(); //is_date_exist==false
    dateRadios.forEach(function(radio) {      
      radio.addEventListener("click", function() {  
        selectedDateFormat = this.value;     
      });
    });

  
    submitButton.addEventListener("click", function() {
      //console.log('hot : ')
      //console.log(hot.getData())
      var data_to_convert = hot.getData(); // Get the data from the Handsontable
      //console.log('data_to_convert :')
      //console.log(data_to_convert)  
     
      const NumColumnsToConvert = [2,3,4,5,6,7,8,10,11,12,13]; // editable Specify the indices of the columns to convert
      const startRowIndex = 5; // editable Specify the starting row index for conversion
      const DateColumnsToConvert = [14]; // editable //is_date_exist==false
      const changesdata_numeric = [];
      const changesdata_date = []; //is_date_exist==false

    if(selectedDateFormat!==getInputValue_navigator_language2()){ //is_date_exist==false
      data_to_convert.forEach((row, rowIndex) => {
        if (rowIndex > startRowIndex) {
          DateColumnsToConvert.forEach(columnIndex => {
            const cellValueDate = row[columnIndex];
            if(cellValueDate!==null && cellValueDate!=='' && cellValueDate!==' ' && cellValueDate!==undefined){     
                 outerLoop: for (const lang of dateValues) {
                    for (const lang2 of dateValues) {
                      if(getInputValue_navigator_language2()==lang && selectedDateFormat==lang2){
                        //console.log('before convertdateformat :')
                        //console.log(cellValueDate)
                        //console.log(lang)
                        //console.log(lang2)
                        var convertedDate = convertDateFormat(cellValueDate, lang, lang2);
                           if(convertedDate!=cellValueDate){
                               var changeonedata = [rowIndex, columnIndex, convertedDate];
                               changesdata_date.push(changeonedata);
                              
                           }
                          break outerLoop;
                        }
                     }
                 }

            }
          })
        }
         })

  for (let index = 0; index<hot.undoRedo.undoneActions.length; index++) { 
    hot.undoRedo.undoneActions[index].changes.forEach((x,y)=>{
      if(x[1]==14) {  // editable
        if(x[2]!==null && x[2]!=='' && x[2]!==' '){
          x[2]=convertDateFormat(x[2], getInputValue_navigator_language2(), selectedDateFormat) 
        }
        if(x[3]!==null && x[3]!=='' && x[3]!==' '){
          x[3]=convertDateFormat(x[3], getInputValue_navigator_language2(), selectedDateFormat) 
        }
        }
    })
  }
          if(selectedDateFormat=='en-US'){
            setInputValue_use_english_date_by_user_himeself_in_modal(true)
          } else {
            setInputValue_use_english_date_by_user_himeself_in_modal(false)
          }
         setInputValue_navigator_language2_avant_modify(getInputValue_navigator_language2())
         setInputValue_navigator_language2(selectedDateFormat)
         setInputValue_hot_undone2(_.cloneDeep(hot.undoRedo.undoneActions));              
         hot.setDataAtRowProp(changesdata_date,'dataatrowprop_convert_date');
    }
    //console.log('comparaison : ')
    //console.log(getValue_decimalSeparator2()==selectedNumericFormat)

if(getValue_decimalSeparator2()!=selectedNumericFormat){
      if(selectedNumericFormat==',' ){
        if(all_european_formal_are_test==true && all_european_formal_are=='fr'){ // editable 'fr the change it if the previous is true'
          // when we set the numeric format always be in fr 1 234 567.89  and modal language is in fr
          setInputValue_userLocale2('fr'); // editable if it's necessary
          setTitlemodalformat('fr'); // editable if it's necessary
        } else if( (1234567.73).toLocaleString(Intl.DateTimeFormat().resolvedOptions().locale, { style: 'decimal' }).substring(9, 10).toString()==','){
            
            setInputValue_userLocale2(Intl.DateTimeFormat().resolvedOptions().locale);
            setTitlemodalformat(Intl.DateTimeFormat().resolvedOptions().locale);

          } else {
            setInputValue_userLocale2('fr');
            setTitlemodalformat('en')
          }
          setInputValue_decimalSeparator2(',')
          data_to_convert.forEach((row, rowIndex) => {
                if (rowIndex > startRowIndex) {
                    NumColumnsToConvert.forEach(columnIndex => {
                         const cellValue = row[columnIndex];
                         const convertedNumber = cellValue.replace(/\./g, ',');
                         if(convertedNumber!=cellValue){
                           ////console.log('convert dontequal to cellvalue : ')
                           ////console.log(convertedNumber)
                           ////console.log(cellValue)
                           var changeonedata = [rowIndex, columnIndex, convertedNumber];
                           changesdata_numeric.push(changeonedata);
                        }
                    });
                  }
              });
              
  for (let index = 0; index<hot.undoRedo.undoneActions.length; index++) {
    hot.undoRedo.undoneActions[index].changes.forEach((x,y)=>{
      ////console.log('x in foreach :')
      if( // editable
        x[1] == 2 || x[1] == 3 || x[1] == 4  || x[1] == 5  || x[1] == 6  ||
        x[1] == 7 || x[1] == 8 || x[1] == 10 || x[1] == 11 || x[1] == 12 || 
        x[1] == 13
        ){
          x[2]=x[2].replace(/\./g, ',');
          x[3]=x[3].replace(/\./g, ',');
        }
    })
  }
              setInputValue_ds_haschanged(true)
              setInputValue_hot_undone2(_.cloneDeep(hot.undoRedo.undoneActions));              
              // setInputValue_hot_undone2(JSON.parse(JSON.stringify(hot.undoRedo.undoneActions)));              
              hot.setDataAtRowProp(changesdata_numeric,'dataatrowprop_convert_to_fr');
      } else {
          setInputValue_userLocale2('en')
          setInputValue_decimalSeparator2('.')
          data_to_convert.forEach((row, rowIndex) => {
                if (rowIndex > startRowIndex) {
                    NumColumnsToConvert.forEach(columnIndex => {
                         const cellValue = row[columnIndex];
                         const convertedNumber = cellValue.replace(/,/g, '.');
                         if(convertedNumber!=cellValue){
                           //console.log('convert dontequal to cellvalue : ')
                           //console.log(convertedNumber)
                           //console.log(cellValue)
                           var changeonedata = [rowIndex, columnIndex, convertedNumber];
                           changesdata_numeric.push(changeonedata);
                        }
                    });
                  }
              });

              for (let index = 0; index<hot.undoRedo.undoneActions.length; index++) {
    hot.undoRedo.undoneActions[index].changes.forEach((x,y)=>{
      //console.log('x in foreach :')
      if( // editable
        x[1] == 2 || x[1] == 3 || x[1] == 4  || x[1] == 5  || x[1] == 6  ||
        x[1] == 7 || x[1] == 8 || x[1] == 10 || x[1] == 11 || x[1] == 12 || 
        x[1] == 13
        ){
          x[2]=x[2].replace(/,/g, '.');
          x[3]=x[3].replace(/,/g, '.');
        }
    })
  }

              setInputValue_ds_haschanged(true);
              setInputValue_hot_undone2(_.cloneDeep(hot.undoRedo.undoneActions));              
              hot.setDataAtRowProp(changesdata_numeric,'dataatrowprop_convert_to_en');
      }
    }
      //setInputValue_userLocale2(selectedNumericFormat)

      modalOverlay.style.display = "none";


      // Your action code goes here
    });
    //setTitlemodalformat(getInputValue_userLocale2());


  //#endregion modal script

  
      function undohandstonetable() {
          hot.undo(true);
      }
      function redohandstonetable() {
          hot.redo(false);

      }
      
      var ddata = ddatafct();
      var data22 = data22fct()
    

var container = document.getElementById('example1')
var sheetclip = new SheetClip();
var clipboardCache = '';


const hot = new Handsontable(container, {
    //data: getData(),
    data : ddata,
    licenseKey: 'non-commercial-and-evaluation', // for non-commercial use only
          rowHeaders: true,
          wordWrap: true,
          colHeaders: true,
          comments: true,
          manualColumnResize: true,
          manualRowResize: true,
          colWidths: [50,200,100,120,120, 120,120,120,120,100,  120,120,120,120,100,    20 ], // editable of course
          undo: true,
          columns: columnsdata(0,16),  // editable of course
          contextMenu: {
            items:{
              "copy":{name:"Copier"},
              "cut":{name:'Couper'},
              "paste":{
                name: 'Coller (Utiliser <b>Ctrl + V</b> avec le clavier)',
                disabled:true
             }
            }
          },
          startRows: 6, //maybe editable , i see later what does it mean
          startCols: 5, //maybe editable , i see later what does it mean
          cells:(row,column) => {
            return cellscells(row,column);
          },
          mergeCells: mergecellsarray,
          cell: normalcellloop(),
          hiddenColumns: {columns:[15]},  // editable of course
          DragToScroll: true,
          copyPaste: true,
          afterValidate: (isValid, value, row, prop, source, ...otherArgs) => {
            const hotInstance = hot; // Store the hot instance
            afterValidatefct(isValid, value, row, prop, source, ...otherArgs, hotInstance);

            //return afterValidatefct(oldvalue, row, prop, source, ...otherArgs, hot);
          },
          beforeKeyDown: (event, ...otherArgs) => {
            //const hotInstance = hot; // Store the hot instance
            //beforeKeyDownfct(event, ...otherArgs, hotInstance);

            return beforeKeyDownfct(event, ...otherArgs, hot);
          },


       afterCreateRow: function(index, amount) {
        // Your custom logic goes here
        //console.log('A new row has been added at index: ', index);
        //console.log(amount)
        //console.log(index)
        data22.push(['','','','','','',''])
        //console.log(data22)
      },

       afterSelection: (r1, c1, r2, c2) => {
         var comment = hot.getCellMeta(r1, c1).comment;
         if (comment !== undefined) {
            var commentsPlugin = hot.getPlugin('comments');
           commentsPlugin.showAtCell(r1, c1);
           //return comment;
         } else {
            var commentsPlugin = hot.getPlugin('comments');
           commentsPlugin.hide();
         }
       },
     
        

 
});

hot.addHook('beforeChange', function(changes, source, ...otherArgs) {
  //const hotInstance = hot; // Store the hot instance
  //beforeChangeFct(changes,source, ...otherArgs, hotInstance)

  return beforeChangeFct(changes,source, ...otherArgs, hot)
});


hot.addHook('afterChange', function(changes, src, ...otherArgs) {
  //const hotInstance = hot; // Store the hot instance
  //afterChangefct(changes,src, ...otherArgs, hotInstance)

  return afterChangefct(changes,src, ...otherArgs, hot)
});



const downloadfile=()=>{

  var doc = new jsPDF({orientation:'landscape'});
  const table=pdf_return_table_to_downloading_Fct(hot)
  const { columnStyles, font_size } = pdf_edit_size_table_to_downloading_sadeg_Fct(table);

doc.autoTable({  // the complete width of the A4 landscape page is : 297 (i think the unit is by mm so 297mm x 210mm  or 210mm x 297mm)
               
                body:table,
                theme:'grid',
                margin:{left:7,right:4},        // maybe editable  
                columnStyles: columnStyles,
                styles:{fontSize:font_size,
    textColor: [0, 0, 0], // Set text color to black
    lineColor: [0, 0, 0], // Set line color to black
    lineWidth: 0.1 // Set line width to 0.1 (adjust as needed)},
         },
    didParseCell:function(data){data.cell.styles.font = "helvetica";}
         
})
doc.save('taaa.pdf')
}




document.addEventListener('DOMContentLoaded', function() {
    var button_finish = document.getElementById('finishBttn');
    var button_undo = document.getElementById('undoBttn');
    var button_redo = document.getElementById('redoBttn');
    //var button_modalformat = document.getElementById('openModalButton');
  
    var button_logout = document.getElementById('logoutBttn');
    const modalOverlay_logout = document.getElementById("myModal_logout");
    const closeModalButton_logout = modalOverlay_logout.querySelector(".close-button");
    const closeButton_logout = modalOverlay_logout.querySelector(".close");


    //const myfinishBttn = document.getElementById('finishBttn');
  
    button_finish.setAttribute('data-tooltip', comments_messages("",'tooltip_finish',getInputValue_userLocale2()));
    button_finish.addEventListener('mouseenter', () => {
      button_finish.classList.add('tooltip');
      });
    
      button_finish.addEventListener('mouseleave', () => {
        button_finish.classList.remove('tooltip');
    });

     
    button_undo.setAttribute('data-tooltip', comments_messages("",'tooltip_undo',getInputValue_userLocale2()));
    button_undo.addEventListener('mouseenter', () => {
      button_undo.classList.add('tooltip');
      });
    
      button_undo.addEventListener('mouseleave', () => {
        button_undo.classList.remove('tooltip');
    });

    
    button_redo.setAttribute('data-tooltip', comments_messages("",'tooltip_redo',getInputValue_userLocale2()));
    button_redo.addEventListener('mouseenter', () => {
      button_redo.classList.add('tooltip');
      });
    
    button_redo.addEventListener('mouseleave', () => {
        button_redo.classList.remove('tooltip');
    });
   

    
    button_logout.setAttribute('data-tooltip', comments_messages("",'tooltip_logout',getInputValue_userLocale2()));
    button_logout.addEventListener('mouseenter', () => {
      button_logout.classList.add('tooltip');
      });
    
      button_logout.addEventListener('mouseleave', () => {
        button_logout.classList.remove('tooltip');
    });


  const dropdownButton = document.querySelector("#dropdownMenuButton");
  const dropdownItems = document.querySelectorAll(".dropdown-item");
  // const textElement = document.querySelector("#text1");

  dropdownItems.forEach(item => {
    item.addEventListener("click", function() {
      const selectedOption = this.textContent;
      dropdownButton.textContent = selectedOption;
      // textElement.textContent = selectedOption;
    });
  });


    button_finish.addEventListener('click', function() {
      // Your code here
      downloadfile()
      //console.log('Button clicked!');
      
    });

    button_undo.addEventListener('click', function() {
      undohandstonetable(); 
    });

    button_redo.addEventListener('click', function() {
      redohandstonetable();
    });


    
    logoutBttn.addEventListener("click", function() {
  /*  
      let radioElement_numeric = document.querySelector('input[name="numeric-format"][value="'+(1234567.73).toLocaleString(getInputValue_userLocale2(), { style: 'decimal' }).substring(9, 10).toString()+'"]');
      radioElement_numeric.checked = true;

      let radioElement =         document.querySelector('input[name="date-format"][value='+getInputValue_navigator_language2()+']');
      radioElement.checked = true;
*/
    modalOverlay_logout.style.display = "block";
  });

  closeModalButton_logout.addEventListener("click", function() {
    modalOverlay_logout.style.display = "none";  

  });

  closeButton_logout.addEventListener("click", function() {
    modalOverlay_logout.style.display = "none";


  });



    
  });


</script>

</body>
</html>

