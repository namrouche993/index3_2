<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Handsontable Example</title>
  <!-- Include Handsontable CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.min.css">
</head>
<body>
  <div id="example"></div>
  <button id="removeThirdStepButton">Remove Third Step</button>

  <!-- Include Handsontable JavaScript library -->
  <script src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js"></script>

  <script>
    // Create Handsontable instance
    var hot = new Handsontable(document.getElementById('example'), {
      data: [
        [''],
        [''],
        [''],
        [''],
      ],
      comments:true,
      columns: [
        { title:'Age',
        validator:(value,callback)=>{
          console.log(value)
          if(value==null){
            callback(true)
          }else if(value=='' || value==' '){
            callback(true)
          }else if(Number(value)>0){
            callback(true)
          } else {
            callback(false)
          }
        }
        }
      ],
      afterValidate: function(isValid, value, row, prop, source) {
        console.log('start aftervalidate')
           const commentsPlugin = hot.getPlugin('comments');
           if( (value==null || value=='' || value==' ') && source!='my_source2'){
            commentsPlugin.removeCommentAtCell(row,prop);
             console.log('null empty empty2')
           }else if (Number(value>69)) {
          this.setDataAtCell(row, prop,null,'my_source2');
        } else if (Number(value) > 60) {
          this.setDataAtCell(row, prop,value-20,'my_source');
          commentsPlugin.removeCommentAtCell(row,prop);
          } else if (!isValid){
            commentsPlugin.setCommentAtCell(row, prop, "La valeur que vous avez saisie nest pas autoris√©e !!");
            this.setDataAtCell(row, prop,null,'my_source2');
          }
        console.log('end aftervalidate')

      }
      })

      hot.addHook('afterChange', function(changes, src) {
        console.log('start afterChange')
        console.log(changes)
        console.log(src)
        if(src=='my_source2'){
          console.log('we are inside src==my_source')
          //console.log(hot.undoRedo.doneActions[hot.undoRedo.doneActions.length-2])
          hot.undoRedo.doneActions.splice(hot.undoRedo.doneActions.length-2,1)
        } else if (src=='my_source') {
          hot.undoRedo.doneActions.splice(hot.undoRedo.doneActions.length-2,1)
          //hot.undoRedo.doneActions.pop()
        }
        console.log('end afterChange')
        console.log(hot.undoRedo.doneActions)
      })

   
    
  </script>
</body>
</html>
