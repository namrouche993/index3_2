<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Handsontable Example</title>
  <!-- Include Handsontable CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.min.css">
</head>
<body>
  <div id="example"></div>
  <button id="removeThirdStepButton">Remove Third Step</button>

  <!-- Include Handsontable JavaScript library -->
  <script src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js"></script>

  <script>
    // Create Handsontable instance
    var hot = new Handsontable(document.getElementById('example'), {
      data: [
        [1],
        [2],
        [3],
        [4],
      ],
      columns: [
        { type: 'numeric',title:'Age'}
      ],
      afterValidate: function(isValid, value, row, prop, source) {
        console.log('start aftervalidate')
        //if(hot.undoRedo.doneActions[0]!=undefined){
        //  var hota = hot.undoRedo.doneActions.pop()
        //  console.log('hotundoredo')
        //  console.log(hota)
          //console.log(hot.undoRedo.doneActions[0])
        //}
        console.log(source)
        console.log('hot.undoRedo.doneActions : ')
        //console.log(hot.undoRedo.doneActions)
         if(source=='my_source'){
          //console.log(hot.undoRedo.doneActions)
          hot.undoRedo.doneActions[hot.undoRedo.doneActions.length-1].changes.forEach((x,y)=>{
            console.log('we are inside foreach')
            if(x[0]==row && x[1]==prop){
              console.log(x)
              console.log(value)
                console.log('we are inside condition of foreach')
                    x[3]=value.toString()
                  }
                })
        }
        //console.log(hot.undoRedo.doneActions)
        if (Number(value) > 50) {
          //console.log('start inside condition 50')
          this.setDataAtCell(row, prop,value-20,'my_source');
          //console.log(hot.undoRedo.doneActions.pop().changes[0])
          //console.log('end inside condition 50')
        }
        //console.log(hot.undoRedo.doneActions[6])
        console.log('end aftervalidate')

      }
      })

      hot.addHook('afterChange', function(changes, src) {
        console.log('start afterChange')
        if(src=='my_source'){
          hot.undoRedo.doneActions.pop()
        }
        console.log('end afterChange')
      })

      const removeThirdStepButton = document.getElementById('removeThirdStepButton');
      removeThirdStepButton.addEventListener('click', function() {
        const actions = hot.undoRedo.doneActions;
        actions.splice(actions.length, 1);
        console.log('we removed the 7th step')
      })
    
  </script>
</body>
</html>
