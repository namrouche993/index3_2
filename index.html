<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Custom Editor in Handsontable</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css">
  <script src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js"></script>
</head>
<body>
  <div id="example"></div>

  <script>

class PercentageEditor extends Handsontable.editors.TextEditor {
  open() {
    super.open();
    const value = this.getValue();
    if (!value.endsWith('%')) { // check if the value doesn't already end with a percent sign
      this.TEXTAREA.value += '%'; // add a "%" sign to the initial value
    }
  }

  setValue(value) {
    const percentValue = value.replace(/%/g, '') + '%'; // remove existing "%" signs and add a new one
    super.setValue(percentValue);
  }
  

 /* onBeforeKeyDown(event) {
    const value = this.getValue();
    const key = event.keyCode || event.which;

    if (key >= 48 && key <= 57) { // numeric keys
      const percentValue = value.replace(/%/g, '') + String.fromCharCode(key) + '%';
      this.setValue(percentValue);
      event.stopImmediatePropagation();
      event.preventDefault();
    } else if (key === 8) { // backspace key
      const percentValue = value.replace(/%$/, '');
      this.setValue(percentValue);
      event.stopImmediatePropagation();
      event.preventDefault();
    }
  }
*/
  close() {
    super.close();
    const value = this.getValue();
    if (value.endsWith('%')) { // check if the value ends with a percent sign
      this.TEXTAREA.value = value.slice(0, -1); // remove the last character (the percent sign)
    }
  }

  focus() {
    super.focus();
    const length = this.TEXTAREA.value.length;
    this.TEXTAREA.setSelectionRange(0, length - 1); // set the cursor position at the end of the value
  }
}

  
  const hot = new Handsontable(document.getElementById('example'), {
    data: [
    ['','','',''],
    ['','','',''],
    ['','','',''],
    ['','','',''],
    ['','','',''],
    ['','','',''],
    ['','','','']
  ],
  columns: [
    { data: 'id', type: 'numeric' },
    { data: 'name', editor: PercentageEditor },
    { data: 'email', editor: 'text' },
    { data: 'phone', editor: 'text' },
  ],
  beforeKeyDown(event) {
    console.log('onBeforeKeyDown')
    console.log(event)
    if (event.key === '.') {
     var cell = this.getActiveEditor().TEXTAREA; // Get the DOM element representing the cell editor
     console.log(cell)
     console.log(cell.value)
     console.log(cell.value.length)
     this.getActiveEditor().setValue(this.getActiveEditor().getValue() + ',');
     cell.setSelectionRange(cell.value.length-1, cell.value.length-1); // Set the new cursor position

     event.stopImmediatePropagation();
     event.preventDefault();
    }
  }
});

  </script>
</body>
</html>
